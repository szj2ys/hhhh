import{u as ce,m as J}from"./index-DmF6C1yQ.js";import"./store@2.0.12-BYMheg-V.js";import{m as pe}from"./marked@14.1.4-DFvw2-ac.js";import{d as de,A as ue,x as me,o as fe,w as L,F as _e,G as ge,B as ve,D as M}from"./lodash-es@4.17.21-5_SSvygx.js";import{E as y,b as O}from"./element-plus@2.10.2_vue@3.5.16_typescript@5.5.4_-o76SzKsV.js";import{d as R,n as he,v as ye,f as be,c as V,a as l,J as ke,l as r,$ as d,I as u,a1 as we,o as m,H as h,K as b,F as P,Y as U,M as $,L as Ce}from"./@vue_runtime-core@3.5.16-DNpmjUA2.js";import{u as Ve}from"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-ChhaddF7.js";import{o as T,m as $e,y as z}from"./@vue_reactivity@3.5.16-fU77kzLc.js";import{O as f,p as xe}from"./@vue_shared@3.5.16-Dkxi7RdN.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vue_runtime-dom@3.5.16-DflgTdyk.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-DGup_1qK.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-BsA5SRX8.js";import"./mitt@3.0.1-C1z4c41a.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.16_typescript@5.5.4_-CF7xEUeK.js";import"./vue-router@4.5.1_vue@3.5.16_typescript@5.5.4_-BpTAww-U.js";import"./axios@1.9.0-D--XfsWq.js";import"./nprogress@0.2.0-tbY8o1C4.js";import"./dayjs@1.11.13-BIiDHjGT.js";import"./@vueuse_shared@9.13.0_vue@3.5.16_typescript@5.5.4_-CLudCabT.js";import"./@vueuse_core@9.13.0_vue@3.5.16_typescript@5.5.4_-B7bVexyo.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-BbJVLfPu.js";import"./@sxzz_popperjs-es@2.11.7-D_chPuIy.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./async-validator@4.2.5-CDKkdPIV.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-BQoi3Ox2.js";import"./@floating-ui_dom@1.7.1-Ba-2EiSn.js";import"./@floating-ui_core@1.7.1-C83JrwzW.js";import"./@floating-ui_utils@0.2.9-CBkBHzV8.js";import"./@intlify_core-base@11.1.5-rFPZQXdu.js";import"./@intlify_shared@11.1.5-CY44FrR8.js";import"./@intlify_message-compiler@11.1.5-CZ-uatfp.js";const Be={class:"plugins"},Te={class:"plugins__header"},ze={class:"plugins__container"},Ne={class:"item"},De={class:"item-inner is-add"},Oe={class:"item"},Fe={class:"item-inner"},Pe={key:0,class:"op"},Ue=["onClick"],Ee=["onClick"],We={class:"c"},qe={class:"det"},Ie={class:"tag"},Je={class:"title line-clamp-1"},Le={class:"desc line-clamp-2"},Me={class:"author"},Re={class:"f"},Ae={class:"plugins__pics"},He={class:"list"},je=["onClick"],Ye=["src"],Ge={class:"op"},Ke={class:"flex align-center mb-[10px] select-none"},Xe={class:"mr-[20px]"},Qe={class:"flex align-center"},Ze=R({name:"undefined"}),eo=R({...Ze,name:"helper-plugins-vue",setup(oo){const{router:A,service:w,refs:C,setRefs:N}=ce(),H=J.get("helper"),{t:p}=Ve(),_=T({active:"installed",p:"",list:[{label:p("已安装"),value:"installed"},{label:p("全部插件"),value:"shop"},{label:p("插件开发"),value:"dev"}],change(e){_.active=e},onChange(e){e=="dev"?(_.active=_.p||"installed",he(()=>{window.open("")})):(_.p=e,n.refresh())}}),x=ye(()=>_.active=="installed"),n=T({installed:[],shop:[],data:null,init(){n.refresh()},install(e){const o=t=>{const a=new FormData;a.append("files",e),a.append("force",String(t)),w.plugin.info.request({url:"/install",method:"POST",data:a,headers:{"Content-Type":"multipart/form-data"}}).then(c=>{if(!c){y.success(p("插件安装成功")),_.change("installed"),n.refresh();return}c.type==0&&O.confirm(c.message,p("提示"),{type:"error",showConfirmButton:!1}).then(()=>{o(!0)}).catch(()=>null),(c.type==1||c.type==2)&&O.confirm(c.message,p("提示"),{type:"warning",confirmButtonText:p("继续")}).then(()=>{o(!0)}).catch(()=>null),c.type==3&&o(!0)}).catch(c=>{y.error(c.message)})};o(!1)},remove(e,o){O.confirm(p("确定要卸载插件【{name}】吗？",{name:e.name}),p("提示"),{type:"warning"}).then(()=>{w.plugin.info.delete({ids:[e.id]}).then(()=>{n.installed.splice(o,1),y.success(p("卸载成功"))}).catch(t=>{y.error(t.message)})}).catch(()=>null)},async doc(e){e.readme?(n.data=e,C.editorPreview.open(await pe.parse(e.readme))):e.doc&&window.open(e.doc)},onEnable(e){e.isVue?w.request({url:"/__cool_updatePlugin",method:"POST",data:{name:e.name,data:e.config,enable:e.status==1},proxy:!1}):w.plugin.info.update({id:e.id,status:e.status?1:0}).then(()=>{y.success(e.status?p("启用成功"):p("禁用成功"))}).catch(o=>{y.error(o.message)})},keyWord:"",params:{page:1,size:24,isMy:!1},loaded:!1,loading:!1,async refresh(e){if(_.active=="shop"){ue(n.params,e||{});const o={keyWord:n.keyWord||void 0,...n.params};if((n.loaded||n.loading)&&o.page!=1)return;n.loading=!0,await w.request({url:`${H.options.api}/app/plugin/info/page`,method:"POST",data:o}).then(t=>{const a=t.list.map(c=>({...c,label:c.name,name:"",logo:c.avatarUrl,author:c.nickName,doc:""}));o.page==1?n.shop=a:n.shop.push(...a),n.loaded=n.shop.length>=t.pagination.total,n.params.page=t.pagination.page}).catch(t=>{y.error(t.message)}),n.loading=!1}else w.plugin.info.page({size:1e3}).then(o=>{n.installed=o.list.concat(me(J.list.filter(t=>t.type=="plugins"&&t.label),"order","desc")).map(t=>{t.author=="core"&&(t.logo="");const a=t.type=="plugins";return a?{...t,label:t.label||t.name,status:t.enable===!1?0:1,config:t.options||{},children:t.views,isVue:a}:{...t,logo:"data:image/jpg;base64,"+t.logo,label:t.name,name:t.keyName,config:t.config||{}}}).filter(t=>n.keyWord?t.label.toLocaleLowerCase().includes(n.keyWord.toLocaleLowerCase()):!0)})},onScroll:de(({scrollTop:e})=>{const{clientHeight:o,scrollHeight:t}=C.scrollbar.wrapRef;e+o>=t&&_.active=="shop"&&n.refresh({page:n.params.page+1})},100)}),S=T({insert(e){const o=C.configInput.ref,t=o.selectionStart;o.value=o.value.slice(0,t)+(e||"")+o.value.slice(t)},formatter(){var e;try{return(e=C.config)==null||e.setForm("config",JSON.stringify(JSON.parse(C.config.form.config),null,4)),!0}catch(o){return y.error(p("参数格式错误")+"："+o),!1}},onFileConfirm(e){const o=e.map(a=>a.url),t=o.length>1?JSON.stringify(o):o[0];S.insert(t)},open(e){var o;(o=C.config)==null||o.open({title:p("设置"),form:{id:e.id,config:e.config},items:[{label:p("参数"),prop:"config",component:{name:"el-input",props:{type:"textarea",rows:15},ref:N("configInput")}},{component:{name:"slot-tools"}}],on:{open(t){if(t.config||(t.config={}),L(t.config))try{t.config=JSON.parse(t.config)}catch{t.config={}}_e(t.config)&&(t.config=JSON.stringify(t.config)),S.formatter()},submit(t,{done:a,close:c}){if(!S.formatter()){a();return}w.plugin.info.update(t).then(()=>{y.success(p("修改成功")),fe(e,t),c()}).catch(B=>{y.error(B.message),a()})}}})},close(){var e;(e=C.config)==null||e.close()}}),g=T({visible:!1,title:"",active:0,tabs:[],async open(e){L(e.demo)?ge(e.demo,"http")?window.open(e.demo):A.push(e.demo):(g.visible=!0,g.active=0,g.tabs=[],g.title=e.label,g.tabs=await Promise.all((e.demo||[]).map(async o=>{if(o){const t=await(ve(o.component)?o.component():o.component);return{...o,component:$e(t.default)}}})))},close(){g.visible=!1}}),i=T({visible:!1,show:!1,index:0,list:[],preview(e){i.visible=!0,i.list=e},open(e){i.show=!0,i.index=e},close(){i.visible=!1},onClose(){i.show=!1},prev(){var e;(e=document.querySelector(".plugins__pics .list"))==null||e.scrollBy({left:-500,behavior:"smooth"})},next(){var e;(e=document.querySelector(".plugins__pics .list"))==null||e.scrollBy({left:500,behavior:"smooth"})}});function j(e){return n.install(e),!1}function Y(e){e.preventDefault()}function G(e){if(e.preventDefault(),e.dataTransfer){const o=e.dataTransfer.files[0];O.confirm(p("检测到插件，是否安装"),p("提示"),{type:"warning",confirmButtonText:p("安装")}).then(()=>{n.install(o)}).catch(()=>null)}}function K(e){if(!x.value)return!1;document.querySelectorAll(".plugins .list .item").forEach(t=>{const a=t.getBoundingClientRect(),c=e.clientX-a.left-250,B=e.clientY-a.top-250;e.type!=="scroll"&&requestAnimationFrame(()=>{t.style.setProperty("--x",`${c}px`),t.style.setProperty("--y",`${B}px`)})})}return be(()=>{n.init()}),(e,o)=>{var q,I;const t=d("cl-select-button"),a=d("cl-svg"),c=d("el-input"),B=d("cl-upload"),E=d("el-col"),X=d("cl-image"),F=d("el-tag"),Q=d("cl-switch"),D=d("el-button"),Z=d("el-row"),ee=d("el-empty"),oe=d("el-scrollbar"),te=d("el-tab-pane"),se=d("el-tabs"),W=d("cl-dialog"),ne=d("el-image-viewer"),le=d("cl-editor-preview"),ae=d("cl-upload-space"),ie=d("cl-form"),re=we("loading");return m(),V("div",Be,[l("div",Te,[r(t,{modelValue:_.active,"onUpdate:modelValue":o[0]||(o[0]=s=>_.active=s),options:_.list,onChange:_.onChange},null,8,["modelValue","options","onChange"]),r(c,{class:"search",modelValue:n.keyWord,"onUpdate:modelValue":o[1]||(o[1]=s=>n.keyWord=s),placeholder:e.$t("搜索插件名称"),clearable:"",onChange:o[2]||(o[2]=s=>n.refresh({page:1}))},{prefix:u(()=>[r(a,{name:"search",size:16})]),_:1},8,["modelValue","placeholder"])]),ke((m(),V("div",ze,[r(oe,{ref:z(N)("scrollbar"),onScroll:n.onScroll},{default:u(()=>[l("div",{class:xe(["list",{"is-installed":x.value}]),onDragover:Y,onDrop:G,onMousemove:K},[r(Z,{gutter:10},{default:u(()=>[x.value?(m(),h(E,{key:0,xs:24,sm:12,md:8,lg:6},{default:u(()=>[l("div",Ne,[r(B,{"before-upload":j,accept:".cool"},{default:u(()=>[l("div",De,[r(a,{name:"plus"})])]),_:1})])]),_:1})):b("",!0),(m(!0),V(P,null,U(n[_.active],(s,v)=>(m(),h(E,{key:v,xs:24,sm:12,md:8,lg:6},{default:u(()=>[l("div",Oe,[l("div",Fe,[x.value&&!s.isVue?(m(),V("div",Pe,[l("div",{class:"cl-comm__icon is-delete",onClick:k=>n.remove(s,v)},[r(a,{name:"delete"})],8,Ue),l("div",{class:"cl-comm__icon is-set",onClick:k=>S.open(s)},[r(a,{name:"set"})],8,Ee)])):b("",!0),l("div",We,[r(X,{class:"mr-[15px]",radius:6,src:s.logo,size:40},null,8,["src"]),l("div",qe,[l("div",Ie,[s.name?(m(),h(F,{key:0,"disable-transitions":"",size:"small",effect:"dark"},{default:u(()=>[$(f(s.name),1)]),_:2},1024)):b("",!0),r(F,{"disable-transitions":"",size:"small",effect:"plain"},{default:u(()=>[$(" v"+f(s.version||"1.0.0"),1)]),_:2},1024),x.value?(m(),h(F,{key:1,"disable-transitions":"",size:"small",effect:"plain",type:s.isVue?"success":"info"},{default:u(()=>[$(f(s.isVue?"Vue":e.$t("后端")),1)]),_:2},1032,["type"])):b("",!0)]),l("p",Je,f(s.label||e.$t("未知")),1),l("p",Le,f(s.description||e.$t("暂无描述")),1),l("div",Me,[l("span",null,f(s.author||"Ta")+"：",1),l("span",null,f(s.updateTime||"2025-01-01"),1)])])]),l("div",Re,[x.value&&(!s.isVue||s.enable!==void 0)?(m(),h(Q,{key:0,modelValue:s.status,"onUpdate:modelValue":k=>s.status=k,onChange:k=>n.onEnable(s)},null,8,["modelValue","onUpdate:modelValue","onChange"])):b("",!0),o[9]||(o[9]=l("span",{class:"mr-auto"},null,-1)),s.demo?(m(),h(D,{key:1,type:"success",onClick:k=>g.open(s)},{default:u(()=>[$(f(e.$t("示例")),1)]),_:2},1032,["onClick"])):b("",!0),z(M)(s.pics)?b("",!0):(m(),h(D,{key:2,type:"success",onClick:k=>i.preview(s.pics)},{default:u(()=>[$(f(e.$t("预览")),1)]),_:2},1032,["onClick"])),s.doc||s.readme?(m(),h(D,{key:3,onClick:k=>n.doc(s)},{default:u(()=>[$(f(e.$t("文档")),1)]),_:2},1032,["onClick"])):b("",!0)])])])]),_:2},1024))),128))]),_:1})],34),z(M)(n[_.active])?(m(),h(ee,{key:0,"image-size":80})):b("",!0)]),_:1},8,["onScroll"])])),[[re,n.loading]]),r(W,{modelValue:g.visible,"onUpdate:modelValue":o[4]||(o[4]=s=>g.visible=s),title:g.title,width:"60%"},{default:u(()=>[r(se,{modelValue:g.active,"onUpdate:modelValue":o[3]||(o[3]=s=>g.active=s),type:"card"},{default:u(()=>[(m(!0),V(P,null,U(g.tabs,(s,v)=>(m(),h(te,{key:v,label:s.name,name:v,lazy:v!=0},{default:u(()=>[(m(),h(Ce(s.component)))]),_:2},1032,["label","name","lazy"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"]),r(W,{modelValue:i.visible,"onUpdate:modelValue":o[8]||(o[8]=s=>i.visible=s),title:e.$t("图片预览"),width:"80%",padding:"0","hide-header":"",transparent:""},{default:u(()=>[l("div",Ae,[l("div",{class:"close",onClick:o[5]||(o[5]=(...s)=>i.close&&i.close(...s))},[r(a,{name:"close"})]),l("div",He,[(m(!0),V(P,null,U(i.list,(s,v)=>(m(),V("div",{class:"item",key:v,onClick:k=>i.open(v)},[l("img",{src:s},null,8,Ye)],8,je))),128))]),l("div",Ge,[l("div",{class:"prev",onClick:o[6]||(o[6]=(...s)=>i.prev&&i.prev(...s))},[r(a,{name:"left"})]),l("div",{class:"next",onClick:o[7]||(o[7]=(...s)=>i.next&&i.next(...s))},[r(a,{name:"right"})])])]),i.visible&&i.show?(m(),h(ne,{key:0,"url-list":i.list,infinite:"","initial-index":i.index,teleported:"",onClose:i.onClose},null,8,["url-list","initial-index","onClose"])):b("",!0)]),_:1},8,["modelValue","title"]),r(le,{ref:z(N)("editorPreview"),name:"wang","show-btn":!1,title:`${(q=n.data)==null?void 0:q.name}（v${(I=n.data)==null?void 0:I.version}）${e.$t("说明文档")}`},{prepend:u(()=>{var s,v;return[l("div",Ke,[l("span",Xe,f(e.$t("作者"))+"："+f((s=n.data)==null?void 0:s.author),1),l("span",null,f(e.$t("更新时间"))+"："+f((v=n.data)==null?void 0:v.updateTime),1)])]}),_:1},8,["title"]),r(ie,{ref:z(N)("config")},{"slot-tools":u(()=>[l("div",Qe,[r(D,{type:"success",onClick:S.formatter},{default:u(()=>[$(f(e.$t("格式化")),1)]),_:1},8,["onClick"]),r(ae,{"show-list":!1,text:e.$t("插入文件链接"),onConfirm:S.onFileConfirm},null,8,["text","onConfirm"])])]),_:1},512)])}}}),Uo=Se(eo,[["__scopeId","data-v-63af88f5"]]);export{Uo as default};
