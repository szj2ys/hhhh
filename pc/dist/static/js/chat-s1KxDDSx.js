import{a as O,h as de,u as S,c as ue,s as G}from"./index-DmF6C1yQ.js";import{d as $,c as _,a as p,D as Q,o as n,F as R,Y as F,l as c,$ as g,I as h,H as P,M as j,K as w,f as H,h as Y,v as Z,w as ee,J as X,a1 as me,n as pe}from"./@vue_runtime-core@3.5.16-DNpmjUA2.js";import{p as N,O as M}from"./@vue_shared@3.5.16-Dkxi7RdN.js";import{y as i,o as B,u as E}from"./@vue_reactivity@3.5.16-fU77kzLc.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./socket.io-client@4.8.1-e_HRfn2I.js";import"./store@2.0.12-BYMheg-V.js";import{d as _e}from"./dayjs@1.11.13-BIiDHjGT.js";import{u as te,a as D,b as se,c as oe,d as fe,e as ne}from"./ai-Iv5h8HLF.js";import{P as ve,Q as he,l as ye,R as ge,S as ke,a as $e,T as be}from"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-BbJVLfPu.js";import{E as A,b as ae}from"./element-plus@2.10.2_vue@3.5.16_typescript@5.5.4_-o76SzKsV.js";import{u as ie}from"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-ChhaddF7.js";import{w as W,a as we}from"./@vue_runtime-dom@3.5.16-DflgTdyk.js";import{d as xe,D as le}from"./lodash-es@4.17.21-5_SSvygx.js";import{M as Ce}from"./markdown-it@14.1.0-Djuc-qfa.js";import{R as ce,a as Ve}from"./recorder-core@1.3.25011100-BZgjjXZS.js";import{_ as Pe}from"./theme.vue_vue_type_style_index_0_lang-wMFvNdre.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-DGup_1qK.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-BsA5SRX8.js";import"./mitt@3.0.1-C1z4c41a.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.16_typescript@5.5.4_-CF7xEUeK.js";import"./vue-router@4.5.1_vue@3.5.16_typescript@5.5.4_-BpTAww-U.js";import"./axios@1.9.0-D--XfsWq.js";import"./nprogress@0.2.0-tbY8o1C4.js";import"./@vueuse_shared@9.13.0_vue@3.5.16_typescript@5.5.4_-CLudCabT.js";import"./@vueuse_core@9.13.0_vue@3.5.16_typescript@5.5.4_-B7bVexyo.js";import"./@sxzz_popperjs-es@2.11.7-D_chPuIy.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./async-validator@4.2.5-CDKkdPIV.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-BQoi3Ox2.js";import"./@floating-ui_dom@1.7.1-Ba-2EiSn.js";import"./@floating-ui_core@1.7.1-C83JrwzW.js";import"./@floating-ui_utils@0.2.9-CBkBHzV8.js";import"./@intlify_core-base@11.1.5-rFPZQXdu.js";import"./@intlify_shared@11.1.5-CY44FrR8.js";import"./@intlify_message-compiler@11.1.5-CZ-uatfp.js";import"./engine.io-client@6.6.3-C92IapQ8.js";import"./engine.io-parser@5.2.3-BiEtp6m2.js";import"./@socket.io_component-emitter@3.1.2-Dkula2eQ.js";import"./socket.io-parser@4.2.4-D4zwR6bN.js";import"./mdurl@2.0.0-k9Sl0PQj.js";import"./uc.micro@2.1.0-kMc2yuuw.js";import"./entities@4.5.0-C20TfXL6.js";import"./linkify-it@5.0.0-znNeQGaU.js";import"./punycode.js@2.3.1-Dj65hjkv.js";const Ie={class:"chat-layout"},Me={class:"chat-layout__right"},Re=$({name:"undefined"}),Se=$({...Re,name:"chat-layout",setup(m){const{app:e}=O();return(a,o)=>(n(),_("div",Ie,[p("div",{class:N(["chat-layout__left",{"is-fold":i(e).isFold}])},[Q(a.$slots,"left",{},void 0,!0)],2),p("div",Me,[Q(a.$slots,"right",{},void 0,!0)])]))}}),Le=z(Se,[["__scopeId","data-v-a6f427f3"]]),Ee="/logo-ava.png",ze={class:"chat-item"},Ue=["onClick"],Te={class:"title ellipsis-1"},Fe={class:"time"},Ne={class:"text"},Ae=$({name:"undefined"}),De=$({...Ae,name:"chat-item",setup(m){const e=te(),a=D(),o=B({isEdit:!1,del(s){if(a.execing){A.warning("生成中请等待，或者手动停止生成");return}ae.confirm("确定要删除吗？","提示",{type:"warning"}).then(()=>{var l;de(`ai.session.${((l=e.info)==null?void 0:l.roleId)||""}`,()=>{e.remove(s),A.success("删除成功")})})},chat(s){close(),a.newChat(s)}});return(s,l)=>{const v=g("el-icon");return n(),_("div",ze,[(n(!0),_(R,null,F(i(e).list,(r,d)=>(n(),_("div",{class:N(["cell",{active:r.id==i(e).sessionId}]),key:d,onClick:f=>o.chat(r)},[p("div",Te,M(r.title),1),p("div",Fe,[p("span",Ne,M(i(_e)(r.date).format("MM-DD HH:mm")),1),c(v,{class:"delete",size:14,onClick:f=>o.del(r.id)},{default:h(()=>[c(i(ve))]),_:2},1032,["onClick"])])],10,Ue))),128))])}}}),Be=$({name:"undefined"}),Oe=$({...Be,name:"user-edit",setup(m,{expose:e}){const{service:a}=S(),{user:o}=O(),{t:s}=ie(),l=E(!1);function v(){var t,y;l.value=!0,d.headImg=((t=o.info)==null?void 0:t.headImg)||"",d.nickName=((y=o.info)==null?void 0:y.nickName)||""}function r(){l.value=!1}const d=B({headImg:"",nickName:""}),f=E(!1);async function u(){f.value=!0,await a.user.info.updatePerson(d).then(()=>{A.success(s("修改成功")),o.get(),r()}).catch(t=>{A.error(t.message)}),f.value=!1}return e({open:v,close:r}),(t,y)=>{const k=g("cl-upload"),V=g("el-form-item"),C=g("el-input"),x=g("el-button"),b=g("el-form"),U=g("cl-dialog");return n(),P(U,{modelValue:l.value,"onUpdate:modelValue":y[2]||(y[2]=L=>l.value=L),title:t.$t("基本信息"),width:"500px"},{default:h(()=>[c(b,{"label-width":"100px",model:d,disabled:f.value,"label-position":"top"},{default:h(()=>[c(V,{label:t.$t("头像")},{default:h(()=>[c(k,{modelValue:d.headImg,"onUpdate:modelValue":y[0]||(y[0]=L=>d.headImg=L)},null,8,["modelValue"])]),_:1},8,["label"]),c(V,{label:t.$t("昵称")},{default:h(()=>[c(C,{modelValue:d.nickName,"onUpdate:modelValue":y[1]||(y[1]=L=>d.nickName=L),placeholder:t.$t("请填写昵称"),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),c(V,{class:"mt-[30px]"},{default:h(()=>[c(x,{type:"primary",disabled:f.value,onClick:u},{default:h(()=>[j(M(t.$t("保存修改")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["modelValue","title"])}}}),je={key:0},He={class:"chat-slider__new"},Ke={key:0,class:"mr-2"},We={class:"chat-slider__container"},Ye={class:"chat-slider__bottom"},qe={class:"topbar-user"},Je={class:"user"},Qe={class:"det"},Ge=$({name:"undefined"}),Xe=$({...Ge,name:"chat-module-left",setup(m){const{user:e,app:a}=O(),{router:o,browser:s,refs:l,setRefs:v}=S(),{t:r}=ie(),d=D();async function f(u){var t;switch(u){case"my":(t=l.userEditRefs)==null||t.open();break;case"exit":ae.confirm(r("确定退出登录吗？"),r("提示"),{type:"warning"}).then(async()=>{e.logout()}).catch(()=>null);break}}return(u,t)=>{const y=g("el-icon"),k=g("el-button"),V=g("el-scrollbar"),C=g("cl-avatar"),x=g("el-text"),b=g("cl-svg"),U=g("el-dropdown-item"),L=g("el-dropdown-menu"),K=g("el-dropdown");return n(),_(R,null,[p("div",{class:N(["chat-slider",{"is-collapse":i(a).isFold}])},[p("div",{class:"chat-slider__logo",onClick:t[0]||(t[0]=I=>i(o).push("/"))},[t[2]||(t[2]=p("img",{src:Ee},null,-1)),!i(a).isFold||i(s).isMini?(n(),_("span",je,M(i(a).info.name),1)):w("",!0)]),p("div",He,[c(k,{type:"primary",plain:"",round:"",size:i(a).isFold?"default":"large",onClick:t[1]||(t[1]=I=>i(d).newChat())},{default:h(()=>[i(a).isFold?w("",!0):(n(),_("span",Ke,"开启新对话")),c(y,null,{default:h(()=>[c(i(he))]),_:1})]),_:1},8,["size"])]),p("div",We,[i(a).isFold?w("",!0):(n(),P(V,{key:0},{default:h(()=>[c(De)]),_:1}))]),p("div",Ye,[i(e).info?(n(),P(K,{key:0,class:"topbar-user-wrap","popper-class":"topbar-user-popper","hide-on-click":"","popper-options":{},onCommand:f},{dropdown:h(()=>[p("div",Je,[c(C,{shape:"circle",size:34,src:i(e).info.headImg},null,8,["src"]),p("div",Qe,[c(x,{size:"small",tag:"p"},{default:h(()=>[j(M(i(e).info.nickName),1)]),_:1}),c(x,{size:"small",type:"info"},{default:h(()=>[j(M(i(e).info.email),1)]),_:1})])]),c(L,null,{default:h(()=>[c(U,{command:"my"},{default:h(()=>[c(b,{name:"my"}),p("span",null,M(i(r)("个人中心")),1)]),_:1}),c(U,{command:"exit"},{default:h(()=>[c(b,{name:"exit"}),p("span",null,M(i(r)("退出登录")),1)]),_:1})]),_:1})]),default:h(()=>[p("div",qe,[c(C,{shape:"circle",size:36,src:i(e).info.headImg},null,8,["src"]),i(a).isFold?w("",!0):(n(),P(x,{key:0,class:"ml-[10px]"},{default:h(()=>[j(M(i(e).info.nickName),1)]),_:1}))])]),_:1})):w("",!0)])],2),c(Oe,{ref:i(v)("userEditRefs")},null,512)],64)}}}),Ze=$({name:"undefined"}),et=$({...Ze,name:"chat-layout-bottom",setup(m){return S(),(e,a)=>Q(e.$slots,"default")}}),tt={key:0,class:"ai-icon-pause"},st={key:1,class:"ai-icon-play"},ot={class:"line"},nt=$({name:"undefined"}),at=$({...nt,props:{item:{type:Object,default:()=>({})}},setup(m){var d;const{mitt:e}=S(),a=m,o=E((d=a.item)!=null&&d.isVoice?"play":"stop"),s=xe(()=>{switch(o.value){case"stop":e.emit("voice.start",()=>{e.emit("voice.append",a.item.content),e.emit("voice.end"),e.emit("voice.play")});break;case"pause":e.emit("voice.play");break;case"play":e.emit("voice.pause");break}},300);function l(){o.value="play"}function v(){o.value="pause"}function r(){o.value="stop"}return H(()=>{e.on("sound.play",l),e.on("sound.pause",v),e.on("sound.stop",r)}),Y(()=>{e.off("sound.play",l),e.off("sound.pause",v),e.off("sound.stop",r)}),(f,u)=>m.item.content?(n(),_("div",{key:0,class:N(["sound",{"is-play":o.value!="stop","is-pause":o.value=="pause"}]),onClick:u[0]||(u[0]=W((...t)=>i(s)&&i(s)(...t),["stop"]))},[o.value=="play"?(n(),_("i",tt)):(n(),_("i",st)),p("div",ot,[(n(),_(R,null,F(10,t=>p("i",{class:"d",key:t})),64))])],2)):w("",!0)}}),it=z(at,[["__scopeId","data-v-1bf89717"]]),lt={class:"op-btns"},ct={key:0,class:"ai-icon-like-fill"},rt={key:1,class:"ai-icon-like"},dt={key:0,class:"ai-icon-like-fill"},ut={key:1,class:"ai-icon-like"},mt=$({name:"undefined"}),pt=$({...mt,props:{item:{type:Object,default:()=>({})},showSound:{type:Boolean,default:!1}},setup(m){const e=m,a=se(),o=Z(()=>{var v,r;return((v=a.last)==null?void 0:v.id)==((r=e.item)==null?void 0:r.id)});function s(v){e.item.isLike=v,A.success("点赞成功")}function l(){navigator.clipboard.writeText(e.item.content),A.success("复制成功")}return(v,r)=>(n(),_("div",lt,[o.value&&v.voicePermitted?(n(),P(it,{key:0,item:m.item},null,8,["item"])):w("",!0),m.item.isEnd!==!1?(n(),_(R,{key:1},[p("div",{class:"icon",style:{marginLeft:"auto"},onClick:r[0]||(r[0]=W(d=>s(!0),["stop"]))},[m.item.isLike===!0?(n(),_("i",ct)):(n(),_("i",rt))]),p("div",{class:"icon is-fz",onClick:r[1]||(r[1]=W(d=>s(!1),["stop"]))},[m.item.isLike===!1?(n(),_("i",dt)):(n(),_("i",ut))]),p("div",{class:"icon",onClick:r[2]||(r[2]=W(d=>l(),["stop"]))},r[3]||(r[3]=[p("i",{class:"ai-icon-copy"},null,-1)]))],64)):w("",!0)]))}}),_t=z(pt,[["__scopeId","data-v-2d916be9"]]),ft=$({name:"undefined"}),vt=$({...ft,name:"edit-preview",props:{keyName:{type:String,default:""},content:{type:String,default:""}},setup(m){const{setRefs:e}=S(),a=m,o=E("");return ee(()=>a.content,s=>{o.value=s},{immediate:!0}),(s,l)=>{const v=g("cl-editor-wang");return n(),P(v,{ref:i(e)("editor"),key:m.keyName,modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=r=>o.value=r),height:"100%",preview:"","background-color":"#eee"},null,8,["modelValue"])}}}),ht=z(vt,[["__scopeId","data-v-e8f5a35a"]]),yt={class:"avatar"},gt={class:"det"},kt={key:0,class:"loading"},$t={key:1,class:"text rich-html"},bt={key:0},wt={key:0,class:"desc"},xt={key:0,class:"tool"},Ct={style:{"margin-right":"6rpx"}},Vt={key:1,class:"think"},Pt={key:1,class:"content"},It={key:2,class:"is-stop"},Mt=$({name:"undefined"}),Rt=$({...Mt,props:{item:{type:Object,default:()=>({})}},setup(m){const e=m,a=D(),{user:o}=O(),s=Ce({typographer:!0,linkify:!0,html:!0}),l=Z(()=>{var r;return((r=e.item)==null?void 0:r.role)=="user"});function v(r){return s.render(r,{})}return H(()=>{setTimeout(()=>{e.item.isAnimation=!1},500)}),(r,d)=>{var y;const f=g("cl-avatar"),u=g("el-loading"),t=me("loading");return m.item.isShow!==!1?(n(),_("div",{key:0,class:N(["msg-item",[l.value?"r":"l",{"is-animation":m.item.isAnimation}]])},[p("div",yt,[l.value?(n(),P(f,{key:1,shape:"circle",style:{"margin-left":"12px"},size:40,src:(y=i(o).info)==null?void 0:y.headImg},null,8,["src"])):(n(),P(f,{key:0,shape:"circle",size:40,src:"/logo-ava.png"}))]),p("div",gt,[X((n(),_("div",{class:N(["inner",{"is-loading":m.item.isLoading}])},[m.item.isLoading?(n(),_("div",kt)):w("",!0),m.item.isLoading?w("",!0):(n(),_("div",$t,[l.value?(n(),_("span",bt,M(m.item.content),1)):(n(),_(R,{key:1},[i(le)(m.item.desc)?w("",!0):(n(),_("div",wt,[(n(!0),_(R,null,F(m.item.desc,(k,V)=>(n(),_(R,{key:V},[k.type=="tool"?X((n(),_("div",xt,[p("span",Ct,M(k.content),1),k.loading?(n(),P(u,{key:0,size:26})):w("",!0)])),[[t,k.loading]]):w("",!0),k.type=="think"?(n(),_("text",Vt,M(k.content),1)):w("",!0)],64))),128))])),m.item.content?(n(),_("div",Pt,[(n(),P(ht,{key:m.item.id,content:v(m.item.content)},null,8,["content"]))])):w("",!0),m.item.isStop?(n(),_("div",It,"本次回答已被终止")):w("",!0),m.item.isEnd!==!1&&!m.item.isStop?(n(),P(_t,{key:3,"show-sound":i(a).voicePermitted,item:m.item},null,8,["show-sound","item"])):w("",!0)],64))]))],2)),[[t,m.item.isLoading]])])],2)):w("",!0)}}}),St=z(Rt,[["__scopeId","data-v-cbb59b6c"]]),Lt={key:0,class:"date"},Et={class:"inner"},zt={key:0,class:"loading"},Ut={class:"box"},Tt=$({name:"undefined"}),Ft=$({...Tt,setup(m,{expose:e}){S();const a=se(),o=D(),{user:s}=O();async function l(){a.nextPage()}return e({scrollLower:l}),(v,r)=>{var u;const d=g("cl-avatar"),f=g("el-icon");return n(),_("div",{class:N(["msg-list",{}])},[(n(!0),_(R,null,F(i(a).list,t=>(n(),_("div",{key:t.id,class:"item"},[t.date?(n(),_("div",Lt,[p("span",Et,M(t.date),1)])):w("",!0),c(St,{item:t},null,8,["item"])]))),128)),i(o).execing&&i(o).loading?(n(),_("div",zt,[c(d,{shape:"circle",style:{"margin-right":"12px"},size:40,src:(u=i(s).info)==null?void 0:u.headImg},null,8,["src"]),p("div",Ut,[c(f,null,{default:h(()=>[c(i(ye),{class:"loading-icon"})]),_:1})])])):w("",!0)])}}}),Nt=z(Ft,[["__scopeId","data-v-f231d18c"]]);function At(m,e){const a=new FileReader;a.onloadend=function(){ce.Ctx.decodeAudioData(a.result,s=>{const l=s.getChannelData(0),v=s.sampleRate,r=new Int16Array(l.length);for(let f=0;f<l.length;f++){const u=Math.max(-1,Math.min(1,l[f]));r[f]=u<0?u*32768:u*32767}Ve({type:"wav",sampleRate:16e3}).mock(r,v).stop(f=>{const u=new FileReader;u.readAsArrayBuffer(f),u.onload=function(){e(u.result)}})},s=>{})},a.readAsArrayBuffer(new Blob([m],{type:"audio/mp3"}))}function Dt(m){const e=m.reduce((s,l)=>s+l.byteLength,0),a=new Uint8Array(e);let o=0;return m.forEach(s=>{const l=new Uint8Array(s);a.set(l,o),o+=s.byteLength}),a.buffer}const Bt=$({name:"undefined"}),Ot=$({...Bt,name:"voice-input",props:{isPress:{type:Boolean,default:!1}},emits:["update:isPress"],setup(m,{emit:e}){const{mitt:a}=S(),{user:o}=ue(),s=oe(),l=D(),v=m,r=e,d=ce({type:"mp3",sampleRate:16e3,takeoffEncodeChunk(I){At(I.buffer,T=>{V(T)})}}),f=B({list:[],value:"",start:"",focus:!1}),u=0;let t=[],y=!1;const k=E(!1);function V(I){v.isPress&&(t.push(I),y&&(s.send("voice.hs-asr",{key:"hs-asr",buffer:Dt(t)}),t=[]))}async function C(I){if(!o.token){o.logout();return}k.value||(s.send("voice.hs-asr",{key:"hs-asr",format:"wav",rate:16e3}),k.value=!0);const T=()=>{a.emit("voice.end",!0),a.emit("voice.stop"),f.start=f.value,f.list=[],G.get("record.permission")?r("update:isPress",!0):G.set("record.permission",!0)};d.open(function(){d.start(),T()},function(q,J){A.error(J?"用户拒绝授权麦克风":`无法录音：${q}`)})}function x(I){if(v.isPress){const[{clientY:T}]=I.touches;T<u&&K()}}function b(){v.isPress&&L()}function U(I){I.event=="ready"?y=!0:I.data&&(f.value=I.data,l.content=I.data)}function L(){if(!o.token){o.logout();return}K(),f.value&&a.emit("chat.send",f.value)}function K(){r("update:isPress",!1),d.watchDogTimer=0,d.stop(function(){d.close()},function(I){d.close()}),s.client["voice.hs-asr"].emit("end",{key:"hs-asr"}),s.client["voice.hs-asr"].emit("stop",{key:"hs-asr"})}return H(()=>{a.on("voice.hs-asr",U)}),Y(()=>{a.off("voice.hs-asr",U)}),(I,T)=>{const q=g("el-icon"),J=g("el-button"),re=g("el-tooltip");return n(),P(re,{placement:"top-start",effect:"dark",content:"语音输入"},{default:h(()=>[c(J,{type:"success",circle:"",plain:"",onMousedown:T[0]||(T[0]=ys=>C()),onMousemove:x,onMouseup:b,onMouseleave:b},{default:h(()=>[c(q,null,{default:h(()=>[c(i(ge))]),_:1})]),_:1})]),_:1})}}}),jt={class:"footer-wrap"},Ht={key:0,class:"footer-prompt"},Kt={class:"voice-in"},Wt={key:1,class:"stop-generate"},Yt={class:"footer-content"},qt={class:"input"},Jt={class:"input-wrap"},Qt={class:"files"},Gt={class:"input-btn"},Xt=$({name:"undefined"}),Zt=$({...Xt,name:"chat-send",setup(m){const{mitt:e}=S(),a=fe(),o=ne(),s=D(),l=E(!1),v=E([]),r=u=>{v.value.splice(v.value.indexOf(u),1)},d=B({data:null,change:null,set(u){d.data=u,d.change=this.data.onMessage},clear(){d.data=null},stop(){d.data=1}}),f=B({submit:async u=>{v.value=[];const t=await s.send(u);if(t){d.set(t);const y=()=>{a.invokeFlow(t.label,t.params,{isStream:!0,returnNode:!0,streamCb:k=>{f.onMessage(k)}})};o.isPlay?(e.emit("voice.end",!0),setTimeout(()=>{e.emit("voice.start",()=>{e.emit("voice.play"),y()})},1e3)):y()}},onMessage(u){var t;(t=d.change)==null||t.call(d,u),o.isPlay&&(u.isThinking||e.emit("voice.append",u.content),u.isEnd&&e.emit("voice.end")),u.isEnd&&d.clear()},stop(){a.cancelFlow(),s.stop(),e.emit("voice.end",!0),e.emit("voice.stop")}});return(u,t)=>{const y=g("el-button"),k=g("el-icon"),V=g("el-input"),C=g("el-tooltip");return n(),_("div",jt,[l.value||i(s).execing?(n(),_("div",Ht,[l.value?(n(),_(R,{key:0},[p("div",Kt,[(n(),_(R,null,F(30,x=>p("i",{class:"d",key:x})),64))]),t[5]||(t[5]=p("div",{class:"mt-1"},"滑动或松开鼠标停止说话~",-1))],64)):w("",!0),i(s).execing?(n(),_("div",Wt,[c(y,{type:"danger",plain:"",onClick:t[0]||(t[0]=x=>f.stop())},{default:h(()=>t[6]||(t[6]=[p("i",{class:"ai-icon-pause"},null,-1),p("span",{class:"ml-1"},"停止生成",-1)])),_:1,__:[6]})])):w("",!0)])):w("",!0),p("div",Yt,[p("div",qt,[p("div",Jt,[p("div",Qt,[(n(!0),_(R,null,F(v.value,x=>(n(),_("div",{key:x,class:"file-item"},[c(k,{class:"file"},{default:h(()=>[c(i(ke))]),_:1}),p("span",null,"..."+M(x.substring(x.length-16)),1),c(k,{class:"close",onClick:b=>r(x)},{default:h(()=>[c(i($e))]),_:2},1032,["onClick"])]))),128))]),c(V,{class:"textarea",modelValue:i(s).content,"onUpdate:modelValue":t[1]||(t[1]=x=>i(s).content=x),type:"textarea",rows:3,autosize:{minRows:3,maxRows:5},resize:"none",border:!1,placeholder:"请输入您想说的话",onKeyup:t[2]||(t[2]=we(x=>f.submit(),["enter"]))},null,8,["modelValue"])]),p("div",Gt,[c(C,{placement:"top-start",effect:"dark",content:"发送"},{default:h(()=>[i(s).content||!i(s).voicePermitted?(n(),P(y,{key:0,type:"primary",circle:"",plain:"",onClick:t[3]||(t[3]=x=>f.submit())},{default:h(()=>[c(k,null,{default:h(()=>[c(i(be))]),_:1})]),_:1})):w("",!0)]),_:1}),i(s).voicePermitted?(n(),P(Ot,{key:0,isPress:l.value,"onUpdate:isPress":t[4]||(t[4]=x=>l.value=x)},null,8,["isPress"])):w("",!0)])])])])}}}),es=z(Zt,[["__scopeId","data-v-afdf4bfa"]]),ts={setup(){const m=oe(),{mitt:e}=S(),a=E("stop");let o,s,l,v=!1,r=[];const d=B({n:1,base64:"",isEnd:!1,cb:void 0});function f(b){try{}catch{b&&b()}V(),o=new MediaSource,l=document.createElement("audio"),l.src=URL.createObjectURL(o),l.onended=()=>{V()},o.addEventListener("sourceopen",()=>{o&&(s||(s=o.addSourceBuffer("audio/mpeg"),s.addEventListener("updateend",()=>{C()}))),b&&b()},{once:!0})}async function u(b){b&&m.send("voice.hs-tts",{key:"hs-tts",text:b})}function t(b=!1){m.client["voice.hs-tts"].emit("end",{key:"hs-tts"}),b&&m.client["voice.hs-tts"].emit("stop",{key:"hs-tts"})}function y(){a.value="play",e.emit("sound.play"),l==null||l.play()}function k(){a.value="pause",e.emit("sound.pause"),l==null||l.pause()}function V(){r=[],a.value="stop",e.emit("sound.stop"),l&&(s==null?void 0:s.buffered.length)!=0&&l.pause(),o&&s&&o.removeSourceBuffer(s),l=null,s=null,o=null}const C=()=>{if(!(s!=null&&s.updating)){const b=r.shift();b&&(s==null||s.appendBuffer(b))}v&&le(r)&&!(s!=null&&s.updating)&&(o==null?void 0:o.readyState)!="ended"&&(o==null||o.endOfStream())};function x(b){v=b.isEnd,v||b.data&&b.data.byteLength>0&&r.push(b.data),C()}return H(()=>{e.on("voice.start",f),e.on("voice.stop",V),e.on("voice.end",t),e.on("voice.append",u),e.on("voice.play",y),e.on("voice.pause",k),e.on("voice.hs-tts",x)}),Y(()=>{e.off("voice.start",f),e.off("voice.stop",V),e.off("voice.end",t),e.off("voice.append",u),e.off("voice.play",y),e.off("voice.pause",k),e.off("voice.hs-tts",x)}),{status:a,cache:d,play:y,stop:V,pause:k,end:t,onProcess:C}}};function ss(m,e,a,o,s,l){return n(),_("div")}const os=z(ts,[["render",ss]]),ns=$({name:"undefined"}),as=$({...ns,name:"",setup(m,{expose:e}){const a=ne(),o=E(!1);function s(){o.value=!0}function l(){o.value=!1}async function v(){l()}return e({open:s,close:l}),(r,d)=>{const f=g("el-switch"),u=g("el-form-item"),t=g("el-option"),y=g("el-select"),k=g("el-button"),V=g("cl-dialog");return n(),P(V,{modelValue:o.value,"onUpdate:modelValue":d[2]||(d[2]=C=>o.value=C),title:"语音设置",width:"500px"},{default:h(()=>[c(u,{label:"自动播报"},{default:h(()=>[c(f,{modelValue:i(a).isPlay,"onUpdate:modelValue":d[0]||(d[0]=C=>i(a).isPlay=C),onChange:i(a).setPlay},null,8,["modelValue","onChange"])]),_:1}),c(u,{label:"语音风格"},{default:h(()=>[c(y,{modelValue:i(a).type,"onUpdate:modelValue":d[1]||(d[1]=C=>i(a).type=C),options:i(a).types,onChange:i(a).setType},{default:h(()=>[(n(!0),_(R,null,F(i(a).types,C=>(n(),P(t,{key:C.value,label:C.label,value:C.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","options","onChange"])]),_:1}),c(u,{class:"mt-[30px]"},{default:h(()=>[c(k,{type:"primary",onClick:v},{default:h(()=>[j(M(r.$t("关闭")),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),is={class:"page-comm"},ls={class:"chat-wrap"},cs={class:"chat-wrap__title"},rs={class:"back"},ds={style:{display:"flex"},class:"mr-[10px]"},us={key:0,class:"set"},ms={class:"chat-content"},ps={class:"chat-box"},_s={class:"chat-box__item"},fs={class:"chat-wrap__footer"},vs=$({name:"undefined"}),hs=$({...vs,name:"",setup(m){const{refs:e,setRefs:a,mitt:o}=S(),s=D(),{app:l}=O(),v=te();function r(u){const{top:t}=u;pe(()=>{var y,k;(k=(y=e.scrollbar)==null?void 0:y.wrapRef)==null||k.scroll({top:t,behavior:"smooth"})})}function d(){r({top:99999+Math.random()})}function f(){var u;(u=e.voiceSetRef)==null||u.open()}return ee(()=>{var u;return(u=v.info)==null?void 0:u.id},async()=>{d()}),H(()=>{s.init(),o.on("chat.newChat",s.init),o.on("chat.pageScroll",d)}),Y(()=>{s.destroy(),o.off("chat.newChat"),o.off("chat.pageScroll")}),(u,t)=>{const y=g("cl-svg"),k=g("el-scrollbar");return n(),_(R,null,[p("div",is,[c(Le,null,{left:h(()=>[c(Xe)]),right:h(()=>[c(et,null,{default:h(()=>[p("div",ls,[p("div",cs,[p("div",rs,[p("div",{class:"cl-comm__icon mr-[10px] size-[30px]",onClick:t[0]||(t[0]=V=>i(l).fold())},[i(l).isFold?(n(),P(y,{key:0,name:"fold"})):(n(),P(y,{key:1,name:"expand"}))]),p("span",ds,[c(Pe)])]),t[2]||(t[2]=p("span",null,"会话名称",-1)),i(s).voicePermitted?(n(),_("div",us,[p("div",{class:"cl-comm__icon size-[30px]",onClick:t[1]||(t[1]=V=>f())},[c(y,{name:"set"})])])):w("",!0)]),c(k,{class:"chat-wrap__content",ref:i(a)("scrollbar")},{default:h(()=>[p("div",ms,[p("div",ps,[p("div",_s,[c(Nt)])])])]),_:1},512),p("div",fs,[c(es)])]),c(os)]),_:1})]),_:1})]),c(as,{ref:i(a)("voiceSetRef")},null,512)],64)}}}),mo=z(hs,[["__scopeId","data-v-c5c44101"]]);export{mo as default};
