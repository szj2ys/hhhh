import{v as A,w as C}from"./@vue_runtime-dom@3.5.16-DflgTdyk.js";import{X as D,Y as L,u as F,P as J}from"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-BbJVLfPu.js";import{m as K,o as H,q as j,u as z}from"./index-DmF6C1yQ.js";import{I as O}from"./lodash-es@4.17.21-5_SSvygx.js";import{b as W}from"./@vueuse_core@12.8.2_typescript@5.5.4-DGup_1qK.js";import"./store@2.0.12-BYMheg-V.js";import{d as I,$ as w,a1 as X,c,o as i,F as P,a as u,l as v,H as g,K as h,I as b,J as S,n as Y,v as R,w as G,f as Q,a5 as Z}from"./@vue_runtime-core@3.5.16-DNpmjUA2.js";import{o as B,y as d}from"./@vue_reactivity@3.5.16-fU77kzLc.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as ee}from"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-ChhaddF7.js";import{p as U,O as $,q as te}from"./@vue_shared@3.5.16-Dkxi7RdN.js";const{options:oe}=K.get("upload"),x=oe.rules||[];function ie(e){return H(e.substring(e.indexOf("_")+1))}function se(e){return x.find(o=>o.exts.find(m=>m==j(e||"").toLocaleLowerCase()))||O(x)}function ae(e){return x.find(a=>a.type==e)||O(x)}function le(e){return se(e).type}function Oe(e){return e.map(a=>a.url.replace(/,/g,encodeURIComponent(",")))}function Se(...e){if(e.length===0)return"";const a=e[0];let o=!1;a.startsWith("http")&&(o=!0);const m=e.map(l=>l.replace(/(^\/+|\/+$)/g,""));return m.join("/")}const ne={class:"viewer-image"},re={class:"viewer-doc"},ce=["src"],ue=I({name:"undefined"}),de=I({...ue,name:"file-viewer",setup(e,{expose:a}){const{refs:o,setRefs:m}=z(),l=B({visible:!1,url:""}),s=B({visible:!1,loading:!1,url:""});function V(n){if(n!=null&&n.type){const f=n.url||"",_=le(f);if(_=="image")return l.visible=!0,l.url=f,!0;if(["word","excel","ppt","pdf"].includes(_))return s.visible=!0,s.loading=!0,s.url=`https://view.officeapps.live.com/op/view.aspx?src=${decodeURIComponent(f)}`,Y(()=>{o.docIframe.onload=()=>{s.loading=!1}}),!0;window.open(n.url)}}function y(){l.visible=!1}return a({open:V}),(n,f)=>{const _=w("el-image-viewer"),p=w("cl-dialog"),t=X("loading");return i(),c(P,null,[u("div",ne,[l.visible?(i(),g(_,{key:0,"url-list":[l.url],infinite:"",teleported:"",onClose:y},null,8,["url-list"])):h("",!0)]),v(p,{modelValue:s.visible,"onUpdate:modelValue":f[0]||(f[0]=r=>s.visible=r),title:n.$t("文档预览"),height:"70vh",width:"80%",scrollbar:!1},{default:b(()=>[S((i(),c("div",re,[u("iframe",{ref:d(m)("docIframe"),src:s.url},null,8,ce)])),[[t,s.loading]])]),_:1},8,["modelValue","title"])],64)}}}),me=T(de,[["__scopeId","data-v-ceba9158"]]),fe={class:"cl-upload-item__wrap"},pe=["src"],ve={class:"cl-upload-item__icon"},ge={class:"cl-upload-item__name"},ye=["src"],_e={class:"cl-upload-item__progress-bar"},we={class:"cl-upload-item__progress-value"},he={key:5,class:"cl-upload-item__actions"},be=I({name:"undefined"}),ke=I({...be,name:"cl-upload-item",props:{item:{type:Object,required:!0},list:{type:Array,default:()=>[]},disabled:Boolean,deletable:Boolean,showTag:{type:Boolean,default:!0}},emits:["remove"],setup(e,{emit:a}){const o=e,m=a,{refs:l,setRefs:s}=z();W();const{t:V}=ee(),y=R(()=>o.item.url||""),n=R(()=>({color:ae(o.item.type).color,name:j(o.item.name||y.value)}));function f(){m("remove",o.item)}function _(){l.viewer.open(o.item)}const p=B({isMedia:["video","audio"].includes(o.item.type),play(){o.list.forEach(t=>{t.isPlay=t.uid?o.item.uid==t.uid:o.item.id==t.id})},pause(){o.item.isPlay=!1},create(){if(!p.isMedia)return!1;let t;G(()=>o.item.isPlay,r=>{t||(t=l[o.item.type],t==null||t.addEventListener("ended",()=>{p.pause()})),r?t==null||t.play():t==null||t.pause()})}});return Q(()=>{p.create()}),(t,r)=>{const E=w("el-image"),N=w("cl-svg"),q=w("el-progress"),k=w("el-icon");return i(),c("div",fe,[(i(),g(Z,null,[u("div",{class:U(["cl-upload-item",[{"is-play":e.item.isPlay}]])},[e.item.type==="image"&&!e.item.error?(i(),g(E,{key:0,class:"cl-upload-item__image-cover",fit:"contain",src:e.item.preload||y.value,onError:r[0]||(r[0]=M=>e.item.error=t.$t("加载失败"))},null,8,["src"])):e.item.type==="video"?(i(),c("video",{ref:d(s)("video"),key:e.item.url,src:e.item.url},null,8,pe)):(i(),c(P,{key:2},[u("div",ve,[v(N,{name:e.item.type},null,8,["name"])]),u("div",ge,[u("span",null,$(d(ie)(e.item.name||y.value)),1),S(u("span",{class:"error"},$(e.item.error),513),[[A,e.item.error]])])],64)),e.item.type==="audio"?(i(),c("audio",{key:3,ref:d(s)("audio"),controls:""},[(i(),c("source",{key:e.item.url,src:e.item.url,type:"audio/mpeg"},null,8,ye))],512)):h("",!0),u("div",{class:U(["cl-upload-item__progress",{"is-show":e.item.progress>=0&&e.item.progress<100,"is-hide":e.item.progress==100}])},[u("div",_e,[v(q,{percentage:e.item.progress,"show-text":!1},null,8,["percentage"])]),u("span",we,$(e.item.progress),1)],2),e.showTag?(i(),c("span",{key:4,class:"cl-upload-item__tag",style:te({backgroundColor:n.value.color})},$(n.value.name),5)):h("",!0),y.value?(i(),c("div",he,[p.isMedia?(i(),c(P,{key:0},[e.item.isPlay?(i(),g(k,{key:0,class:"action-pause",onClick:r[1]||(r[1]=C(M=>p.pause(),["stop"]))},{default:b(()=>[v(d(D))]),_:1})):(i(),g(k,{key:1,class:"action-play",onClick:r[2]||(r[2]=C(M=>p.play(),["stop"]))},{default:b(()=>[v(d(L))]),_:1}))],64)):(i(),g(k,{key:1,class:"action-preview",onClick:C(_,["stop"])},{default:b(()=>[v(d(F))]),_:1})),!e.disabled||e.deletable?(i(),g(k,{key:2,class:"action-delete",onClick:C(f,["stop"])},{default:b(()=>[v(d(J))]),_:1})):h("",!0)])):h("",!0)],2)],1024)),v(me,{ref:d(s)("viewer")},null,512)])}}}),Ce=T(ke,[["__scopeId","data-v-7196e363"]]),Te=Object.freeze(Object.defineProperty({__proto__:null,default:Ce},Symbol.toStringTag,{value:"Module"}));export{Ce as U,le as a,Oe as g,Te as i,Se as p};
