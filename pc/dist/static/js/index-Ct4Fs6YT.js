import{a as H}from"./@vue_runtime-dom@3.5.16-DflgTdyk.js";import{_ as N}from"./logo-iRe2WRm5.js";import{u as B,a as P,s as x}from"./index-DmF6C1yQ.js";import{l as D}from"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-BbJVLfPu.js";import"./store@2.0.12-BYMheg-V.js";import{u as M}from"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-ChhaddF7.js";import{b as w,E as C}from"./element-plus@2.10.2_vue@3.5.16_typescript@5.5.4_-o76SzKsV.js";import{d as v,f as K,c as _,o as u,H as z,I as m,l as a,$ as c,a as l,M as O}from"./@vue_runtime-core@3.5.16-DNpmjUA2.js";import{u as $,y as k,o as R}from"./@vue_reactivity@3.5.16-fU77kzLc.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{O as I}from"./@vue_shared@3.5.16-Dkxi7RdN.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-DGup_1qK.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-BsA5SRX8.js";import"./lodash-es@4.17.21-5_SSvygx.js";import"./mitt@3.0.1-C1z4c41a.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.16_typescript@5.5.4_-CF7xEUeK.js";import"./vue-router@4.5.1_vue@3.5.16_typescript@5.5.4_-BpTAww-U.js";import"./axios@1.9.0-D--XfsWq.js";import"./nprogress@0.2.0-tbY8o1C4.js";import"./dayjs@1.11.13-BIiDHjGT.js";import"./@vueuse_shared@9.13.0_vue@3.5.16_typescript@5.5.4_-CLudCabT.js";import"./@vueuse_core@9.13.0_vue@3.5.16_typescript@5.5.4_-B7bVexyo.js";import"./@sxzz_popperjs-es@2.11.7-D_chPuIy.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./async-validator@4.2.5-CDKkdPIV.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-BQoi3Ox2.js";import"./@floating-ui_dom@1.7.1-Ba-2EiSn.js";import"./@floating-ui_core@1.7.1-C83JrwzW.js";import"./@floating-ui_utils@0.2.9-CBkBHzV8.js";import"./@intlify_core-base@11.1.5-rFPZQXdu.js";import"./@intlify_shared@11.1.5-CY44FrR8.js";import"./@intlify_message-compiler@11.1.5-CZ-uatfp.js";const S=["innerHTML"],j=["src"],q=v({name:"undefined"}),A=v({...q,name:"pic-captcha",emits:["update:modelValue","change"],setup(E,{expose:g,emit:h}){const f=h,{service:y}=B(),{t:d}=M(),r=$(""),s=$("");async function n(){s.value="",r.value="",await y.user.login.captcha({height:45,width:150,color:"#2c3142"}).then(({captchaId:e,data:i})=>{i?(i.includes(";base64,")?r.value=i:s.value=i,f("update:modelValue",e),f("change",{base64:r,svg:s,captchaId:e})):w.alert(d("验证码获取失败"),{title:d("提示"),type:"error"})}).catch(e=>{w.alert(e.message,{title:d("提示"),type:"error"})})}return K(()=>{n()}),g({refresh:n}),(e,i)=>{const t=c("el-icon");return u(),_("div",{class:"pic-captcha",onClick:n},[s.value?(u(),_("div",{key:0,class:"svg",innerHTML:s.value},null,8,S)):r.value?(u(),_("img",{key:1,class:"base64",src:r.value,alt:""},null,8,j)):(u(),z(t,{key:2,class:"is-loading",size:18},{default:m(()=>[a(k(D))]),_:1}))])}}}),F=T(A,[["__scopeId","data-v-21401727"]]),G={class:"page-login"},J={class:"box"},Q={class:"logo"},W={class:"form"},X={class:"op"},Y=v({name:"undefined"}),Z=v({...Y,name:"login",setup(E){const{refs:g,setRefs:h,router:f,service:y}=B(),{user:d,app:r}=P(),{t:s}=M(),n=$(!1),e=R({username:x.get("username")||"",password:"",captchaId:"",verifyCode:""});async function i(){if(!e.username)return C.error(s("用户名不能为空"));if(!e.password)return C.error(s("密码不能为空"));if(!e.verifyCode)return C.error(s("图片验证码不能为空"));n.value=!0;try{await y.user.login.username(e).then(d.setToken),await Promise.all(r.events.hasToken.map(t=>t())),x.set("username",e.username),f.push("/")}catch(t){g.picCaptcha.refresh(),w.alert(t.message,{title:s("提示"),type:"error"})}n.value=!1}return(t,o)=>{const b=c("el-input"),V=c("el-form-item"),L=c("el-button"),U=c("el-form");return u(),_("div",G,[l("div",J,[l("div",Q,[o[5]||(o[5]=l("div",{class:"icon"},[l("img",{src:N,alt:"Logo"})],-1)),l("span",null,I(k(r).info.name),1)]),l("div",W,[a(U,{"label-position":"top",class:"form",disabled:n.value},{default:m(()=>[a(V,{label:t.$t("用户名")},{default:m(()=>[a(b,{modelValue:e.username,"onUpdate:modelValue":o[0]||(o[0]=p=>e.username=p),placeholder:t.$t("请输入用户名"),maxlength:"20"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(V,{label:t.$t("密码")},{default:m(()=>[a(b,{modelValue:e.password,"onUpdate:modelValue":o[1]||(o[1]=p=>e.password=p),type:"password",placeholder:t.$t("请输入密码"),maxlength:"20","show-password":"",autocomplete:"new-password"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(V,{label:t.$t("验证码")},{default:m(()=>[a(b,{modelValue:e.verifyCode,"onUpdate:modelValue":o[4]||(o[4]=p=>e.verifyCode=p),placeholder:t.$t("验证码"),maxlength:"4",onKeyup:H(i,["enter"])},{suffix:m(()=>[a(F,{ref:k(h)("picCaptcha"),modelValue:e.captchaId,"onUpdate:modelValue":o[2]||(o[2]=p=>e.captchaId=p),onChange:o[3]||(o[3]=()=>{e.verifyCode=""})},null,8,["modelValue"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l("div",X,[a(L,{type:"primary",loading:n.value,onClick:i},{default:m(()=>[O(I(t.$t("登录")),1)]),_:1},8,["loading"])])]),_:1},8,["disabled"])])]),o[6]||(o[6]=l("div",{class:"bg"},null,-1)),o[7]||(o[7]=l("a",{href:"",class:"copyright"}," Copyright © 厦钨IPD ",-1))])}}}),Ue=T(Z,[["__scopeId","data-v-6145e059"]]);export{Ue as default};
