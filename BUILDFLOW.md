# 项目构建流程文档

## 项目概述
本项目是一个基于 MidwayJS 和 TypeORM 的服务端项目，支持多租户功能。以下按照文件创建的先后顺序梳理每个文件的来源与功能。

## 文件构建流程

### 1. 项目初始化文件
#### `package.json`
- **来源**：项目初始化时由 `npm init` 或 `yarn init` 生成，后续开发过程中添加依赖和脚本。
- **功能**：定义项目的元数据、依赖项和脚本命令，是项目的核心配置文件。

### 2. 配置文件
#### `src/config/config.default.ts`
- **来源**：MidwayJS 项目初始化时自动生成，开发者根据需求进行配置。
- **功能**：项目的默认配置文件，包含数据库连接、中间件、多租户等配置信息。

### 3. 工具类文件
#### `src/comm/utils.ts`
- **来源**：开发者创建，用于存放通用工具函数。
- **功能**：提供一些通用的工具函数，如 URL 匹配、数据处理等。

### 4. 实体文件
#### `src/modules/demo/entity/goods.ts`
- **来源**：开发者根据业务需求创建，用于定义数据库表结构。
- **功能**：使用 TypeORM 定义商品表的实体类，包含商品的属性和关联关系。

### 5. 服务类文件
#### `src/modules/demo/service/tenant.ts`
- **来源**：开发者创建，用于处理业务逻辑。
- **功能**：提供商品相关的业务逻辑，如商品查询、添加、更新等操作，同时使用 `noTenant` 函数处理多租户逻辑。

### 6. 数据库订阅者文件
#### `src/modules/base/db/tenant.ts`
- **来源**：开发者创建，用于处理多租户相关的数据库操作。
- **功能**：实现 `EntitySubscriberInterface` 接口，在数据库查询、插入、更新、删除操作时自动添加租户 ID 条件，确保数据的隔离性。

### 7. 路由文件
#### `src/modules/demo/controller/goods.ts`
- **来源**：开发者创建，用于定义 API 路由。
- **功能**：处理商品相关的 API 请求，调用服务类的方法完成业务逻辑，并返回响应结果。

## 构建命令
### 开发环境
```bash
npm run dev
```
### 生产环境
```bash
npm run build
npm start
```

## 总结
通过以上步骤，项目从初始化开始，逐步添加配置文件、工具类、实体类、服务类、数据库订阅者和路由文件，最终构建出一个支持多租户功能的服务端项目。