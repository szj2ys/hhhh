import{T as d,N as p,I as wt,P as tt,b as L,c as I,d as vt}from"./@lezer_common@1.2.3-CP7NCNqd.js";import{F as v,g as yt,j as C,P as bt,k as Pt,a as St,S as Tt}from"./@codemirror_state@6.5.2-DQ6R6BiX.js";import{E as D,V as et,a as N,l as xt,D as G}from"./@codemirror_view@6.37.1-Bd3_Yh4F.js";import{a as At,h as It,t as Ct,s as Dt}from"./@lezer_highlight@1.2.1-DwVMghhY.js";import{S as J}from"./style-mod@4.1.2-Bc2inJdb.js";var E;const k=new p;function nt(i){return v.define({combine:i?t=>t.concat(i):void 0})}const Nt=new p;class c{constructor(t,e,n=[],s=""){this.data=t,this.name=s,C.prototype.hasOwnProperty("tree")||Object.defineProperty(C.prototype,"tree",{get(){return w(this)}}),this.parser=e,this.extension=[T.of(this),C.languageData.of((r,o,l)=>{let a=K(r,o,l),h=a.type.prop(k);if(!h)return[];let u=r.facet(h),f=a.type.prop(Nt);if(f){let m=a.resolve(o-a.from,l);for(let g of f)if(g.test(m,r)){let y=r.facet(g.facet);return g.type=="replace"?y:y.concat(u)}}return u})].concat(n)}isActiveAt(t,e,n=-1){return K(t,e,n).type.prop(k)==this.data}findRegions(t){let e=t.facet(T);if((e==null?void 0:e.data)==this.data)return[{from:0,to:t.doc.length}];if(!e||!e.allowsNesting)return[];let n=[],s=(r,o)=>{if(r.prop(k)==this.data){n.push({from:o,to:o+r.length});return}let l=r.prop(p.mounted);if(l){if(l.tree.prop(k)==this.data){if(l.overlay)for(let a of l.overlay)n.push({from:a.from+o,to:a.to+o});else n.push({from:o,to:o+r.length});return}else if(l.overlay){let a=n.length;if(s(l.tree,l.overlay[0].from+o),n.length>a)return}}for(let a=0;a<r.children.length;a++){let h=r.children[a];h instanceof d&&s(h,r.positions[a]+o)}};return s(w(t),0),n}get allowsNesting(){return!0}}c.setState=St.define();function K(i,t,e){let n=i.facet(T),s=w(i).topNode;if(!n||n.allowsNesting)for(let r=s;r;r=r.enter(t,e,wt.ExcludeBuffers))r.type.isTop&&(s=r);return s}class H extends c{constructor(t,e,n){super(t,e,[],n),this.parser=e}static define(t){let e=nt(t.languageData);return new H(e,t.parser.configure({props:[k.add(n=>n.isTop?e:void 0)]}),t.name)}configure(t,e){return new H(this.data,this.parser.configure(t),e||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function w(i){let t=i.field(c.state,!1);return t?t.tree:d.empty}class Bt{constructor(t){this.doc=t,this.cursorPos=0,this.string="",this.cursor=t.iter()}get length(){return this.doc.length}syncTo(t){return this.string=this.cursor.next(t-this.cursorPos).value,this.cursorPos=t+this.string.length,this.cursorPos-this.string.length}chunk(t){return this.syncTo(t),this.string}get lineChunks(){return!0}read(t,e){let n=this.cursorPos-this.string.length;return t<n||e>=this.cursorPos?this.doc.sliceString(t,e):this.string.slice(t-n,e-n)}}let x=null;class P{constructor(t,e,n=[],s,r,o,l,a){this.parser=t,this.state=e,this.fragments=n,this.tree=s,this.treeLen=r,this.viewport=o,this.skipped=l,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(t,e,n){return new P(t,e,[],d.empty,0,n,[],null)}startParse(){return this.parser.startParse(new Bt(this.state.doc),this.fragments)}work(t,e){return e!=null&&e>=this.state.doc.length&&(e=void 0),this.tree!=d.empty&&this.isDone(e??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var n;if(typeof t=="number"){let s=Date.now()+t;t=()=>Date.now()>s}for(this.parse||(this.parse=this.startParse()),e!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&e<this.state.doc.length&&this.parse.stopAt(e);;){let s=this.parse.advance();if(s)if(this.fragments=this.withoutTempSkipped(I.addTree(s,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(n=this.parse.stoppedAt)!==null&&n!==void 0?n:this.state.doc.length,this.tree=s,this.parse=null,this.treeLen<(e??this.state.doc.length))this.parse=this.startParse();else return!0;if(t())return!1}})}takeTree(){let t,e;this.parse&&(t=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&this.parse.stopAt(t),this.withContext(()=>{for(;!(e=this.parse.advance()););}),this.treeLen=t,this.tree=e,this.fragments=this.withoutTempSkipped(I.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(t){let e=x;x=this;try{return t()}finally{x=e}}withoutTempSkipped(t){for(let e;e=this.tempSkipped.pop();)t=Q(t,e.from,e.to);return t}changes(t,e){let{fragments:n,tree:s,treeLen:r,viewport:o,skipped:l}=this;if(this.takeTree(),!t.empty){let a=[];if(t.iterChangedRanges((h,u,f,m)=>a.push({fromA:h,toA:u,fromB:f,toB:m})),n=I.applyChanges(n,a),s=d.empty,r=0,o={from:t.mapPos(o.from,-1),to:t.mapPos(o.to,1)},this.skipped.length){l=[];for(let h of this.skipped){let u=t.mapPos(h.from,1),f=t.mapPos(h.to,-1);u<f&&l.push({from:u,to:f})}}}return new P(this.parser,e,n,s,r,o,l,this.scheduleOn)}updateViewport(t){if(this.viewport.from==t.from&&this.viewport.to==t.to)return!1;this.viewport=t;let e=this.skipped.length;for(let n=0;n<this.skipped.length;n++){let{from:s,to:r}=this.skipped[n];s<t.to&&r>t.from&&(this.fragments=Q(this.fragments,s,r),this.skipped.splice(n--,1))}return this.skipped.length>=e?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(t,e){this.skipped.push({from:t,to:e})}static getSkippingParser(t){return new class extends tt{createParse(e,n,s){let r=s[0].from,o=s[s.length-1].to;return{parsedPos:r,advance(){let a=x;if(a){for(let h of s)a.tempSkipped.push(h);t&&(a.scheduleOn=a.scheduleOn?Promise.all([a.scheduleOn,t]):t)}return this.parsedPos=o,new d(L.none,[],[],o-r)},stoppedAt:null,stopAt(){}}}}}isDone(t){t=Math.min(t,this.state.doc.length);let e=this.fragments;return this.treeLen>=t&&e.length&&e[0].from==0&&e[0].to>=t}static get(){return x}}function Q(i,t,e){return I.applyChanges(i,[{fromA:t,toA:e,fromB:t,toB:e}])}class S{constructor(t){this.context=t,this.tree=t.tree}apply(t){if(!t.docChanged&&this.tree==this.context.tree)return this;let e=this.context.changes(t.changes,t.state),n=this.context.treeLen==t.startState.doc.length?void 0:Math.max(t.changes.mapPos(this.context.treeLen),e.viewport.to);return e.work(20,n)||e.takeTree(),new S(e)}static init(t){let e=Math.min(3e3,t.doc.length),n=P.create(t.facet(T).parser,t,{from:0,to:e});return n.work(20,e)||n.takeTree(),new S(n)}}c.state=Tt.define({create:S.init,update(i,t){for(let e of t.effects)if(e.is(c.setState))return e.value;return t.startState.facet(T)!=t.state.facet(T)?S.init(t.state):i.apply(t)}});let st=i=>{let t=setTimeout(()=>i(),500);return()=>clearTimeout(t)};typeof requestIdleCallback<"u"&&(st=i=>{let t=-1,e=setTimeout(()=>{t=requestIdleCallback(i,{timeout:400})},100);return()=>t<0?clearTimeout(e):cancelIdleCallback(t)});const M=typeof navigator<"u"&&(!((E=navigator.scheduling)===null||E===void 0)&&E.isInputPending)?()=>navigator.scheduling.isInputPending():null,Lt=et.fromClass(class{constructor(t){this.view=t,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(t){let e=this.view.state.field(c.state).context;(e.updateViewport(t.view.viewport)||this.view.viewport.to>e.treeLen)&&this.scheduleWork(),(t.docChanged||t.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(e)}scheduleWork(){if(this.working)return;let{state:t}=this.view,e=t.field(c.state);(e.tree!=e.context.tree||!e.context.isDone(t.doc.length))&&(this.working=st(this.work))}work(t){this.working=null;let e=Date.now();if(this.chunkEnd<e&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=e+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:n,viewport:{to:s}}=this.view,r=n.field(c.state);if(r.tree==r.context.tree&&r.context.isDone(s+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,t&&!M?Math.max(25,t.timeRemaining()-5):1e9),l=r.context.treeLen<s&&n.doc.length>s+1e3,a=r.context.work(()=>M&&M()||Date.now()>o,s+(l?0:1e5));this.chunkBudget-=Date.now()-e,(a||this.chunkBudget<=0)&&(r.context.takeTree(),this.view.dispatch({effects:c.setState.of(new S(r.context))})),this.chunkBudget>0&&!(a&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(r.context)}checkAsyncSchedule(t){t.scheduleOn&&(this.workScheduled++,t.scheduleOn.then(()=>this.scheduleWork()).catch(e=>xt(this.view.state,e)).then(()=>this.workScheduled--),t.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),T=v.define({combine(i){return i.length?i[0]:null},enables:i=>[c.state,Lt,D.contentAttributes.compute([i],t=>{let e=t.facet(i);return e&&e.name?{"data-language":e.name}:{}})]});class ae{constructor(t,e=[]){this.language=t,this.support=e,this.extension=[t,e]}}class it{constructor(t,e,n,s,r,o=void 0){this.name=t,this.alias=e,this.extensions=n,this.filename=s,this.loadFunc=r,this.support=o,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then(t=>this.support=t,t=>{throw this.loading=null,t}))}static of(t){let{load:e,support:n}=t;if(!e){if(!n)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");e=()=>Promise.resolve(n)}return new it(t.name,(t.alias||[]).concat(t.name).map(s=>s.toLowerCase()),t.extensions||[],t.filename,e,n)}static matchFilename(t,e){for(let s of t)if(s.filename&&s.filename.test(e))return s;let n=/\.([^.]+)$/.exec(e);if(n){for(let s of t)if(s.extensions.indexOf(n[1])>-1)return s}return null}static matchLanguageName(t,e,n=!0){e=e.toLowerCase();for(let s of t)if(s.alias.some(r=>r==e))return s;if(n)for(let s of t)for(let r of s.alias){let o=e.indexOf(r);if(o>-1&&(r.length>2||!/\w/.test(e[o-1])&&!/\w/.test(e[o+r.length])))return s}return null}}const Ot=v.define(),rt=v.define({combine:i=>{if(!i.length)return"  ";let t=i[0];if(!t||/\S/.test(t)||Array.from(t).some(e=>e!=t[0]))throw new Error("Invalid indent unit: "+JSON.stringify(i[0]));return t}});function B(i){let t=i.facet(rt);return t.charCodeAt(0)==9?i.tabSize*t.length:t.length}function le(i,t){let e="",n=i.tabSize,s=i.facet(rt)[0];if(s=="	"){for(;t>=n;)e+="	",t-=n;s=" "}for(let r=0;r<t;r++)e+=s;return e}function he(i,t){i instanceof C&&(i=new ot(i));for(let n of i.state.facet(Ot)){let s=n(i,t);if(s!==void 0)return s}let e=w(i.state);return e.length>=t?Et(i,e,t):null}class ot{constructor(t,e={}){this.state=t,this.options=e,this.unit=B(t)}lineAt(t,e=1){let n=this.state.doc.lineAt(t),{simulateBreak:s,simulateDoubleBreak:r}=this.options;return s!=null&&s>=n.from&&s<=n.to?r&&s==t?{text:"",from:t}:(e<0?s<t:s<=t)?{text:n.text.slice(s-n.from),from:s}:{text:n.text.slice(0,s-n.from),from:n.from}:n}textAfterPos(t,e=1){if(this.options.simulateDoubleBreak&&t==this.options.simulateBreak)return"";let{text:n,from:s}=this.lineAt(t,e);return n.slice(t-s,Math.min(n.length,t+100-s))}column(t,e=1){let{text:n,from:s}=this.lineAt(t,e),r=this.countColumn(n,t-s),o=this.options.overrideIndentation?this.options.overrideIndentation(s):-1;return o>-1&&(r+=o-this.countColumn(n,n.search(/\S|$/))),r}countColumn(t,e=t.length){return yt(t,this.state.tabSize,e)}lineIndent(t,e=1){let{text:n,from:s}=this.lineAt(t,e),r=this.options.overrideIndentation;if(r){let o=r(s);if(o>-1)return o}return this.countColumn(n,n.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const at=new p;function Et(i,t,e){let n=t.resolveStack(e),s=t.resolveInner(e,-1).resolve(e,0).enterUnfinishedNodesBefore(e);if(s!=n.node){let r=[];for(let o=s;o&&!(o.from<n.node.from||o.to>n.node.to||o.from==n.node.from&&o.type==n.node.type);o=o.parent)r.push(o);for(let o=r.length-1;o>=0;o--)n={node:r[o],next:n}}return lt(n,i,e)}function lt(i,t,e){for(let n=i;n;n=n.next){let s=Ft(n.node);if(s)return s(U.create(t,e,n))}return 0}function Mt(i){return i.pos==i.options.simulateBreak&&i.options.simulateDoubleBreak}function Ft(i){let t=i.type.prop(at);if(t)return t;let e=i.firstChild,n;if(e&&(n=e.type.prop(p.closedBy))){let s=i.lastChild,r=s&&n.indexOf(s.name)>-1;return o=>ht(o,!0,1,void 0,r&&!Mt(o)?s.from:void 0)}return i.parent==null?Rt:null}function Rt(){return 0}class U extends ot{constructor(t,e,n){super(t.state,t.options),this.base=t,this.pos=e,this.context=n}get node(){return this.context.node}static create(t,e,n){return new U(t,e,n)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(t){let e=this.state.doc.lineAt(t.from);for(;;){let n=t.resolve(e.from);for(;n.parent&&n.parent.from==n.from;)n=n.parent;if(Ht(n,t))break;e=this.state.doc.lineAt(n.from)}return this.lineIndent(e.from)}continue(){return lt(this.context.next,this.base,this.pos)}}function Ht(i,t){for(let e=t;e;e=e.parent)if(i==e)return!0;return!1}function Wt(i){let t=i.node,e=t.childAfter(t.from),n=t.lastChild;if(!e)return null;let s=i.options.simulateBreak,r=i.state.doc.lineAt(e.from),o=s==null||s<=r.from?r.to:Math.min(r.to,s);for(let l=e.to;;){let a=t.childAfter(l);if(!a||a==n)return null;if(!a.type.isSkipped){if(a.from>=o)return null;let h=/^ */.exec(r.text.slice(e.to-r.from))[0].length;return{from:e.from,to:e.to+h}}l=a.to}}function ue({closing:i,align:t=!0,units:e=1}){return n=>ht(n,t,e,i)}function ht(i,t,e,n,s){let r=i.textAfter,o=r.match(/^\s*/)[0].length,l=n&&r.slice(o,o+n.length)==n||s==i.pos+o,a=t?Wt(i):null;return a?l?i.column(a.from):i.column(a.to):i.baseIndent+(l?0:i.unit*e)}const fe=i=>i.baseIndent;function de({except:i,units:t=1}={}){return e=>{let n=i&&i.test(e.textAfter);return e.baseIndent+(n?0:t*e.unit)}}const ce=v.define(),pe=new p;function ge(i){let t=i.firstChild,e=i.lastChild;return t&&t.to<e.from?{from:t.to,to:e.type.isError?i.to:e.from}:null}class z{constructor(t,e){this.specs=t;let n;function s(l){let a=J.newName();return(n||(n=Object.create(null)))["."+a]=l,a}const r=typeof e.all=="string"?e.all:e.all?s(e.all):void 0,o=e.scope;this.scope=o instanceof c?l=>l.prop(k)==o.data:o?l=>l==o:void 0,this.style=At(t.map(l=>({tag:l.tag,class:l.class||s(Object.assign({},l,{tag:null}))})),{all:r}).style,this.module=n?new J(n):null,this.themeType=e.themeType}static define(t,e){return new z(t,e||{})}}const W=v.define(),jt=v.define({combine(i){return i.length?[i[0]]:null}});function F(i){let t=i.facet(W);return t.length?t:i.facet(jt)}function me(i,t){let e=[Ut],n;return i instanceof z&&(i.module&&e.push(D.styleModule.of(i.module)),n=i.themeType),n?e.push(W.computeN([D.darkTheme],s=>s.facet(D.darkTheme)==(n=="dark")?[i]:[])):e.push(W.of(i)),e}class Vt{constructor(t){this.markCache=Object.create(null),this.tree=w(t.state),this.decorations=this.buildDeco(t,F(t.state)),this.decoratedTo=t.viewport.to}update(t){let e=w(t.state),n=F(t.state),s=n!=F(t.startState),{viewport:r}=t.view,o=t.changes.mapPos(this.decoratedTo,1);e.length<r.to&&!s&&e.type==this.tree.type&&o>=r.to?(this.decorations=this.decorations.map(t.changes),this.decoratedTo=o):(e!=this.tree||t.viewportChanged||s)&&(this.tree=e,this.decorations=this.buildDeco(t.view,n),this.decoratedTo=r.to)}buildDeco(t,e){if(!e||!this.tree.length)return N.none;let n=new Pt;for(let{from:s,to:r}of t.visibleRanges)It(this.tree,e,(o,l,a)=>{n.add(o,l,this.markCache[a]||(this.markCache[a]=N.mark({class:a})))},s,r);return n.finish()}}const Ut=bt.high(et.fromClass(Vt,{decorations:i=>i.decorations})),zt=1e4,$t="()[]{}",qt=new p;function j(i,t,e){let n=i.prop(t<0?p.openedBy:p.closedBy);if(n)return n;if(i.name.length==1){let s=e.indexOf(i.name);if(s>-1&&s%2==(t<0?1:0))return[e[s+t]]}return null}function V(i){let t=i.type.prop(qt);return t?t(i.node):i}function ke(i,t,e,n={}){let s=n.maxScanDistance||zt,r=n.brackets||$t,o=w(i),l=o.resolveInner(t,e);for(let a=l;a;a=a.parent){let h=j(a.type,e,r);if(h&&a.from<a.to){let u=V(a);if(u&&(e>0?t>=u.from&&t<u.to:t>u.from&&t<=u.to))return Gt(i,t,e,a,u,h,r)}}return Jt(i,t,e,o,l.type,s,r)}function Gt(i,t,e,n,s,r,o){let l=n.parent,a={from:s.from,to:s.to},h=0,u=l==null?void 0:l.cursor();if(u&&(e<0?u.childBefore(n.from):u.childAfter(n.to)))do if(e<0?u.to<=n.from:u.from>=n.to){if(h==0&&r.indexOf(u.type.name)>-1&&u.from<u.to){let f=V(u);return{start:a,end:f?{from:f.from,to:f.to}:void 0,matched:!0}}else if(j(u.type,e,o))h++;else if(j(u.type,-e,o)){if(h==0){let f=V(u);return{start:a,end:f&&f.from<f.to?{from:f.from,to:f.to}:void 0,matched:!1}}h--}}while(e<0?u.prevSibling():u.nextSibling());return{start:a,matched:!1}}function Jt(i,t,e,n,s,r,o){let l=e<0?i.sliceDoc(t-1,t):i.sliceDoc(t,t+1),a=o.indexOf(l);if(a<0||a%2==0!=e>0)return null;let h={from:e<0?t-1:t,to:e>0?t+1:t},u=i.doc.iterRange(t,e>0?i.doc.length:0),f=0;for(let m=0;!u.next().done&&m<=r;){let g=u.value;e<0&&(m+=g.length);let y=t+m*e;for(let b=e>0?0:g.length-1,kt=e>0?g.length:-1;b!=kt;b+=e){let O=o.indexOf(g[b]);if(!(O<0||n.resolveInner(y+b,1).type!=s))if(O%2==0==e>0)f++;else{if(f==1)return{start:h,end:{from:y+b,to:y+b+1},matched:O>>1==a>>1};f--}}e>0&&(m+=g.length)}return u.done?{start:h,matched:!1}:null}function X(i,t,e,n=0,s=0){t==null&&(t=i.search(/[^\s\u00a0]/),t==-1&&(t=i.length));let r=s;for(let o=n;o<t;o++)i.charCodeAt(o)==9?r+=e-r%e:r++;return r}class ut{constructor(t,e,n,s){this.string=t,this.tabSize=e,this.indentUnit=n,this.overrideIndent=s,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return this.pos==0}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(t){let e=this.string.charAt(this.pos),n;if(typeof t=="string"?n=e==t:n=e&&(t instanceof RegExp?t.test(e):t(e)),n)return++this.pos,e}eatWhile(t){let e=this.pos;for(;this.eat(t););return this.pos>e}eatSpace(){let t=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t}skipToEnd(){this.pos=this.string.length}skipTo(t){let e=this.string.indexOf(t,this.pos);if(e>-1)return this.pos=e,!0}backUp(t){this.pos-=t}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=X(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){var t;return(t=this.overrideIndent)!==null&&t!==void 0?t:X(this.string,null,this.tabSize)}match(t,e,n){if(typeof t=="string"){let s=o=>n?o.toLowerCase():o,r=this.string.substr(this.pos,t.length);return s(r)==s(t)?(e!==!1&&(this.pos+=t.length),!0):null}else{let s=this.string.slice(this.pos).match(t);return s&&s.index>0?null:(s&&e!==!1&&(this.pos+=s[0].length),s)}}current(){return this.string.slice(this.start,this.pos)}}function Kt(i){return{name:i.name||"",token:i.token,blankLine:i.blankLine||(()=>{}),startState:i.startState||(()=>!0),copyState:i.copyState||Qt,indent:i.indent||(()=>null),languageData:i.languageData||{},tokenTable:i.tokenTable||q,mergeTokens:i.mergeTokens!==!1}}function Qt(i){if(typeof i!="object")return i;let t={};for(let e in i){let n=i[e];t[e]=n instanceof Array?n.slice():n}return t}const Y=new WeakMap;class ft extends c{constructor(t){let e=nt(t.languageData),n=Kt(t),s,r=new class extends tt{createParse(o,l,a){return new Yt(s,o,l,a)}};super(e,r,[],t.name),this.topNode=te(e,this),s=this,this.streamParser=n,this.stateAfter=new p({perNode:!0}),this.tokenTable=t.tokenTable?new gt(n.tokenTable):_t}static define(t){return new ft(t)}getIndent(t){let e,{overrideIndentation:n}=t.options;n&&(e=Y.get(t.state),e!=null&&e<t.pos-1e4&&(e=void 0));let s=$(this,t.node.tree,t.node.from,t.node.from,e??t.pos),r,o;if(s?(o=s.state,r=s.pos+1):(o=this.streamParser.startState(t.unit),r=t.node.from),t.pos-r>1e4)return null;for(;r<t.pos;){let a=t.state.doc.lineAt(r),h=Math.min(t.pos,a.to);if(a.length){let u=n?n(a.from):-1,f=new ut(a.text,t.state.tabSize,t.unit,u<0?void 0:u);for(;f.pos<h-a.from;)ct(this.streamParser.token,f,o)}else this.streamParser.blankLine(o,t.unit);if(h==t.pos)break;r=a.to+1}let l=t.lineAt(t.pos);return n&&e==null&&Y.set(t.state,l.from),this.streamParser.indent(o,/^\s*(.*)/.exec(l.text)[1],t)}get allowsNesting(){return!1}}function $(i,t,e,n,s){let r=e>=n&&e+t.length<=s&&t.prop(i.stateAfter);if(r)return{state:i.streamParser.copyState(r),pos:e+t.length};for(let o=t.children.length-1;o>=0;o--){let l=t.children[o],a=e+t.positions[o],h=l instanceof d&&a<s&&$(i,l,a,n,s);if(h)return h}return null}function dt(i,t,e,n,s){if(s&&e<=0&&n>=t.length)return t;!s&&e==0&&t.type==i.topNode&&(s=!0);for(let r=t.children.length-1;r>=0;r--){let o=t.positions[r],l=t.children[r],a;if(o<n&&l instanceof d){if(!(a=dt(i,l,e-o,n-o,s)))break;return s?new d(t.type,t.children.slice(0,r).concat(a),t.positions.slice(0,r+1),o+a.length):a}}return null}function Xt(i,t,e,n,s){for(let r of t){let o=r.from+(r.openStart?25:0),l=r.to-(r.openEnd?25:0),a=o<=e&&l>e&&$(i,r.tree,0-r.offset,e,l),h;if(a&&a.pos<=n&&(h=dt(i,r.tree,e+r.offset,a.pos+r.offset,!1)))return{state:a.state,tree:h}}return{state:i.streamParser.startState(s?B(s):4),tree:d.empty}}class Yt{constructor(t,e,n,s){this.lang=t,this.input=e,this.fragments=n,this.ranges=s,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=s[s.length-1].to;let r=P.get(),o=s[0].from,{state:l,tree:a}=Xt(t,n,o,this.to,r==null?void 0:r.state);this.state=l,this.parsedPos=this.chunkStart=o+a.length;for(let h=0;h<a.children.length;h++)this.chunks.push(a.children[h]),this.chunkPos.push(a.positions[h]);r&&this.parsedPos<r.viewport.from-1e5&&s.some(h=>h.from<=r.viewport.from&&h.to>=r.viewport.from)&&(this.state=this.lang.streamParser.startState(B(r.state)),r.skipUntilInView(this.parsedPos,r.viewport.from),this.parsedPos=r.viewport.from),this.moveRangeIndex()}advance(){let t=P.get(),e=this.stoppedAt==null?this.to:Math.min(this.to,this.stoppedAt),n=Math.min(e,this.chunkStart+2048);for(t&&(n=Math.min(n,t.viewport.to));this.parsedPos<n;)this.parseLine(t);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=e?this.finish():t&&this.parsedPos>=t.viewport.to?(t.skipUntilInView(this.parsedPos,e),this.finish()):null}stopAt(t){this.stoppedAt=t}lineAfter(t){let e=this.input.chunk(t);if(this.input.lineChunks)e==`
`&&(e="");else{let n=e.indexOf(`
`);n>-1&&(e=e.slice(0,n))}return t+e.length<=this.to?e:e.slice(0,this.to-t)}nextLine(){let t=this.parsedPos,e=this.lineAfter(t),n=t+e.length;for(let s=this.rangeIndex;;){let r=this.ranges[s].to;if(r>=n||(e=e.slice(0,r-(n-e.length)),s++,s==this.ranges.length))break;let o=this.ranges[s].from,l=this.lineAfter(o);e+=l,n=o+l.length}return{line:e,end:n}}skipGapsTo(t,e,n){for(;;){let s=this.ranges[this.rangeIndex].to,r=t+e;if(n>0?s>r:s>=r)break;let o=this.ranges[++this.rangeIndex].from;e+=o-s}return e}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(t,e,n,s){let r=4;if(this.ranges.length>1){s=this.skipGapsTo(e,s,1),e+=s;let l=this.chunk.length;s=this.skipGapsTo(n,s,-1),n+=s,r+=this.chunk.length-l}let o=this.chunk.length-4;return this.lang.streamParser.mergeTokens&&r==4&&o>=0&&this.chunk[o]==t&&this.chunk[o+2]==e?this.chunk[o+2]=n:this.chunk.push(t,e,n,r),s}parseLine(t){let{line:e,end:n}=this.nextLine(),s=0,{streamParser:r}=this.lang,o=new ut(e,t?t.state.tabSize:4,t?B(t.state):2);if(o.eol())r.blankLine(this.state,o.indentUnit);else for(;!o.eol();){let l=ct(r.token,o,this.state);if(l&&(s=this.emitToken(this.lang.tokenTable.resolve(l),this.parsedPos+o.start,this.parsedPos+o.pos,s)),o.start>1e4)break}this.parsedPos=n,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let t=d.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:Zt,topID:0,maxBufferLength:2048,reused:this.chunkReused});t=new d(t.type,t.children,t.positions,t.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(t),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new d(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}}function ct(i,t,e){t.start=t.pos;for(let n=0;n<10;n++){let s=i(t,e);if(t.pos>t.start)return s}throw new Error("Stream parser failed to advance stream.")}const q=Object.create(null),A=[L.none],Zt=new vt(A),Z=[],_=Object.create(null),pt=Object.create(null);for(let[i,t]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])pt[i]=mt(q,t);class gt{constructor(t){this.extra=t,this.table=Object.assign(Object.create(null),pt)}resolve(t){return t?this.table[t]||(this.table[t]=mt(this.extra,t)):0}}const _t=new gt(q);function R(i,t){Z.indexOf(i)>-1||Z.push(i)}function mt(i,t){let e=[];for(let l of t.split(" ")){let a=[];for(let h of l.split(".")){let u=i[h]||Ct[h];u?typeof u=="function"?a.length?a=a.map(u):R(h,`Modifier ${h} used at start of tag`):a.length?R(h,`Tag ${h} used as modifier`):a=Array.isArray(u)?u:[u]:R(h,`Unknown highlighting tag ${h}`)}for(let h of a)e.push(h)}if(!e.length)return 0;let n=t.replace(/ /g,"_"),s=n+" "+e.map(l=>l.id),r=_[s];if(r)return r.id;let o=_[s]=L.define({id:A.length,name:n,props:[Dt({[n]:e})]});return A.push(o),o.id}function te(i,t){let e=L.define({id:A.length,name:"Document",props:[k.add(()=>i),at.add(()=>n=>t.getIndent(n))],top:!0});return A.push(e),e}G.RTL,G.LTR;export{z as H,ot as I,H as L,P,ft as S,le as a,B as b,ae as c,at as d,de as e,pe as f,he as g,ue as h,rt as i,fe as j,ge as k,qt as l,ke as m,Nt as n,nt as o,c as p,ce as q,k as r,w as s,it as t,me as u};
