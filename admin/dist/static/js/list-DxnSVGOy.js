import{w as B}from"./@vue_runtime-dom@3.5.16-DriBzn4z.js";import{u as N,b as U}from"./index-C5WS2hJt.js";import"./store@2.0.12-i6xqVJod.js";import{c as A,u as J,d as P,b as R}from"./comm-Ba3vmJ1R.js";import{d as F,P as l,y as j,o as p,H as v,i as a,n as G,Y as K,V as Q,c,a as r,U as T,F as W,L as X,J as I}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{u as S}from"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-Bqjl69Su.js";import{v as E,u as Z,y as h}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import{b as z,a as C}from"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import{O as _,p as ee}from"./@vue_shared@3.5.16-UwmvJIHj.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-7kYVjNRB.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-CuUdMqkw.js";import"./lodash-es@4.17.21-BYk7DlcU.js";import"./mitt@3.0.1-C1z4c41a.js";import"./@codemirror_language-data@6.5.1-Blx1hvTn.js";import"./@codemirror_language@6.11.1-BYrSuhr8.js";import"./@lezer_common@1.2.3-CP7NCNqd.js";import"./@codemirror_state@6.5.2-DQ6R6BiX.js";import"./@marijn_find-cluster-break@1.0.2-DXwl3gUT.js";import"./@codemirror_view@6.37.1-Bd3_Yh4F.js";import"./style-mod@4.1.2-Bc2inJdb.js";import"./w3c-keyname@2.2.8-Vcq4gwWv.js";import"./@lezer_highlight@1.2.1-DwVMghhY.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.16_typescript@5.5.4_-BZ2tmr1d.js";import"./vue-router@4.5.1_vue@3.5.16_typescript@5.5.4_-ODt3CAxp.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.16_echarts@5.6.0_vue@3.5.16_typescript@5.5.4_-Dhz4IGE5.js";import"./echarts@5.6.0-DvAKqd2B.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.1-DcQm8NwP.js";import"./axios@1.9.0-D--XfsWq.js";import"./nprogress@0.2.0-dOd6e7EG.js";import"./chardet@2.1.0-CTPPlwpv.js";import"./@vueuse_shared@9.13.0_vue@3.5.16_typescript@5.5.4_-4q0MSQPl.js";import"./@vueuse_core@9.13.0_vue@3.5.16_typescript@5.5.4_-DmiypGF2.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-CeLFb4Nw.js";import"./@sxzz_popperjs-es@2.11.7-D_chPuIy.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./dayjs@1.11.13-DUxgsv0d.js";import"./async-validator@4.2.5-CDKkdPIV.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-BQoi3Ox2.js";import"./@floating-ui_dom@1.7.1-Ba-2EiSn.js";import"./@floating-ui_core@1.7.1-C83JrwzW.js";import"./@floating-ui_utils@0.2.9-CBkBHzV8.js";import"./@intlify_core-base@11.1.5-rFPZQXdu.js";import"./@intlify_shared@11.1.5-CY44FrR8.js";import"./@intlify_message-compiler@11.1.5-CZ-uatfp.js";const oe=F({name:"undefined"}),ne=F({...oe,name:"task-logs",setup(L,{expose:n}){const{service:Y}=N(),{t:u}=S(),b=E(!1),w=E(""),s=Z({status:[{label:u("成功"),value:1,type:"success"},{label:u("失败"),value:0,type:"danger"}]}),M=A({autoHeight:!1,columns:[{label:"#",type:"index"},{label:u("描述"),prop:"detail",showOverflowTooltip:!0,minWidth:200},{label:u("执行状态"),prop:"status",minWidth:120,dict:s.status},{label:u("执行时间"),prop:"createTime",minWidth:170}]}),m=J({service:Y.task.info,dict:{api:{page:"log"}}});function D(k){b.value=!0,w.value=u("日志列表（{name}）",{name:k.name}),G(()=>{var f;(f=m.value)==null||f.refresh({id:k.id,page:1})})}function V(){b.value=!1}return n({open:D,close:V}),(k,f)=>{const $=l("cl-refresh-btn"),q=l("cl-select"),H=l("cl-filter"),e=l("cl-row"),o=l("cl-table"),t=l("cl-flex1"),g=l("cl-pagination"),x=l("cl-crud"),d=l("cl-dialog");return p(),j(d,{modelValue:b.value,"onUpdate:modelValue":f[0]||(f[0]=i=>b.value=i),title:w.value,width:"1000px"},{default:v(()=>[a(x,{ref_key:"Crud",ref:m,padding:"0"},{default:v(()=>[a(e,null,{default:v(()=>[a($),a(H,{label:k.$t("状态")},{default:v(()=>[a(q,{options:s.status,prop:"status",width:120},null,8,["options"])]),_:1},8,["label"])]),_:1}),a(e,null,{default:v(()=>[a(o,{ref_key:"Table",ref:M},null,512)]),_:1}),a(e,null,{default:v(()=>[a(t),a(g)]),_:1})]),_:1},512)]),_:1},8,["modelValue","title"])}}}),se={class:"list"},ae=["onClick","onContextmenu"],ie={class:"name"},le={class:"row"},re={class:"row"},pe={class:"status"},ce=["onClick"],me=["onClick"],de=["onClick"],ue=["onClick"],fe=F({name:"undefined"}),_e=F({...fe,name:"task-list",setup(L){const{service:n,refs:Y,setRefs:u}=N(),{browser:b}=U(),w=P(),{t:s}=S(),M=E([]);function m(){n.task.info.page({size:100,page:1}).then(e=>{M.value=e.list.map(o=>(o.every&&(o._every=parseInt(String(o.every/1e3))),o))})}function D(e){z.confirm(s("此操作将启用任务（{name}），是否继续？",{name:e.name}),"提示",{type:"warning"}).then(()=>{n.task.info.start({id:e.id,type:e.type}).then(()=>{m()}).catch(o=>{C.error(o.message)})}).catch(()=>null)}function V(e){z.confirm(s("此操作将停用任务（{name}），是否继续？",{name:e.name}),"提示",{type:"warning"}).then(()=>{n.task.info.stop({id:e.id}).then(()=>{m()}).catch(o=>{C.error(o.message)})}).catch(()=>null)}function k(e){z.confirm(s("此操作将删除任务（{name}），是否继续？",{name:e.name}),"提示",{type:"warning"}).then(()=>{n.task.info.delete({ids:[e.id]}).then(()=>{m()}).catch(o=>{C.error(o.message)})}).catch(()=>null)}function f(e){Y.log.open(e)}async function $(e){var o;if(e&&!n.task.info._permission.update)return!1;(o=w.value)==null||o.open({title:s("编辑计划任务"),width:"600px",props:{labelWidth:"80px"},items:[{label:s("名称"),prop:"name",component:{name:"el-input",props:{placeholder:"请输入名称"}},required:!0},{label:s("类型"),prop:"taskType",value:0,component:{name:"el-radio-group",options:[{label:"cron",value:0},{label:s("时间间隔"),value:1}]},required:!0},{label:"cron",prop:"cron",hidden:({scope:t})=>t.taskType==1,component:{name:"el-input",props:{placeholder:"* * * * * *"}},required:!0},{label:s("间隔(秒)"),prop:"every",hidden:({scope:t})=>t.taskType==0,hook:{bind(t){return t/1e3},submit(t){return t*1e3}},component:{name:"el-input-number",props:{min:1,max:1e8}},required:!0},{label:"service",prop:"service",component:{name:"el-input",props:{placeholder:"taskDemoService.test([1, 2])"}}},{label:s("开始时间"),prop:"startDate",hidden:({scope:t})=>t.taskType==1,component:{name:"el-date-picker",props:{type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"}}},{label:s("备注"),prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:3}}}],form:{...e},on:{submit:(t,{close:g,done:x})=>{t.limit||(t.limit=null),n.task.info[e!=null&&e.id?"update":"add"](t).then(()=>{m(),C.success(s("保存成功")),g()}).catch(d=>{C.error(d.message),x()})}}})}function q(e){n.task.info.once({id:e.id}).then(()=>{m()}).catch(o=>{C.error(o.message)})}function H(e,o){R.open(e,{list:[o.status?{label:s("暂停"),hidden:!n.task.info._permission.stop,callback(t){V(o),t()}}:{label:s("开始"),hidden:!n.task.info._permission.start,callback(t){D(o),t()}},{label:s("立即执行"),hidden:!n.task.info._permission.once,callback(t){q(o),t()}},{label:s("编辑"),hidden:!(n.task.info._permission.update&&n.task.info._permission.info),callback(t){$(o),t()}},{label:s("删除"),hidden:!n.task.info._permission.delete,callback(t){k(o),t()}},{label:s("查看日志"),hidden:!n.task.info._permission.log,callback(t){f(o),t()}}]})}return K(()=>{m()}),(e,o)=>{const t=l("cl-svg"),g=l("el-tag"),x=l("cl-form"),d=Q("permission");return p(),c("div",{class:ee(["task-list",{"is-mini":h(b).isMini}])},[r("div",se,[(p(!0),c(W,null,X(M.value,(i,O)=>(p(),c("div",{key:O,class:"item",onClick:y=>$(i),onContextmenu:y=>{H(y,i)}},[r("p",ie,_(i.name),1),r("p",le,[r("span",null,_(e.$t("执行服务")),1),r("span",null,_(i.service),1)]),r("p",re,[r("span",null,_(e.$t("定时规则")),1),r("span",null,_(i.taskType==1?e.$t("间隔{every}秒执行",{every:i._every}):i.cron),1)]),r("div",pe,[i.status?(p(),c(W,{key:0},[T((p(),c("div",{class:"icon",onClick:B(y=>V(i),["stop"])},[a(t,{name:"close-border"})],8,ce)),[[d,h(n).task.info.permission.stop]]),a(g,{"disable-transitions":"",effect:"plain",type:"success"},{default:v(()=>[I(_(e.$t("进行中")),1)]),_:1})],64)):(p(),c(W,{key:1},[T((p(),c("div",{class:"icon",onClick:B(y=>D(i),["stop"])},[a(t,{name:"play"})],8,me)),[[d,h(n).task.info.permission.start]]),a(g,{"disable-transitions":"",effect:"plain",type:"danger"},{default:v(()=>[I(_(e.$t("已停止")),1)]),_:1})],64)),o[1]||(o[1]=r("div",{class:"flex1"},null,-1)),T((p(),c("div",{class:"icon",onClick:B(y=>f(i),["stop"])},[a(t,{name:"order"})],8,de)),[[d,h(n).task.info.permission.log]]),T((p(),c("div",{class:"icon",onClick:B(y=>k(i),["stop"])},[a(t,{name:"delete"})],8,ue)),[[d,h(n).task.info.permission.delete]])])],40,ae))),128)),T((p(),c("div",{class:"item is-add",onClick:o[0]||(o[0]=i=>$())},[a(t,{name:"plus",size:36}),r("p",null,_(e.$t("添加计划任务")),1)])),[[d,h(n).task.info.permission.add]])]),a(x,{ref_key:"Form",ref:w},null,512),a(ne,{ref:h(u)("log")},null,512)],2)}}}),pt=te(_e,[["__scopeId","data-v-9d099285"]]);export{pt as default};
