import{u as R}from"./index-BDeQYItE.js";import"./store@2.0.12-i6xqVJod.js";import{u as U}from"./group-C7Cb0IKq.js";import{_ as j,S as J}from"./rebuild.vue_vue_type_script_setup_true_lang-PygtnWFE.js";import{A as K}from"./lodash-es@4.17.21-BYk7DlcU.js";import{b as E,a as v}from"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import{d as F,v as Q,e as W,P as u,V as X,c as m,o as l,a as n,i as t,H as i,y as I,z as w,F as Y,L as Z,U as ee}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{v as S,y as c}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import{O as oe}from"./@vue_shared@3.5.16-UwmvJIHj.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vue_runtime-dom@3.5.16-DriBzn4z.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-7kYVjNRB.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-CuUdMqkw.js";import"./mitt@3.0.1-C1z4c41a.js";import"./@codemirror_language-data@6.5.1-Blx1hvTn.js";import"./@codemirror_language@6.11.1-BYrSuhr8.js";import"./@lezer_common@1.2.3-CP7NCNqd.js";import"./@codemirror_state@6.5.2-DQ6R6BiX.js";import"./@marijn_find-cluster-break@1.0.2-DXwl3gUT.js";import"./@codemirror_view@6.37.1-Bd3_Yh4F.js";import"./style-mod@4.1.2-Bc2inJdb.js";import"./w3c-keyname@2.2.8-Vcq4gwWv.js";import"./@lezer_highlight@1.2.1-DwVMghhY.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.16_typescript@5.5.4_-BZ2tmr1d.js";import"./vue-router@4.5.1_vue@3.5.16_typescript@5.5.4_-ODt3CAxp.js";import"./comm-Ba3vmJ1R.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-CeLFb4Nw.js";import"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-Bqjl69Su.js";import"./@intlify_core-base@11.1.5-rFPZQXdu.js";import"./@intlify_shared@11.1.5-CY44FrR8.js";import"./@intlify_message-compiler@11.1.5-CZ-uatfp.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.16_echarts@5.6.0_vue@3.5.16_typescript@5.5.4_-Dhz4IGE5.js";import"./echarts@5.6.0-DvAKqd2B.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.1-DcQm8NwP.js";import"./axios@1.9.0-D--XfsWq.js";import"./nprogress@0.2.0-dOd6e7EG.js";import"./chardet@2.1.0-CTPPlwpv.js";import"./@vueuse_shared@9.13.0_vue@3.5.16_typescript@5.5.4_-4q0MSQPl.js";import"./@vueuse_core@9.13.0_vue@3.5.16_typescript@5.5.4_-DmiypGF2.js";import"./@sxzz_popperjs-es@2.11.7-D_chPuIy.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./dayjs@1.11.13-DUxgsv0d.js";import"./async-validator@4.2.5-CDKkdPIV.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-BQoi3Ox2.js";import"./@floating-ui_dom@1.7.1-Ba-2EiSn.js";import"./@floating-ui_core@1.7.1-C83JrwzW.js";import"./@floating-ui_utils@0.2.9-CBkBHzV8.js";const ne={class:"bg-[var(--el-bg-color)] h-full"},re={class:"h-[50px] p-[10px]"},se={class:"flex gap-2"},ie={class:"h-[calc(100%-50px)] border-t border-[var(--el-border-color-lighter)]"},le={class:"flex items-center gap-2 mr-2 flex-1"},ae={key:0,class:"absolute right-[4px] top-[4px] h-[5px] w-[5px] bg-[var(--el-color-warning)] rounded-full"},ce={class:"text-ellipsis overflow-hidden max-w-[200px]"},pe={key:0,class:"flex gap-2"},de={class:"flex h-full"},ue={key:0,class:"h-full overflow-hidden border-r border-[var(--el-border-color-lighter)] flex-1"},me={class:"p-[10px]"},_e={class:"flex-1"},fe={class:"list"},ve={key:0,class:"absolute left-[-2px] top-[-2px] h-[10px] w-[10px]"},he={class:"absolute top-[4px] right-[4px] flex gap-1 group-hover:opacity-100 opacity-0 transition-all bg-white rounded-md p-1"},we=["onClick"],ge=["onClick"],ke=F({name:"undefined"}),ye=F({...ke,name:"know-data-info",setup(xe){const{service:p,router:q,route:d,refs:$,setRefs:T}=R(),{ViewGroup:V}=U({label:"文档列表",service:p.know.data.source,enableAdd:!1,data:{typeId:d.query.typeId,order:"createTime",sort:"desc"},onSelect(e){b.value=!1,G({sourceId:e.id})},onEdit(){return{title:"编辑文档",width:"500px",items:[{label:"标题",prop:"title",component:{name:"el-input",props:{maxlength:30,clearable:!0}},required:!0}]}},onData(e){return e.map(o=>({...o,name:o.title}))}}),B=S(),b=S(!1),h=Q(()=>{var e;return(e=V.value)==null?void 0:e.selected}),g=S([]);function G(e){p.know.data.info.page({...e,typeId:d.query.typeId,page:1,pageSize:1e3,order:"createTime",sort:"desc"}).then(o=>{g.value=o.list})}function L(){q.push({path:"/know/data/add",query:{...d.query}})}function N(e,o){E.confirm("此操作将永久删除选中数据，是否继续？","提示",{type:"warning"}).then(()=>{p.know.data.info.delete({ids:[e.id]}).then(()=>{v.success("删除成功"),g.value.splice(o,1)}).catch(r=>{v.error(r.message)})}).catch(()=>{})}function D(e){$.contentForm.open({title:"编辑内容",form:{content:e==null?void 0:e.content},items:[{label:"内容",prop:"content",component:{name:"cl-editor-md"},required:!0}],on:{submit(o,{close:r,done:a}){var C,k;if(e)p.know.data.info.update({id:e==null?void 0:e.id,content:o.content}).then(()=>{v.success("编辑成功"),e.content=o.content,r()}).catch(_=>{v.error(_.message),a()});else{const _={typeId:Number(d.query.typeId),sourceId:(k=(C=V.value)==null?void 0:C.selected)==null?void 0:k.id,content:o.content,from:0};p.know.data.info.add(_).then(y=>{g.value.unshift({..._,id:y.id}),v.success("添加成功"),r()}).catch(y=>{v.error(y.message),a()})}}}})}async function z(){const{content:e,from:o,_content:r}=h.value;o==2?window.open(e):(o==1&&!r&&await p.know.loader.fileByLink({link:e}).then(a=>{h.value._content=a}),b.value=!b.value)}function M(){var e;if(((e=B.value)==null?void 0:e.indexType)!=2)return v.warning("索引方式为知识图谱可用");q.push({path:"/know/graph",query:{...d.query}})}function A(){p.know.data.type.info({id:d.query.typeId}).then(e=>{B.value=e}).catch(e=>{E.confirm(e.message,"提示",{type:"warning"}).then(()=>{q.back()}).catch(()=>{})})}return W(()=>{A()}),(e,o)=>{const r=u("cl-svg"),a=u("el-tooltip"),C=u("cl-view-head"),k=u("cl-preview-md"),_=u("el-scrollbar"),y=u("el-empty"),H=u("cl-form"),O=u("cl-view-group"),P=X("permission");return l(),m("div",ne,[n("div",re,[t(C,null,{op:i(()=>{var s;return[n("div",se,[((s=B.value)==null?void 0:s.indexType)==2?(l(),I(a,{key:0,content:"知识图谱"},{default:i(()=>[n("div",{class:"cl-comm__icon",onClick:o[0]||(o[0]=x=>M())},[t(r,{name:"know-branches"})])]),_:1})):w("",!0),t(a,{content:"重建知识库"},{default:i(()=>[n("div",{class:"cl-comm__icon",onClick:o[1]||(o[1]=x=>{var f;return(f=c($).rebuild)==null?void 0:f.open(c(d).query.typeId)})},[t(r,{name:"know-clear"})])]),_:1}),t(a,{content:"搜索测试"},{default:i(()=>[n("div",{class:"cl-comm__icon",onClick:o[2]||(o[2]=x=>{var f;return(f=c($).searchTest)==null?void 0:f.open(c(d).query.typeId)})},[t(r,{name:"search"})])]),_:1})])]}),_:1})]),n("div",ie,[t(O,{ref_key:"ViewGroup",ref:V},{"left-op":i(()=>[t(a,{content:"添加文档"},{default:i(()=>[ee((l(),m("div",{class:"icon ml-[5px]",onClick:L},[t(r,{name:"plus-border"})])),[[P,c(p).know.data.source.permission.add]])]),_:1})]),"item-name":i(({item:s})=>[n("div",le,[t(r,{name:"know-"+["edit","file","url"][s.from],class:"text-[17px]"},null,8,["name"]),s.status==0?(l(),m("div",ae)):w("",!0),n("span",ce,oe(s.name),1)])]),"right-op":i(()=>[h.value?(l(),m("div",pe,[t(a,{content:"查看原内容"},{default:i(()=>{var s;return[n("div",{class:"icon is-bg",onClick:o[3]||(o[3]=x=>z())},[((s=h.value)==null?void 0:s.from)==2?(l(),I(r,{key:0,name:"know-link"})):(l(),I(r,{key:1,name:"know-file"}))])]}),_:1}),t(a,{content:"添加内容"},{default:i(()=>[n("div",{class:"icon is-bg",onClick:o[4]||(o[4]=s=>D())},[t(r,{name:"plus"})])]),_:1})])):w("",!0)]),right:i(()=>[n("div",de,[b.value?(l(),m("div",ue,[t(_,null,{default:i(()=>[n("div",me,[t(k,{content:h.value._content||h.value.content},null,8,["content"])])]),_:1})])):w("",!0),n("div",_e,[t(_,null,{default:i(()=>[n("view",fe,[(l(!0),m(Y,null,Z(g.value,(s,x)=>(l(),m("view",{class:"item relative group",key:s.id},[s.status==0?(l(),m("div",ve,o[5]||(o[5]=[n("div",{class:"absolute h-full w-full bg-[var(--el-color-warning)] rounded-full animate-ping"},null,-1),n("div",{class:"absolute h-full w-full bg-[var(--el-color-warning)] rounded-full"},null,-1)]))):w("",!0),t(k,{content:s.content},null,8,["content"]),n("div",he,[n("div",{class:"cl-comm__icon border-none",onClick:f=>N(s,x)},[t(r,{name:"delete"})],8,we),n("div",{class:"cl-comm__icon border-none",onClick:f=>D(s)},[t(r,{name:"edit"})],8,ge)])]))),128)),c(K)(g.value)?(l(),I(y,{key:0,"image-size":80})):w("",!0)])]),_:1})])]),t(H,{ref:c(T)("contentForm")},null,512)]),_:1},512)]),t(j,{ref:c(T)("rebuild")},null,512),t(J,{ref:c(T)("searchTest")},null,512)])}}}),go=te(ye,[["__scopeId","data-v-354c7acc"]]);export{go as default};
