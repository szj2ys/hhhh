import{w as se}from"./@vue_runtime-dom@3.5.16-DriBzn4z.js";import{u as ie,e as ne}from"./index-C5WS2hJt.js";import{k as ce}from"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-CeLFb4Nw.js";import{d as ue}from"./comm-Ba3vmJ1R.js";import{C as me}from"./index-l1IOnGdE.js";import{A as P,e as de,y as pe}from"./lodash-es@4.17.21-BYk7DlcU.js";import{a as fe}from"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import{d as H,v as ve,e as he,w as _e,P as i,c as f,o as n,a as $,i as a,F as _,L as R,y as z,H as c,z as ye,J as T}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{u as be}from"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-Bqjl69Su.js";import{v as x,u as W,y as F}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import{O as y}from"./@vue_shared@3.5.16-UwmvJIHj.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-7kYVjNRB.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-CuUdMqkw.js";import"./store@2.0.12-i6xqVJod.js";import"./chardet@2.1.0-CTPPlwpv.js";import"./mitt@3.0.1-C1z4c41a.js";import"./@codemirror_language-data@6.5.1-Blx1hvTn.js";import"./@codemirror_language@6.11.1-BYrSuhr8.js";import"./@lezer_common@1.2.3-CP7NCNqd.js";import"./@codemirror_state@6.5.2-DQ6R6BiX.js";import"./@marijn_find-cluster-break@1.0.2-DXwl3gUT.js";import"./@codemirror_view@6.37.1-Bd3_Yh4F.js";import"./style-mod@4.1.2-Bc2inJdb.js";import"./w3c-keyname@2.2.8-Vcq4gwWv.js";import"./@lezer_highlight@1.2.1-DwVMghhY.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.16_typescript@5.5.4_-BZ2tmr1d.js";import"./vue-router@4.5.1_vue@3.5.16_typescript@5.5.4_-ODt3CAxp.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.16_echarts@5.6.0_vue@3.5.16_typescript@5.5.4_-Dhz4IGE5.js";import"./echarts@5.6.0-DvAKqd2B.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.1-DcQm8NwP.js";import"./axios@1.9.0-D--XfsWq.js";import"./nprogress@0.2.0-dOd6e7EG.js";import"./@vueuse_shared@9.13.0_vue@3.5.16_typescript@5.5.4_-4q0MSQPl.js";import"./@vueuse_core@9.13.0_vue@3.5.16_typescript@5.5.4_-DmiypGF2.js";import"./@sxzz_popperjs-es@2.11.7-D_chPuIy.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./dayjs@1.11.13-DUxgsv0d.js";import"./async-validator@4.2.5-CDKkdPIV.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-BQoi3Ox2.js";import"./@floating-ui_dom@1.7.1-Ba-2EiSn.js";import"./@floating-ui_core@1.7.1-C83JrwzW.js";import"./@floating-ui_utils@0.2.9-CBkBHzV8.js";import"./@intlify_core-base@11.1.5-rFPZQXdu.js";import"./@intlify_shared@11.1.5-CY44FrR8.js";import"./@intlify_message-compiler@11.1.5-CZ-uatfp.js";const ge={class:"mr-auto ml-[6px]"},Ve={key:1,class:"placeholder"},Ce={class:"cl-user-select__item"},we={class:"select-none"},$e=H({name:"undefined"}),xe=H({...$e,name:"cl-user-select",props:{...me,modelValue:null,multiple:Boolean,placeholder:String,title:String,immediate:Boolean,labelKey:{type:String,default:"nickName"},maxCollapse:{type:Number,default:10}},emits:["update:modelValue","change"],setup(m,{expose:J,emit:O}){const v=m,b=O,{service:I,refs:k,setRefs:j}=ie(),{t:N}=be(),q=ue(),r=x([]),g=x(!1),V=x(""),d=W({active:"dept",list:[{label:N("按部门分组"),value:"dept"},{label:N("按角色分组"),value:"role"}]}),U=W({}),C=x([]),h=ve(()=>C.value.filter(e=>r.value.includes(e.id)));function G(e,t){return e?t.name.includes(e):!0}function Q(){k[`tree-${d.active}`].filter(V.value)}async function X(){return I.base.sys.user.page({size:1e4}).then(e=>{C.value=e.list.map(t=>(t.isUser=!0,t))})}async function Y(){return I.base.sys.department.list().then(e=>{e=ne(e);const t=s=>{s.forEach(o=>{const p=C.value.filter(w=>w.departmentId===o.id&&w.id!=1);o.children||(o.children=[]),o.children.push(...de(p)),o.children&&!o.departmentId&&t(o.children)})};t(e),U.dept=e})}async function Z(){return I.base.sys.role.list().then(e=>{e.forEach(t=>{t.children=C.value.filter(s=>s.roleIds.includes(s.id))}),U.role=e})}async function K(){g.value=!0,V.value="",await D(),d.list.forEach(e=>{k[`tree-${e.value}`].setCheckedKeys(r.value)})}function B(){g.value=!1}function ee(){r.value=[],b("update:modelValue",void 0),b("change",void 0)}function te(e,t){e.isUser&&(v.multiple?k[`tree-${d.active}`].setChecked(e,!t.checked,!1):(r.value=[e.id],S()))}function S(){var t;let e=r.value||[];if(v.multiple&&(e=k[`tree-${d.active}`].getCheckedNodes().filter(p=>p.isUser).map(p=>p.id)),P(e))return fe.warning(N("请选择成员"));r.value=e,b("update:modelValue",r.value),b("change",h.value),B(),(t=q.value)==null||t.validateField(v.prop)}async function D(){await X(),await Y(),await Z()}return he(()=>{v.immediate&&D(),_e(()=>v.modelValue,e=>{let t=e||[];pe(t)||(t=[t]),r.value=t},{immediate:!0})}),J({open:K,close:B}),(e,t)=>{var A,L;const s=i("cl-avatar"),o=i("el-icon"),p=i("el-input"),w=i("el-tree"),le=i("el-scrollbar"),oe=i("el-tab-pane"),ae=i("el-tabs"),M=i("el-button"),re=i("cl-dialog");return n(),f(_,null,[$("div",{class:"cl-user-select",onClick:t[0]||(t[0]=l=>K())},[F(P)(h.value)?(n(),f("span",Ve,y(m.placeholder||e.$t("请选择")),1)):(n(),f(_,{key:0},[m.multiple?(n(!0),f(_,{key:0},R(h.value,(l,E)=>(n(),z(s,{key:E,src:l.headImg,size:24,class:"mr-[5px]"},null,8,["src"]))),128)):(n(),f(_,{key:1},[a(s,{size:24,src:(A=h.value[0])==null?void 0:A.headImg},null,8,["src"]),$("span",ge,y((L=h.value[0])==null?void 0:L[m.labelKey]),1)],64)),a(o,{class:"ml-auto",onClick:se(ee,["stop"])},{default:c(()=>[a(F(ce))]),_:1})],64))]),a(re,{modelValue:g.value,"onUpdate:modelValue":t[4]||(t[4]=l=>g.value=l),title:m.title||e.$t("选择成员"),controls:["close"],width:"600px"},{footer:c(()=>[a(M,{onClick:B},{default:c(()=>[T(y(e.$t("取消")),1)]),_:1}),a(M,{type:"success",onClick:t[3]||(t[3]=l=>S())},{default:c(()=>[T(y(e.$t("确定")),1)]),_:1})]),default:c(()=>[a(ae,{modelValue:d.active,"onUpdate:modelValue":t[2]||(t[2]=l=>d.active=l),type:"card"},{default:c(()=>[(n(!0),f(_,null,R(d.list,(l,E)=>(n(),z(oe,{key:E,label:l.label,name:l.value},{default:c(()=>[a(p,{placeholder:e.$t("搜索名称"),modelValue:V.value,"onUpdate:modelValue":t[1]||(t[1]=u=>V.value=u),onInput:Q},null,8,["placeholder","modelValue"]),a(le,{"max-height":"600px",class:"scrollbar"},{default:c(()=>[a(w,{ref_for:!0,ref:F(j)(`tree-${l.value}`),"node-key":"id","show-checkbox":m.multiple,data:U[l.value],props:{label:"name",class:u=>m.multiple||!u.isUser?"":r.value.includes(u.id)?"is-selected":""},"default-expand-all":"","filter-node-method":G,onNodeClick:te},{default:c(({data:u})=>[$("div",Ce,[u.isUser?(n(),z(s,{key:0,class:"mr-[6px]",src:u.headImg,size:24},null,8,["src"])):ye("",!0),$("span",we,y(u.name),1)])]),_:2},1032,["show-checkbox","data","props"])]),_:2},1024)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),gt=ke(xe,[["__scopeId","data-v-1dddbe90"]]);export{gt as default};
