import{w as q}from"./@vue_runtime-dom@3.5.16-DriBzn4z.js";import{d as H}from"./comm-Ba3vmJ1R.js";import{r as J,u as G}from"./xlsx@0.18.5-DAwKXFuD.js";import{b as K}from"./chardet@2.1.0-CTPPlwpv.js";import{w as Q}from"./index-C5WS2hJt.js";import{a as I}from"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import{O as W}from"./lodash-es@4.17.21-BYk7DlcU.js";import{d as O,v as F,P as h,c as x,o as u,i as a,H as p,J as S,z as V,a as w,F as j,L as X,y as E}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{u as Y}from"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-Bqjl69Su.js";import{u as A}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import{O as b}from"./@vue_shared@3.5.16-UwmvJIHj.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-CeLFb4Nw.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-7kYVjNRB.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-CuUdMqkw.js";import"./store@2.0.12-i6xqVJod.js";import"./mitt@3.0.1-C1z4c41a.js";import"./@codemirror_language-data@6.5.1-Blx1hvTn.js";import"./@codemirror_language@6.11.1-BYrSuhr8.js";import"./@lezer_common@1.2.3-CP7NCNqd.js";import"./@codemirror_state@6.5.2-DQ6R6BiX.js";import"./@marijn_find-cluster-break@1.0.2-DXwl3gUT.js";import"./@codemirror_view@6.37.1-Bd3_Yh4F.js";import"./style-mod@4.1.2-Bc2inJdb.js";import"./w3c-keyname@2.2.8-Vcq4gwWv.js";import"./@lezer_highlight@1.2.1-DwVMghhY.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.16_typescript@5.5.4_-BZ2tmr1d.js";import"./vue-router@4.5.1_vue@3.5.16_typescript@5.5.4_-ODt3CAxp.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.16_echarts@5.6.0_vue@3.5.16_typescript@5.5.4_-Dhz4IGE5.js";import"./echarts@5.6.0-DvAKqd2B.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.1-DcQm8NwP.js";import"./axios@1.9.0-D--XfsWq.js";import"./nprogress@0.2.0-dOd6e7EG.js";import"./@vueuse_shared@9.13.0_vue@3.5.16_typescript@5.5.4_-4q0MSQPl.js";import"./@vueuse_core@9.13.0_vue@3.5.16_typescript@5.5.4_-DmiypGF2.js";import"./@sxzz_popperjs-es@2.11.7-D_chPuIy.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./dayjs@1.11.13-DUxgsv0d.js";import"./async-validator@4.2.5-CDKkdPIV.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-BQoi3Ox2.js";import"./@floating-ui_dom@1.7.1-Ba-2EiSn.js";import"./@floating-ui_core@1.7.1-C83JrwzW.js";import"./@floating-ui_utils@0.2.9-CBkBHzV8.js";import"./@intlify_core-base@11.1.5-rFPZQXdu.js";import"./@intlify_shared@11.1.5-CY44FrR8.js";import"./@intlify_message-compiler@11.1.5-CZ-uatfp.js";const ee={key:0,class:"upload"},te={key:0,class:"tips"},oe={class:"inner"},ne={key:0,class:"data-table"},ie={class:"head"},ae={class:"cl-table"},le={key:0},re={class:"pagination"},se=O({name:"undefined"}),pe=O({...se,name:"cl-import-btn",props:{onConfig:Function,onSubmit:Function,template:{type:String,default:""},tips:String,limitSize:{type:Number,default:10},type:{type:String,default:"success"},icon:String,disabled:Boolean,accept:{type:String,default:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel,text/csv"}},emits:["change"],setup(d,{expose:T,emit:D}){const _=d,L=D,z=H(),{t:v}=Y(),M=F(()=>_.tips||v("请按照模版填写信息")),o=A({filename:"",file:null,list:[]}),l=A({size:20,page:1,onCurrentChange(e){l.page=e}}),r=A({header:[],selection:[],del(e){e!==void 0?o.list.splice(e,1):o.list=o.list.filter(n=>!r.selection.includes(n._index))},onIndex(e){return e+1+(l.page-1)*l.size},onSelectionChange(e){r.selection=e.map(n=>n._index)}}),N=F(()=>o.list.filter((e,n)=>n>=(l.page-1)*l.size&&n<l.page*l.size));function $(){o.filename="",o.file=null,o.list=[],r.header=[],r.selection=[]}function U(){var e;$(),(e=z.value)==null||e.open({title:v("导入"),width:F(()=>o.filename?"80%":"800px"),dialog:{"close-on-press-escape":!1},items:[..._.onConfig?_.onConfig(z):[],{prop:"file",component:{name:"slot-upload"}},{component:{name:"slot-list"}}],op:{saveButtonText:v("提交")},on:{submit(n,{done:s,close:f}){if(!o.filename)return s(),I.error(v("请选择文件"));_.onSubmit?_.onSubmit(o,{done:s,close:f}):(I.error(v("[cl-import-btn] onSubmit is required")),s())}}})}function P(e,n,{next:s}){const f=new FileReader,c=Q(e.name);return f.onload=C=>{var m;let k="";if(c=="csv"){const i=K.detect(new Uint8Array(C.target.result));k=new TextDecoder(i).decode(C.target.result)}else k=C.target.result;const g=J(k,{type:"binary",raw:c=="csv"});let y=[];for(const i in g.Sheets)W(g.Sheets,i)&&(y=y.concat(G.sheet_to_json(g.Sheets[i],{raw:!1,dateNF:"yyyy-mm-dd",defval:""})));o.list=y.map((i,B)=>({...i,_index:B})),o.filename=e.name,o.file=e;const t=g.Sheets[Object.keys(g.Sheets)[0]];for(const i in t){if(i[0]==="!")continue;((m=i.match(/[0-9]+/))==null?void 0:m[0])=="1"&&r.header.push(t[i].v)}L("change",y)},c=="csv"?f.readAsArrayBuffer(e):f.readAsBinaryString(e),s(),!1}function R(){const e=document.createElement("a");e.setAttribute("href",_.template),e.setAttribute("download",""),e.click()}return T({open:U,clear:$,Form:z}),(e,n)=>{const s=h("el-button"),f=h("cl-upload"),c=h("el-table-column"),C=h("el-input"),k=h("el-table"),g=h("el-pagination"),y=h("cl-form");return u(),x(j,null,[a(s,{icon:d.icon,disabled:d.disabled,type:d.type,onClick:U},{default:p(()=>[S(b(e.$t("导入")),1)]),_:1},8,["icon","disabled","type"]),a(y,{ref_key:"Form",ref:z},{"slot-upload":p(()=>[o.filename?V("",!0):(u(),x("div",ee,[d.template?(u(),x("div",te,[w("span",null,b(M.value),1),a(s,{type:"primary",text:"",bg:"",onClick:R},{default:p(()=>[S(b(e.$t("下载模版")),1)]),_:1})])):V("",!0),w("div",oe,[a(f,{drag:"","limit-size":d.limitSize,accept:d.accept,disabled:d.disabled,"auto-upload":!1,"before-upload":P,size:[220,"100%"]},null,8,["limit-size","accept","disabled"])])]))]),"slot-list":p(()=>[N.value.length?(u(),x("div",ne,[w("div",ie,[a(s,{type:"success",onClick:$},{default:p(()=>[S(b(e.$t("重新上传")),1)]),_:1}),a(s,{type:"danger",disabled:r.selection.length==0,onClick:n[0]||(n[0]=t=>r.del())},{default:p(()=>[S(b(e.$t("批量删除")),1)]),_:1},8,["disabled"])]),w("div",ae,[a(k,{border:"",data:N.value,"max-height":"600px",onSelectionChange:r.onSelectionChange,onRowClick:n[1]||(n[1]=t=>{t._edit=!0})},{default:p(()=>[a(c,{type:"selection",width:"60px",align:"center",fixed:"left"}),a(c,{label:e.$t("序号"),type:"index",width:"80px",align:"center",fixed:"left",index:r.onIndex},null,8,["label","index"]),(u(!0),x(j,null,X(r.header,t=>(u(),E(c,{key:t,prop:t,label:t,"min-width":"160px",align:"center"},{default:p(m=>[m.row._edit?(u(),E(C,{key:1,modelValue:m.row[t],"onUpdate:modelValue":i=>m.row[t]=i,type:"textarea",clearable:"",placeholder:t},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(u(),x("span",le,b(m.row[t]),1))]),_:2},1032,["prop","label"]))),128)),a(c,{label:e.$t("操作"),width:"100px",align:"center",fixed:"right"},{default:p(t=>[a(s,{text:"",bg:"",type:"danger",onClick:q(m=>r.del(t.$index),["stop"])},{default:p(()=>[S(b(e.$t("删除")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data","onSelectionChange"])]),w("div",re,[a(g,{"current-page":l.page,"onUpdate:currentPage":n[2]||(n[2]=t=>l.page=t),background:"",layout:"total, prev, pager, next",total:o.list.length,"page-size":l.size,onCurrentChange:l.onCurrentChange},null,8,["current-page","total","page-size","onCurrentChange"])])])):V("",!0)]),_:1},512)],64)}}}),it=Z(pe,[["__scopeId","data-v-c28a258e"]]);export{it as default};
