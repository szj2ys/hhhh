import{k as d,m as _,p as g}from"./index-BDeQYItE.js";import"./store@2.0.12-i6xqVJod.js";import{a as w}from"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import{x as y}from"./lodash-es@4.17.21-BYk7DlcU.js";import{d as v,e as x,f as M,c as $,o as k}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{v as S,y as h}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import{p as E}from"./@vue_shared@3.5.16-UwmvJIHj.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";function D(){async function m(e){const a=(await d.base.sys.menu.list()).find(r=>r.router==e);a&&await d.base.sys.menu.delete({ids:[a.id]})}function f(e){return new Promise(async(u,a)=>{var r;e.viewPath=`modules/${e.module}/views${(r=e.router)==null?void 0:r.replace(`/${e.module}`,"")}.vue`,await m(e.router),d.base.sys.menu.add({type:1,isShow:!0,keepAlive:!0,...e,api:void 0,code:void 0}).then(i=>{var c;const l=(c=e.api)==null?void 0:c.map(s=>{var o;const n={type:2,parentId:i.id,name:s.summary||s.path,perms:[s.path]};return s.path=="/update"&&(o=e.api)!=null&&o.find(t=>t.path=="/info")&&n.perms.push("/info"),{...n,perms:n.perms.map(t=>{var p;return(((p=e.prefix)==null?void 0:p.replace("/admin/",""))+t).replace(/\//g,":")}).join(",")}});d.base.sys.menu.add(l).then(()=>{u(()=>{d.request({url:"/__cool_createFile",method:"POST",proxy:!1,data:{code:e.code,path:e.viewPath}}).then(()=>{location.reload()})})})}).catch(i=>{w.error(i.message),a()})})}return{del:m,create:f}}const b=["src"],A=v({name:"undefined"}),B=v({...A,name:"ai-code-dev",props:{path:String,hide:Boolean},emits:["message"],setup(m,{expose:f,emit:e}){const u=e,a=_.config("helper"),r=S(null),i=new Map;function l(s,n,o){var t,p;o&&i.set(s,o),(p=(t=r.value)==null?void 0:t.contentWindow)==null||p.postMessage({name:s,data:n},"*")}function c(s){try{const{name:n,data:o}=y(s.data)?JSON.parse(s.data):s.data,t=i.get(n);t&&t(o),u("message",{name:n,data:o})}catch{}}return x(()=>{window.addEventListener("message",c)}),M(()=>{window.removeEventListener("message",c)}),f({send:l}),(s,n)=>(k(),$("iframe",{src:`${h(a).index}${m.path}?lang=${h(g).serviceLang}`,class:E(["iframe",{"is-hide":m.hide}]),ref_key:"iframeRef",ref:r},null,10,b))}}),F=P(B,[["__scopeId","data-v-c0606011"]]);export{F as A,D as u};
