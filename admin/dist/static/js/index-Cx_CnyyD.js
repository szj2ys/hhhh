import{d as j,u as W,c as Z,e as ee}from"./comm-Ba3vmJ1R.js";import{u as S,d as H,i as K,c as te,P as q}from"./index-C5WS2hJt.js";import"./store@2.0.12-i6xqVJod.js";import{a as x}from"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import{v as oe,A as z}from"./lodash-es@4.17.21-BYk7DlcU.js";import{d as V,P as r,c as g,o as y,i as l,H as d,J as I,F as N,v as ne,e as le,y as E,z as J,L as D}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{u as M}from"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-Bqjl69Su.js";import{v as re,y as P,u as se}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import{O as A}from"./@vue_shared@3.5.16-UwmvJIHj.js";import{d as ae}from"./dayjs@1.11.13-DUxgsv0d.js";import{A as pe,u as ce}from"./dev-yDukMeIX.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vue_runtime-dom@3.5.16-DriBzn4z.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-CeLFb4Nw.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-7kYVjNRB.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-CuUdMqkw.js";import"./mitt@3.0.1-C1z4c41a.js";import"./@codemirror_language-data@6.5.1-Blx1hvTn.js";import"./@codemirror_language@6.11.1-BYrSuhr8.js";import"./@lezer_common@1.2.3-CP7NCNqd.js";import"./@codemirror_state@6.5.2-DQ6R6BiX.js";import"./@marijn_find-cluster-break@1.0.2-DXwl3gUT.js";import"./@codemirror_view@6.37.1-Bd3_Yh4F.js";import"./style-mod@4.1.2-Bc2inJdb.js";import"./w3c-keyname@2.2.8-Vcq4gwWv.js";import"./@lezer_highlight@1.2.1-DwVMghhY.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.16_typescript@5.5.4_-BZ2tmr1d.js";import"./vue-router@4.5.1_vue@3.5.16_typescript@5.5.4_-ODt3CAxp.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.16_echarts@5.6.0_vue@3.5.16_typescript@5.5.4_-Dhz4IGE5.js";import"./echarts@5.6.0-DvAKqd2B.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.1-DcQm8NwP.js";import"./axios@1.9.0-D--XfsWq.js";import"./nprogress@0.2.0-dOd6e7EG.js";import"./chardet@2.1.0-CTPPlwpv.js";import"./@vueuse_shared@9.13.0_vue@3.5.16_typescript@5.5.4_-4q0MSQPl.js";import"./@vueuse_core@9.13.0_vue@3.5.16_typescript@5.5.4_-DmiypGF2.js";import"./@sxzz_popperjs-es@2.11.7-D_chPuIy.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./async-validator@4.2.5-CDKkdPIV.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-BQoi3Ox2.js";import"./@floating-ui_dom@1.7.1-Ba-2EiSn.js";import"./@floating-ui_core@1.7.1-C83JrwzW.js";import"./@floating-ui_utils@0.2.9-CBkBHzV8.js";import"./@intlify_core-base@11.1.5-rFPZQXdu.js";import"./@intlify_shared@11.1.5-CY44FrR8.js";import"./@intlify_message-compiler@11.1.5-CZ-uatfp.js";const ie=V({name:"undefined"}),me=V({...ie,name:"menu-imp",setup(T){const{t:_}=M(),{service:C}=S(),w=j(),n=W(),f=re(!1);function v(a,h){f.value=!0;const b=new FileReader;b.onload=m=>{var c,e;f.value=!1;try{const t=JSON.parse((c=m.target)==null?void 0:c.result);(e=w.value)==null||e.open({title:_("菜单导入"),height:"400px",width:"600px",props:{labelWidth:"0px"},op:{saveButtonText:_("添加")},items:[{component:{name:"slot-tips"}},{component:{name:"el-tree",props:{data:oe(t,"orderNum","asc"),nodeKey:"name",props:{label:"name",children:"childMenus"},renderContent(o,{data:i}){return i.name}},style:{padding:"5px",borderRadius:"var(--el-border-radius-base)",border:"1px solid var(--el-border-color)"}}}],on:{submit(o,{close:i,done:p}){C.base.sys.menu.import({menus:t}).then(()=>{var u;x.success(_("导入成功")),(u=n.value)==null||u.refresh(),i()}).catch(u=>{x.error(u.message),p()})}}})}catch(t){x.error(_("{file}文件格式错误：{error}",{file:h.name,error:t}))}},b.readAsText(h)}return(a,h)=>{const b=r("cl-svg"),m=r("el-button"),c=r("cl-upload"),e=r("el-alert"),t=r("cl-form");return y(),g(N,null,[l(c,{type:"file","show-file-list":!1,"auto-upload":!1,disabled:f.value,onUpload:v},{default:d(()=>[l(m,{type:"success",loading:f.value},{default:d(()=>[l(b,{name:"import",class:"mr-[5px]"}),I(" "+A(a.$t("导入")),1)]),_:1},8,["loading"])]),_:1},8,["disabled"]),l(t,{ref_key:"Form",ref:w},{"slot-tips":d(()=>[l(e,{type:"warning"},{default:d(()=>[I(A(a.$t("如遇到问题无法导入菜单，请检查文件并尝试重新导入。")),1)]),_:1})]),_:1},512)],64)}}}),ue=V({name:"undefined"}),de=V({...ue,name:"menu-exp",props:{data:{type:Array,default:()=>[]}},setup(T){const{t:_}=M(),C=T,{service:w,refs:n,setRefs:f}=S(),v=j();function a(){var h;(h=v.value)==null||h.open({title:_("导出"),width:"600px",props:{labelPosition:"top"},op:{saveButtonText:_("导出")},items:[{label:_("选择菜单"),prop:"ids",component:{name:"el-tree-select",ref:f("ids"),props:{data:C.data,nodeKey:"id",multiple:!0,showCheckbox:!0,collapseTags:!0,collapseTagsTooltip:!0,props:{label:"name",children:"_children"}}}}],on:{submit(b,{done:m,close:c}){const e=[...n.ids.getCheckedKeys(),...n.ids.getHalfCheckedKeys()];z(e)?(x.warning(_("请先选择要导出的菜单")),m()):w.base.sys.menu.export({ids:e}).then(t=>{c();const o=new Blob([JSON.stringify(t)],{type:"application/json"}),i=URL.createObjectURL(o),p=document.createElement("a");p.href=i,p.download=_("菜单数据")+` ${ae().format("MM-DD HH_mm_ss")}.json`,p.click(),URL.revokeObjectURL(i)}).catch(t=>{x.error(t.message)})}}})}return(h,b)=>{const m=r("cl-svg"),c=r("el-button"),e=r("cl-form");return y(),g(N,null,[l(c,{type:"info",onClick:a},{default:d(()=>[l(m,{name:"export",class:"mr-[5px]"}),I(" "+A(h.$t("导出")),1)]),_:1}),l(e,{ref_key:"Form",ref:v},null,512)],64)}}}),_e=V({name:"undefined"}),fe=V({..._e,name:"menu-create",setup(T){const{service:_,mitt:C,refs:w,setRefs:n}=S(),f=ce(),v=j(),{t:a}=M(),h=[],b=ne(()=>H(h.map(e=>e.value)));function m(){var e;w.aiCode.send("getEps"),(e=v.value)==null||e.open({title:a("快速创建"),width:"800px",items:[{prop:"entity",label:a("数据结构"),component:{name:"slot-entity"},span:8,required:!0},{prop:"parentId",label:a("上级节点"),span:16,component:{name:"cl-menu-select",props:{type:1,placeholder:a("请选择上级节点")}}},{prop:"name",label:a("菜单名称"),span:8,component:{name:"el-input",props:{placeholder:a("请输入菜单名称")}},required:!0},{prop:"router",label:a("菜单路由"),span:8,component:{name:"el-input",props:{placeholder:a("请输入菜单路由，如：/test")}},rules:{required:!0,validator(t,o,i){(o||"").startsWith("/")?i():i(new Error(a("必须以 / 开头")))}}},{prop:"orderNum",label:a("菜单排序"),span:8,value:1,component:{name:"el-input-number",props:{placeholder:a("请填写菜单排序"),min:0,max:99,"controls-position":"right"}}},{prop:"icon",label:a("菜单图标"),component:{name:"cl-menu-icon",props:{showIcon:!0,placeholder:a("请选择图标")}}},{prop:"keepAlive",value:!0,flex:!1,label:a("路由缓存"),component:{name:"cl-switch"}}],op:{saveButtonText:a("开始创建")},on:{async submit(t,{done:o,close:i}){const p=h.find(u=>u.value==t.entity.join("/"));w.aiCode.send("createVue",{...p,router:t.router},u=>{f.create({...t,module:p.module,prefix:p.prefix,api:p.api,code:u}).then(U=>{C.emit("helper.createMenu"),U(),i()}).catch(U=>{o()})})}}})}function c(e){var o,i;const t=h.find(p=>p.value==(e==null?void 0:e.join("/")));t&&((o=v.value)==null||o.setForm("router",`/${t.value}`),(i=v.value)==null||i.setForm("module",t.module))}return le(()=>{_.base.open.eps().then(e=>{for(const t in e)e[t].forEach(o=>{z(o.columns)||h.push({value:o.prefix.substring(7),...o})})})}),(e,t)=>{const o=r("el-button"),i=r("el-cascader"),p=r("cl-form");return y(),g(N,null,[P(K)?(y(),E(o,{key:0,type:"success",onClick:m},{default:d(()=>[I(A(e.$t("快速创建")),1)]),_:1})):J("",!0),l(p,{ref_key:"Form",ref:v},{"slot-entity":d(({scope:u})=>[l(i,{modelValue:u.entity,"onUpdate:modelValue":U=>u.entity=U,filterable:"",clearable:"",separator:".",options:b.value,placeholder:e.$t("请选择数据结构"),onChange:c},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),_:1},512),l(pe,{path:"/ai",ref:P(n)("aiCode"),hide:""},null,512)],64)}}}),he=G(fe,[["__scopeId","data-v-7637007b"]]),be=V({name:"undefined"}),ye=V({...be,name:"auto-perms",props:{menuId:[String,Number]},emits:["open","close"],setup(T,{emit:_}){const C=T,w=_,{service:n}=S(),{t:f}=M(),v=j();async function a(){return n.base.open.eps().then(b=>{const m=[],c=[];for(const e in b)b[e].forEach(t=>{var o;t.prefix=(o=t.prefix)==null?void 0:o.replace("/admin/",""),t.prefix&&c.push(t.prefix),m.push(t)});return{prop:"entity",label:f("实体数据"),component:{name:"el-cascader",props:{options:H(c),separator:".",props:{multiple:!0},onChange(e){var o;const t=[];e.forEach(i=>{const p=m.find(u=>u.prefix==i.join("/"));p&&(p.api.forEach(u=>{u.perms=(p.prefix+u.path).replace(/\//g,":"),u.checked=!0}),t.push(p))}),(o=v.value)==null||o.setForm("list",t)}}}}})}async function h(){var b;w("open"),(b=v.value)==null||b.open({title:f("自动添加权限"),width:"800px",dialog:{draggable:!0,controls:["close"]},props:{labelPosition:"top"},op:{saveButtonText:f("一键添加")},items:[await a(),{prop:"list",label:f("权限列表"),value:[],hidden({scope:m}){return!m.entity},component:{name:"slot-list"}}],on:{submit(m,{done:c,close:e}){if(!m.entity){x.error(f("请选择实体数据")),c();return}const t=m.list.map(o=>o.api).flat().filter(o=>o.checked);if(t.find(o=>!o.summary)){x.error(f("请填写权限名称")),c();return}if(t.length==0){x.error(f("请至少选择一个权限")),c();return}Promise.all(t.map(o=>n.base.sys.menu.add({type:2,parentId:C.menuId,name:o.summary,perms:o.perms}))).then(()=>{x.success(f("添加权限成功")),e(),w("close")}).catch(o=>{c(),x.error(o.message)})}}})}return(b,m)=>{const c=r("el-button"),e=r("el-divider"),t=r("el-switch"),o=r("el-input"),i=r("cl-menu-perms"),p=r("el-scrollbar"),u=r("cl-form");return y(),g(N,null,[P(K)?(y(),E(c,{key:0,style:{"margin-left":"10px"},onClick:h},{default:d(()=>[I(A(b.$t("自动添加")),1)]),_:1})):J("",!0),l(u,{ref_key:"Form",ref:v},{"slot-list":d(({scope:U})=>[l(p,{class:"scrollbar"},{default:d(()=>[(y(!0),g(N,null,D(U.list,(B,R)=>(y(),g("div",{key:R,class:"list"},[l(e,{"content-position":"left"},{default:d(()=>[I(A(B.prefix),1)]),_:2},1024),(y(!0),g(N,null,D(B.api,(k,O)=>(y(),g("div",{key:O,class:"item"},[l(t,{modelValue:k.checked,"onUpdate:modelValue":F=>k.checked=F},null,8,["modelValue","onUpdate:modelValue"]),l(o,{modelValue:k.summary,"onUpdate:modelValue":F=>k.summary=F,clearable:"",placeholder:b.$t("权限名称"),disabled:!k.checked},null,8,["modelValue","onUpdate:modelValue","placeholder","disabled"]),l(i,{modelValue:k.perms,"onUpdate:modelValue":F=>k.perms=F,disabled:!k.checked},null,8,["modelValue","onUpdate:modelValue","disabled"])]))),128))]))),128))]),_:2},1024)]),_:1},512)],64)}}}),ve=G(ye,[["__scopeId","data-v-a139a190"]]),we={key:1},ge={key:1},ke={key:1},xe=V({name:"undefined"}),yt=V({...xe,name:"sys-menu",setup(T){const{service:_,mitt:C}=S(),{menu:w}=te(),{t:n}=M(),f=se({type:[{label:n("目录"),value:0,type:"warning"},{label:n("菜单"),value:1,type:"success"},{label:n("权限"),value:2,type:"danger"}]}),v=Z({contextMenu:[e=>({label:n("新增"),hidden:!(e.type!=2&&_.base.sys.user._permission.add),callback(t){m(e),t()}}),"update","delete",e=>({label:n("权限"),hidden:!(e.type!=2&&_.base.sys.user._permission.add),callback(t){c(e),t()}})],columns:[{type:"selection"},{prop:"name",label:n("名称"),align:"left",width:200,fixed:"left"},{prop:"isShow",label:n("是否显示"),width:100},{prop:"icon",label:n("图标"),width:100},{prop:"type",label:n("类型"),width:110,dict:f.type},{prop:"router",label:n("节点路由"),minWidth:170},{prop:"keepAlive",label:n("路由缓存"),width:100},{prop:"viewPath",label:n("文件路径"),minWidth:200,showOverflowTooltip:!0},{prop:"perms",label:n("权限"),headerAlign:"center",minWidth:300,component:{name:"cl-dict"}},{prop:"orderNum",label:n("排序号"),width:100,fixed:"right",sortable:"asc"},{prop:"updateTime",label:n("更新时间"),sortable:"custom",width:170},{type:"op",width:250,buttons({scope:e}){return[{label:n("新增"),type:"success",hidden:!(_.base.sys.menu._permission.add&&e.row.type!=2),onClick({scope:t}){m(t.row)}},"edit","delete"]}}],plugins:[q.Table.toTree({lazy:!0})]}),a=ee({dialog:{width:"800px"},items:[{prop:"type",value:0,label:n("节点类型"),required:!0,component:{name:"el-radio-group",options:f.type}},{prop:"name",label:n("节点名称"),component:{name:"el-input"},required:!0},{prop:"parentId",label:n("上级节点"),hook:{submit(e){return e||null}},component:{name:"slot-parentId"}},{prop:"router",label:n("节点路由"),hidden:({scope:e})=>e.type!=1,component:{name:"el-input",props:{placeholder:n("请输入节点路由，如：/test")}}},{prop:"keepAlive",value:!0,label:n("路由缓存"),hidden:({scope:e})=>e.type!=1,component:{name:"el-radio-group",options:[{label:n("开启"),value:!0},{label:n("关闭"),value:!1}]}},{prop:"isShow",label:n("是否显示"),value:!0,hidden:({scope:e})=>e.type==2,flex:!1,component:{name:"el-switch"}},{prop:"viewPath",label:n("文件路径"),hidden:({scope:e})=>e.type!=1,component:{name:"cl-menu-file"}},{prop:"icon",label:n("图标"),hidden:({scope:e})=>e.type==2,component:{name:"cl-menu-icon",props:{showIcon:!0}}},{prop:"orderNum",label:n("排序号"),component:{name:"el-input-number",props:{placeholder:n("请填写排序号"),min:0,max:99,"controls-position":"right"}}},{prop:"perms",label:"权限",hidden:({scope:e})=>e.type!=2,component:{name:"slot-perms"}}],plugins:[q.Form.setFocus("name")]}),h=W({service:_.base.sys.menu,onRefresh(e,{render:t}){_.base.sys.menu.list(e).then(o=>{w.get(),t(o)})}},e=>{e.refresh({prop:"orderNum",order:"asc"})});function b(e){var t;(t=h.value)==null||t.refresh(e)}function m({type:e=0,id:t}){var o;(o=h.value)==null||o.rowAppend({parentId:t,parentType:e,type:e+1,keepAlive:!0,isShow:!0})}function c({id:e}){var t;(t=h.value)==null||t.rowAppend({parentId:e,type:2})}return C.on("helper.createMenu",b),(e,t)=>{const o=r("cl-refresh-btn"),i=r("cl-add-btn"),p=r("cl-multi-delete-btn"),u=r("cl-flex1"),U=r("cl-row"),B=r("cl-svg"),R=r("cl-switch"),k=r("el-link"),O=r("cl-table"),F=r("cl-menu-select"),Q=r("cl-menu-perms"),X=r("cl-upsert"),Y=r("cl-crud");return y(),E(Y,{ref_key:"Crud",ref:h},{default:d(()=>[l(U,null,{default:d(()=>{var s;return[l(o),l(i),l(p),l(he),l(u),l(me),l(de,{data:(s=P(v))==null?void 0:s.data},null,8,["data"])]}),_:1}),l(U,null,{default:d(()=>[l(O,{ref_key:"Table",ref:v},{"column-icon":d(({scope:s})=>[l(B,{name:s.row.icon,size:16},null,8,["name"])]),"column-isShow":d(({scope:s})=>[s.row.type!=2?(y(),E(R,{key:0,modelValue:s.row.isShow,"onUpdate:modelValue":$=>s.row.isShow=$,scope:s.row,column:s.column},null,8,["modelValue","onUpdate:modelValue","scope","column"])):(y(),g("span",we))]),"column-keepAlive":d(({scope:s})=>[s.row.type==1?(y(),E(R,{key:0,modelValue:s.row.keepAlive,"onUpdate:modelValue":$=>s.row.keepAlive=$,scope:s.row,column:s.column},null,8,["modelValue","onUpdate:modelValue","scope","column"])):(y(),g("span",ge))]),"column-router":d(({scope:s})=>[s.row.type==1?(y(),E(k,{key:0,type:"success",href:s.row.router},{default:d(()=>[I(A(s.row.router),1)]),_:2},1032,["href"])):(y(),g("span",ke,A(s.row.router),1))]),_:1},512)]),_:1}),l(X,{ref_key:"Upsert",ref:a},{"slot-parentId":d(({scope:s})=>[l(F,{modelValue:s.parentId,"onUpdate:modelValue":$=>s.parentId=$,type:s.type},null,8,["modelValue","onUpdate:modelValue","type"])]),"slot-perms":d(({scope:s})=>[l(Q,{modelValue:s.perms,"onUpdate:modelValue":$=>s.perms=$},null,8,["modelValue","onUpdate:modelValue"]),l(ve,{"menu-id":s.parentId,onOpen:t[0]||(t[0]=$=>{var L;return(L=P(a))==null?void 0:L.close()}),onClose:t[1]||(t[1]=$=>b())},null,8,["menu-id"])]),_:1},512)]),_:1},512)}}});export{yt as default};
