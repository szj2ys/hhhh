import{l as le,w as oe}from"./@vue_runtime-dom@3.5.16-DriBzn4z.js";import{V as se}from"./vuedraggable@4.1.0_vue@3.5.16_typescript@5.5.4_-CER8iGrG.js";import{h as re,_ as ie,O as ue}from"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-CeLFb4Nw.js";import{d as ne}from"./comm-Ba3vmJ1R.js";import{u as de,a as pe,E as me,o as ce}from"./index-BDeQYItE.js";import{b as O,a as j}from"./index-BFkfIWv_.js";import{u as fe}from"./index-C83YxYUF.js";import ve from"./index-CqhLmO7l.js";import{C as ge}from"./index-l1IOnGdE.js";import{y as G,w as he,A as be,B as A}from"./lodash-es@4.17.21-BYk7DlcU.js";import{a as H}from"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import{d as Q,v as m,w as ye,P as R,c,o as i,a as D,z as h,y as w,F as _e,i as u,H as n,x as E,J as we,I as ke,n as J}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{u as Be}from"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-Bqjl69Su.js";import{v as ze,y as d}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import{O as L,p as K}from"./@vue_shared@3.5.16-UwmvJIHj.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./sortablejs@1.14.0-BLTWmvcd.js";import"./chardet@2.1.0-CTPPlwpv.js";import"./vue@3.5.16_typescript@5.5.4-EmiCVxlt.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-7kYVjNRB.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-CuUdMqkw.js";import"./store@2.0.12-i6xqVJod.js";import"./mitt@3.0.1-C1z4c41a.js";import"./@codemirror_language-data@6.5.1-Blx1hvTn.js";import"./@codemirror_language@6.11.1-BYrSuhr8.js";import"./@lezer_common@1.2.3-CP7NCNqd.js";import"./@codemirror_state@6.5.2-DQ6R6BiX.js";import"./@marijn_find-cluster-break@1.0.2-DXwl3gUT.js";import"./@codemirror_view@6.37.1-Bd3_Yh4F.js";import"./style-mod@4.1.2-Bc2inJdb.js";import"./w3c-keyname@2.2.8-Vcq4gwWv.js";import"./@lezer_highlight@1.2.1-DwVMghhY.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.16_typescript@5.5.4_-BZ2tmr1d.js";import"./vue-router@4.5.1_vue@3.5.16_typescript@5.5.4_-ODt3CAxp.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.16_echarts@5.6.0_vue@3.5.16_typescript@5.5.4_-Dhz4IGE5.js";import"./echarts@5.6.0-DvAKqd2B.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.1-DcQm8NwP.js";import"./axios@1.9.0-D--XfsWq.js";import"./nprogress@0.2.0-dOd6e7EG.js";import"./@vueuse_shared@9.13.0_vue@3.5.16_typescript@5.5.4_-4q0MSQPl.js";import"./@vueuse_core@9.13.0_vue@3.5.16_typescript@5.5.4_-DmiypGF2.js";import"./@sxzz_popperjs-es@2.11.7-D_chPuIy.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./dayjs@1.11.13-DUxgsv0d.js";import"./async-validator@4.2.5-CDKkdPIV.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-BQoi3Ox2.js";import"./@floating-ui_dom@1.7.1-Ba-2EiSn.js";import"./@floating-ui_core@1.7.1-C83JrwzW.js";import"./@floating-ui_utils@0.2.9-CBkBHzV8.js";import"./@intlify_core-base@11.1.5-rFPZQXdu.js";import"./@intlify_shared@11.1.5-CY44FrR8.js";import"./@intlify_message-compiler@11.1.5-CZ-uatfp.js";const Ce={key:0,class:"cl-upload__file-btn"},Ve={key:0,class:"cl-upload__footer"},Se={key:0,class:"cl-upload__demo is-dragger"},Ue={key:1,class:"cl-upload__demo"},Fe={key:0,class:"text"},Ne={class:"cl-upload__item"},Pe=Q({name:"undefined"}),$e=Q({...Pe,name:"cl-upload",props:{...ge,modelValue:{type:[String,Array],default:()=>[]},type:{type:String,default:"image"},accept:String,multiple:Boolean,limit:Number,limitSize:Number,autoUpload:{type:Boolean,default:!0},size:[String,Number,Array],small:Boolean,icon:null,text:String,showTag:{type:Boolean,default:!0},showFileList:{type:Boolean,default:!0},draggable:Boolean,drag:Boolean,disabled:Boolean,deletable:Boolean,customClass:String,beforeUpload:Function,prefixPath:String},emits:["update:modelValue","change","upload","success","error","progress"],setup(s,{expose:W,emit:X}){le(e=>({eb0f4742:q.value[0],eb0f4704:q.value[1]}));const o=s,f=X,{refs:_,setRefs:T}=de(),{user:Y}=pe(),Z=ne(),{options:k,toUpload:ee}=fe(),{t:b}=Be(),q=m(()=>{const e=o.size||k.size;return(G(e)?e:[e,e]).map(t=>he(t)?t+"px":t)}),v=m(()=>o.isDisabled||o.disabled),I=o.limit||k.limit.upload,B=o.limitSize||k.limit.size,z=m(()=>{if(o.text!==void 0)return o.text;switch(o.type){case"file":return b("选择文件");case"image":return b("选择图片");default:return""}}),x=m(()=>({Authorization:Y.token})),r=ze([]),te=m(()=>o.type=="file"?o.showFileList?!be(r.value):!1:!0),C=m(()=>o.accept||(o.type=="file"?"":"image/*")),V=m(()=>{const e=r.value.length;return o.multiple&&!v.value?I-e>0:e==0});async function S(e,t){function a(){const l={uid:e.uid,size:e.size,name:e.name,type:j(e.name),progress:o.autoUpload?0:100,url:"",preload:"",error:""};if(l.type=="image"&&e instanceof File&&(l.preload=window.webkitURL.createObjectURL(e)),f("upload",l,e),t)A(t,l);else if(o.multiple)if(V.value)r.value.push(l);else return H.warning(b("最多只能上传{n}个文件",{n:I})),!1;else r.value=[l];return!0}if(e.size/1024/1024>=B)return H.error(b("上传文件大小不能超过 {n}MB!",{n:B})),!1;if(o.beforeUpload){let l=o.beforeUpload(e,t,{next:a});return me(l)?l.then(a).catch(()=>null):l&&(l=a()),l}else return a()}function U(e){r.value.splice(e,1),P()}function M(){r.value=[]}async function F(e,t){if(t||(t=r.value.find(a=>a.uid==e.file.uid)),!t)return!1;ee(e.file,{prefixPath:o.prefixPath,onProgress(a){t.progress=a,f("progress",t)}}).then(a=>{A(t,a),f("success",t),P()}).catch(a=>{t.error=a.message,f("error",t)})}function N(){return r.value.find(e=>!e.url)}function P(){if(!N()){const e=O(r.value),t=o.multiple?O(r.value):e[0]||"";f("update:modelValue",t),f("change",t),J(()=>{var a,l;o.prop&&((a=Z.value)==null||a.validateField(o.prop)),(l=_.upload)==null||l.clearFiles()})}}function ae(e){var t;M(),(t=_.upload)==null||t.clearFiles(),J(()=>{var a,l;(a=_.upload)==null||a.handleStart(e),(l=_.upload)==null||l.submit()})}return ye(()=>o.modelValue,e=>{if(N())return!1;const t=(G(e)?e:[e]).filter(Boolean);r.value=t.map((a,l)=>{const p=r.value[l]||{};return A({progress:100,uid:ce()},p,{type:j(a),url:a,preload:p.url==a?p.preload:a})}).filter((a,l)=>o.multiple?!0:l==0)},{immediate:!0}),W({isAdd:V,list:r,check:N,clear:M,remove:U,upload:ae}),(e,t)=>{const a=R("el-button"),l=R("el-upload"),p=R("el-icon");return i(),c("div",{class:K(["cl-upload__wrap",[s.customClass]])},[D("div",{class:K(["cl-upload",[`cl-upload--${s.type}`,{"is-disabled":v.value,"is-multiple":s.multiple,"is-small":s.small}]])},[s.drag?h("",!0):(i(),c(_e,{key:0},[s.type=="file"?(i(),c("div",Ce,[u(l,{ref:d(T)("upload"),drag:s.drag,action:"",accept:C.value,"show-file-list":!1,"before-upload":S,"http-request":F,headers:x.value,multiple:s.multiple,disabled:v.value},{default:n(()=>[E(e.$slots,"default",{},()=>[u(a,{type:"success"},{default:n(()=>[we(L(z.value),1)]),_:1})],!0)]),_:3},8,["drag","accept","headers","multiple","disabled"])])):h("",!0)],64)),te.value?(i(),w(d(se),{key:1,modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=g=>r.value=g),class:"cl-upload__list",tag:"div","ghost-class":"Ghost","drag-class":"Drag","item-key":"uid",disabled:!s.draggable,onEnd:P},{footer:n(()=>[(s.type=="image"||s.drag)&&V.value?(i(),c("div",Ve,[u(l,{ref:d(T)("upload"),action:"",drag:s.drag,accept:C.value,"show-file-list":!1,"before-upload":S,"http-request":F,headers:x.value,multiple:s.multiple,disabled:v.value},{default:n(()=>[E(e.$slots,"default",{},()=>[s.drag?(i(),c("div",Se,[u(p,{size:46},{default:n(()=>[u(d(ie))]),_:1}),D("div",null,L(d(b)("点击上传或将文件拖动到此处，文件大小限制{n}M",{n:d(B)})),1)])):(i(),c("div",Ue,[u(p,{size:36},{default:n(()=>[s.icon?(i(),w(ke(s.icon),{key:0})):(i(),w(d(ue),{key:1}))]),_:1}),z.value?(i(),c("span",Fe,L(z.value),1)):h("",!0)]))],!0)]),_:3},8,["drag","accept","headers","multiple","disabled"])])):h("",!0)]),item:n(({element:g,index:$})=>[u(l,{action:"",accept:C.value,"show-file-list":!1,"http-request":y=>F(y,g),"before-upload":y=>{S(y,g)},headers:x.value,disabled:v.value},{default:n(()=>[E(e.$slots,"item",{item:g,index:$},()=>[D("div",Ne,[u(ve,{"show-tag":s.showTag,item:g,list:r.value,disabled:v.value,deletable:s.deletable,onRemove:y=>U($)},null,8,["show-tag","item","list","disabled","deletable","onRemove"]),s.small?(i(),w(p,{key:0,class:"cl-upload__item-remove",onClick:oe(y=>U($),["stop"])},{default:n(()=>[u(d(re))]),_:2},1032,["onClick"])):h("",!0)])],!0)]),_:2},1032,["accept","http-request","before-upload","headers","disabled"])]),_:3},8,["modelValue","disabled"])):h("",!0)],2)],2)}}}),At=xe($e,[["__scopeId","data-v-8b1a6295"]]);export{At as default};
