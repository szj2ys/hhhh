import{u as re,m as J,q as ce}from"./index-BDeQYItE.js";import"./store@2.0.12-i6xqVJod.js";import{m as pe}from"./marked@14.1.4-DFvw2-ac.js";import{d as de,B as ue,v as me,o as fe,x as M,z as _e,M as ge,D as ve,A as D}from"./lodash-es@4.17.21-BYk7DlcU.js";import{a as k,b as he}from"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import{d as R,n as ye,v as be,e as ke,P as c,V as Ce,c as w,o as p,a as n,U as we,i as r,H as d,y as v,z as y,F as W,L as q,J as V,I as Ve}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{u as $e}from"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-Bqjl69Su.js";import{u as B,m as Se,y as N}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import{p as xe,O as u}from"./@vue_shared@3.5.16-UwmvJIHj.js";import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vue_runtime-dom@3.5.16-DriBzn4z.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-7kYVjNRB.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-CuUdMqkw.js";import"./mitt@3.0.1-C1z4c41a.js";import"./@codemirror_language-data@6.5.1-Blx1hvTn.js";import"./@codemirror_language@6.11.1-BYrSuhr8.js";import"./@lezer_common@1.2.3-CP7NCNqd.js";import"./@codemirror_state@6.5.2-DQ6R6BiX.js";import"./@marijn_find-cluster-break@1.0.2-DXwl3gUT.js";import"./@codemirror_view@6.37.1-Bd3_Yh4F.js";import"./style-mod@4.1.2-Bc2inJdb.js";import"./w3c-keyname@2.2.8-Vcq4gwWv.js";import"./@lezer_highlight@1.2.1-DwVMghhY.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.16_typescript@5.5.4_-BZ2tmr1d.js";import"./vue-router@4.5.1_vue@3.5.16_typescript@5.5.4_-ODt3CAxp.js";import"./comm-Ba3vmJ1R.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-CeLFb4Nw.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.16_echarts@5.6.0_vue@3.5.16_typescript@5.5.4_-Dhz4IGE5.js";import"./echarts@5.6.0-DvAKqd2B.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.1-DcQm8NwP.js";import"./axios@1.9.0-D--XfsWq.js";import"./nprogress@0.2.0-dOd6e7EG.js";import"./chardet@2.1.0-CTPPlwpv.js";import"./@vueuse_shared@9.13.0_vue@3.5.16_typescript@5.5.4_-4q0MSQPl.js";import"./@vueuse_core@9.13.0_vue@3.5.16_typescript@5.5.4_-DmiypGF2.js";import"./@sxzz_popperjs-es@2.11.7-D_chPuIy.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./dayjs@1.11.13-DUxgsv0d.js";import"./async-validator@4.2.5-CDKkdPIV.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-BQoi3Ox2.js";import"./@floating-ui_dom@1.7.1-Ba-2EiSn.js";import"./@floating-ui_core@1.7.1-C83JrwzW.js";import"./@floating-ui_utils@0.2.9-CBkBHzV8.js";import"./@intlify_core-base@11.1.5-rFPZQXdu.js";import"./@intlify_shared@11.1.5-CY44FrR8.js";import"./@intlify_message-compiler@11.1.5-CZ-uatfp.js";const Be={class:"plugins"},Ne={class:"plugins__header"},Oe={class:"plugins__container"},Pe={class:"item"},Ue={class:"item-inner is-add"},We={class:"item"},qe={class:"item-inner"},Ee={key:0,class:"op"},Fe=["onClick"],Le=["onClick"],Te={class:"c"},Ie={class:"det"},Je={class:"tag"},Me={class:"title line-clamp-1"},De={class:"desc line-clamp-2"},Re={class:"author"},Ae={class:"f"},He={class:"plugins__pics"},je={class:"list"},Xe=["onClick"],Ye=["src"],Ge={class:"op"},Ke={class:"flex align-center mb-[10px] select-none"},Qe={class:"mr-[20px]"},Ze={class:"flex align-center"},eo=R({name:"undefined"}),oo=R({...eo,name:"helper-plugins-vue",setup(to){const{router:A,service:$,refs:C,setRefs:O,mitt:E}=re(),H=J.get("helper"),{t:_}=$e(),{install:j}=ce(),m=B({active:"installed",p:"",list:[{label:_("已安装"),value:"installed"},{label:_("全部插件"),value:"shop"},{label:_("插件开发"),value:"dev"}],change(e){m.active=e},onChange(e){e=="dev"?(m.active=m.p||"installed",ye(()=>{window.open("")})):(m.p=e,l.refresh())}}),S=be(()=>m.active=="installed"),l=B({installed:[],shop:[],data:null,init(){l.refresh(),E.off("plugin.refresh"),E.on("plugin.refresh",()=>{m.change("installed"),l.refresh()})},remove(e,t){he.confirm(_("确定要卸载插件【{name}】吗？",{name:e.name}),_("提示"),{type:"warning"}).then(()=>{$.plugin.info.delete({ids:[e.id]}).then(()=>{l.installed.splice(t,1),k.success(_("卸载成功"))}).catch(o=>{k.error(o.message)})}).catch(()=>null)},async doc(e){e.readme?(l.data=e,C.editorPreview.open(await pe.parse(e.readme))):e.doc&&window.open(e.doc)},onEnable(e){e.isVue?$.request({url:"/__cool_updatePlugin",method:"POST",data:{name:e.name,data:e.config,enable:e.status==1},proxy:!1}):$.plugin.info.update({id:e.id,status:e.status?1:0}).then(()=>{k.success(e.status?_("启用成功"):_("禁用成功"))}).catch(t=>{k.error(t.message)})},keyWord:"",params:{page:1,size:24,isMy:!1},loaded:!1,loading:!1,async refresh(e){if(m.active=="shop"){ue(l.params,e||{});const t={keyWord:l.keyWord||void 0,...l.params};if((l.loaded||l.loading)&&t.page!=1)return;l.loading=!0,await $.request({url:`${H.options.api}/app/plugin/info/page`,method:"POST",data:t}).then(o=>{const a=o.list.map(h=>({...h,label:h.name,name:"",logo:h.avatarUrl,author:h.nickName,doc:""}));t.page==1?l.shop=a:l.shop.push(...a),l.loaded=l.shop.length>=o.pagination.total,l.params.page=o.pagination.page}).catch(o=>{k.error(o.message)}),l.loading=!1}else $.plugin.info.page({size:1e3}).then(t=>{l.installed=t.list.concat(me(J.list.filter(o=>o.type=="plugins"&&o.label),"order","desc")).map(o=>{o.author=="COOL"&&(o.logo="");const a=o.type=="plugins";return a?{...o,label:o.label||o.name,status:o.enable===!1?0:1,config:o.options||{},children:o.views,isVue:a}:{...o,logo:"data:image/jpg;base64,"+o.logo,label:o.name,name:o.keyName,config:o.config||{}}}).filter(o=>l.keyWord?o.label.toLocaleLowerCase().includes(l.keyWord.toLocaleLowerCase()):!0)})},onScroll:de(({scrollTop:e})=>{const{clientHeight:t,scrollHeight:o}=C.scrollbar.wrapRef;e+t>=o&&m.active=="shop"&&l.refresh({page:l.params.page+1})},100)}),x=B({insert(e){const t=C.configInput.ref,o=t.selectionStart;t.value=t.value.slice(0,o)+(e||"")+t.value.slice(o)},formatter(){var e;try{return(e=C.config)==null||e.setForm("config",JSON.stringify(JSON.parse(C.config.form.config),null,4)),!0}catch(t){return k.error(_("参数格式错误")+"："+t),!1}},onFileConfirm(e){const t=e.map(a=>a.url),o=t.length>1?JSON.stringify(t):t[0];x.insert(o)},open(e){var t;(t=C.config)==null||t.open({title:_("设置"),form:{id:e.id,config:e.config},items:[{label:_("参数"),prop:"config",component:{name:"el-input",props:{type:"textarea",rows:15},ref:O("configInput")}},{component:{name:"slot-tools"}}],on:{open(o){if(o.config||(o.config={}),M(o.config))try{o.config=JSON.parse(o.config)}catch{o.config={}}_e(o.config)&&(o.config=JSON.stringify(o.config)),x.formatter()},submit(o,{done:a,close:h}){if(!x.formatter()){a();return}$.plugin.info.update(o).then(()=>{k.success(_("修改成功")),fe(e,o),h()}).catch(z=>{k.error(z.message),a()})}}})},close(){var e;(e=C.config)==null||e.close()}}),f=B({visible:!1,title:"",active:0,tabs:[],async open(e){M(e.demo)?ge(e.demo,"http")?window.open(e.demo):A.push(e.demo):(f.visible=!0,f.active=0,f.tabs=[],f.title=e.label,f.tabs=await Promise.all((e.demo||[]).map(async t=>{if(t){const o=await(ve(t.component)?t.component():t.component);return{...t,component:Se(o.default)}}})))},close(){f.visible=!1}}),i=B({visible:!1,show:!1,index:0,list:[],preview(e){i.visible=!0,i.list=e},open(e){i.show=!0,i.index=e},close(){i.visible=!1},onClose(){i.show=!1},prev(){var e;(e=document.querySelector(".plugins__pics .list"))==null||e.scrollBy({left:-500,behavior:"smooth"})},next(){var e;(e=document.querySelector(".plugins__pics .list"))==null||e.scrollBy({left:500,behavior:"smooth"})}});function X(e){return j(e),!1}function Y(e){if(!S.value)return!1;document.querySelectorAll(".plugins .list .item").forEach(o=>{const a=o.getBoundingClientRect(),h=e.clientX-a.left-250,z=e.clientY-a.top-250;e.type!=="scroll"&&requestAnimationFrame(()=>{o.style.setProperty("--x",`${h}px`),o.style.setProperty("--y",`${z}px`)})})}return ke(()=>{l.init()}),(e,t)=>{var T,I;const o=c("cl-select-button"),a=c("cl-svg"),h=c("el-input"),z=c("cl-upload"),F=c("el-col"),G=c("cl-image"),U=c("el-tag"),K=c("cl-switch"),P=c("el-button"),Q=c("el-row"),Z=c("el-empty"),ee=c("el-scrollbar"),oe=c("el-tab-pane"),te=c("el-tabs"),L=c("cl-dialog"),se=c("el-image-viewer"),le=c("cl-editor-preview"),ne=c("cl-upload-space"),ie=c("cl-form"),ae=Ce("loading");return p(),w("div",Be,[n("div",Ne,[r(o,{modelValue:m.active,"onUpdate:modelValue":t[0]||(t[0]=s=>m.active=s),options:m.list,onChange:m.onChange},null,8,["modelValue","options","onChange"]),r(h,{class:"search",modelValue:l.keyWord,"onUpdate:modelValue":t[1]||(t[1]=s=>l.keyWord=s),placeholder:e.$t("搜索插件名称"),clearable:"",onChange:t[2]||(t[2]=s=>l.refresh({page:1}))},{prefix:d(()=>[r(a,{name:"search",size:16})]),_:1},8,["modelValue","placeholder"])]),we((p(),w("div",Oe,[r(ee,{ref:N(O)("scrollbar"),onScroll:l.onScroll},{default:d(()=>[n("div",{class:xe(["list",{"is-installed":S.value}]),onMousemove:Y},[r(Q,{gutter:10},{default:d(()=>[S.value?(p(),v(F,{key:0,xs:24,sm:12,md:8,lg:6},{default:d(()=>[n("div",Pe,[r(z,{"before-upload":X,accept:".cool"},{default:d(()=>[n("div",Ue,[r(a,{name:"plus"})])]),_:1})])]),_:1})):y("",!0),(p(!0),w(W,null,q(l[m.active],(s,g)=>(p(),v(F,{key:g,xs:24,sm:12,md:8,lg:6},{default:d(()=>[n("div",We,[n("div",qe,[S.value&&!s.isVue?(p(),w("div",Ee,[n("div",{class:"cl-comm__icon is-delete",onClick:b=>l.remove(s,g)},[r(a,{name:"delete"})],8,Fe),n("div",{class:"cl-comm__icon is-set",onClick:b=>x.open(s)},[r(a,{name:"set"})],8,Le)])):y("",!0),n("div",Te,[r(G,{class:"mr-[15px]",radius:6,src:s.logo,size:40},null,8,["src"]),n("div",Ie,[n("div",Je,[s.name?(p(),v(U,{key:0,"disable-transitions":"",size:"small",effect:"dark"},{default:d(()=>[V(u(s.name),1)]),_:2},1024)):y("",!0),r(U,{"disable-transitions":"",size:"small",effect:"plain"},{default:d(()=>[V(" v"+u(s.version||"1.0.0"),1)]),_:2},1024),S.value?(p(),v(U,{key:1,"disable-transitions":"",size:"small",effect:"plain",type:s.isVue?"success":"info"},{default:d(()=>[V(u(s.isVue?"Vue":e.$t("后端")),1)]),_:2},1032,["type"])):y("",!0)]),n("p",Me,u(s.label||e.$t("未知")),1),n("p",De,u(s.description||e.$t("暂无描述")),1),n("div",Re,[n("span",null,u(s.author||"Ta")+"：",1),n("span",null,u(s.updateTime||"2025-01-01"),1)])])]),n("div",Ae,[S.value&&(!s.isVue||s.enable!==void 0)?(p(),v(K,{key:0,modelValue:s.status,"onUpdate:modelValue":b=>s.status=b,onChange:b=>l.onEnable(s)},null,8,["modelValue","onUpdate:modelValue","onChange"])):y("",!0),t[9]||(t[9]=n("span",{class:"mr-auto"},null,-1)),s.demo?(p(),v(P,{key:1,type:"success",onClick:b=>f.open(s)},{default:d(()=>[V(u(e.$t("示例")),1)]),_:2},1032,["onClick"])):y("",!0),N(D)(s.pics)?y("",!0):(p(),v(P,{key:2,type:"success",onClick:b=>i.preview(s.pics)},{default:d(()=>[V(u(e.$t("预览")),1)]),_:2},1032,["onClick"])),s.doc||s.readme?(p(),v(P,{key:3,onClick:b=>l.doc(s)},{default:d(()=>[V(u(e.$t("文档")),1)]),_:2},1032,["onClick"])):y("",!0)])])])]),_:2},1024))),128))]),_:1})],34),N(D)(l[m.active])?(p(),v(Z,{key:0,"image-size":80})):y("",!0)]),_:1},8,["onScroll"])])),[[ae,l.loading]]),r(L,{modelValue:f.visible,"onUpdate:modelValue":t[4]||(t[4]=s=>f.visible=s),title:f.title,width:"60%"},{default:d(()=>[r(te,{modelValue:f.active,"onUpdate:modelValue":t[3]||(t[3]=s=>f.active=s),type:"card"},{default:d(()=>[(p(!0),w(W,null,q(f.tabs,(s,g)=>(p(),v(oe,{key:g,label:s.name,name:g,lazy:g!=0},{default:d(()=>[(p(),v(Ve(s.component)))]),_:2},1032,["label","name","lazy"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"]),r(L,{modelValue:i.visible,"onUpdate:modelValue":t[8]||(t[8]=s=>i.visible=s),title:e.$t("图片预览"),width:"80%",padding:"0","hide-header":"",transparent:""},{default:d(()=>[n("div",He,[n("div",{class:"close",onClick:t[5]||(t[5]=(...s)=>i.close&&i.close(...s))},[r(a,{name:"close"})]),n("div",je,[(p(!0),w(W,null,q(i.list,(s,g)=>(p(),w("div",{class:"item",key:g,onClick:b=>i.open(g)},[n("img",{src:s},null,8,Ye)],8,Xe))),128))]),n("div",Ge,[n("div",{class:"prev",onClick:t[6]||(t[6]=(...s)=>i.prev&&i.prev(...s))},[r(a,{name:"left"})]),n("div",{class:"next",onClick:t[7]||(t[7]=(...s)=>i.next&&i.next(...s))},[r(a,{name:"right"})])])]),i.visible&&i.show?(p(),v(se,{key:0,"url-list":i.list,infinite:"","initial-index":i.index,teleported:"",onClose:i.onClose},null,8,["url-list","initial-index","onClose"])):y("",!0)]),_:1},8,["modelValue","title"]),r(le,{ref:N(O)("editorPreview"),name:"wang","show-btn":!1,title:`${(T=l.data)==null?void 0:T.name}（v${(I=l.data)==null?void 0:I.version}）${e.$t("说明文档")}`},{prepend:d(()=>{var s,g;return[n("div",Ke,[n("span",Qe,u(e.$t("作者"))+"："+u((s=l.data)==null?void 0:s.author),1),n("span",null,u(e.$t("更新时间"))+"："+u((g=l.data)==null?void 0:g.updateTime),1)])]}),_:1},8,["title"]),r(ie,{ref:N(O)("config")},{"slot-tools":d(()=>[n("div",Ze,[r(P,{type:"success",onClick:x.formatter},{default:d(()=>[V(u(e.$t("格式化")),1)]),_:1},8,["onClick"]),r(ne,{"show-list":!1,text:e.$t("插入文件链接"),onConfirm:x.onFileConfirm},null,8,["text","onConfirm"])])]),_:1},512)])}}}),Qo=ze(oo,[["__scopeId","data-v-e163c526"]]);export{Qo as default};
