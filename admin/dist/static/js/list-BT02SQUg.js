import{c as N,u as U,e as F}from"./comm-Ba3vmJ1R.js";import{u as V}from"./index-C5WS2hJt.js";import"./store@2.0.12-i6xqVJod.js";import{C as I}from"./config-d1gIbpxo.js";import{d as P}from"./lodash-es@4.17.21-BYk7DlcU.js";import{a as S}from"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import{d as v,P as t,y as $,o as T,H as p,i as e,a as q,c as J,F as E,n as L}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{u as O,v as x,y as B}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vue_runtime-dom@3.5.16-DriBzn4z.js";import"./@vue_shared@3.5.16-UwmvJIHj.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-CeLFb4Nw.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-7kYVjNRB.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-CuUdMqkw.js";import"./mitt@3.0.1-C1z4c41a.js";import"./@codemirror_language-data@6.5.1-Blx1hvTn.js";import"./@codemirror_language@6.11.1-BYrSuhr8.js";import"./@lezer_common@1.2.3-CP7NCNqd.js";import"./@codemirror_state@6.5.2-DQ6R6BiX.js";import"./@marijn_find-cluster-break@1.0.2-DXwl3gUT.js";import"./@codemirror_view@6.37.1-Bd3_Yh4F.js";import"./style-mod@4.1.2-Bc2inJdb.js";import"./w3c-keyname@2.2.8-Vcq4gwWv.js";import"./@lezer_highlight@1.2.1-DwVMghhY.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.16_typescript@5.5.4_-BZ2tmr1d.js";import"./vue-router@4.5.1_vue@3.5.16_typescript@5.5.4_-ODt3CAxp.js";import"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-Bqjl69Su.js";import"./@intlify_core-base@11.1.5-rFPZQXdu.js";import"./@intlify_shared@11.1.5-CY44FrR8.js";import"./@intlify_message-compiler@11.1.5-CZ-uatfp.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.16_echarts@5.6.0_vue@3.5.16_typescript@5.5.4_-Dhz4IGE5.js";import"./echarts@5.6.0-DvAKqd2B.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.1-DcQm8NwP.js";import"./axios@1.9.0-D--XfsWq.js";import"./nprogress@0.2.0-dOd6e7EG.js";import"./chardet@2.1.0-CTPPlwpv.js";import"./@vueuse_shared@9.13.0_vue@3.5.16_typescript@5.5.4_-4q0MSQPl.js";import"./@vueuse_core@9.13.0_vue@3.5.16_typescript@5.5.4_-DmiypGF2.js";import"./@sxzz_popperjs-es@2.11.7-D_chPuIy.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./dayjs@1.11.13-DUxgsv0d.js";import"./async-validator@4.2.5-CDKkdPIV.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-BQoi3Ox2.js";import"./@floating-ui_dom@1.7.1-Ba-2EiSn.js";import"./@floating-ui_core@1.7.1-C83JrwzW.js";import"./@floating-ui_utils@0.2.9-CBkBHzV8.js";import"./group-CxGNcSJX.js";const j=v({name:"undefined"}),A=v({...j,name:"flow-tools-import",props:{limit:{type:Number,default:2},limitSize:{type:Number,default:15},type:{type:String,default:"success"},icon:String,disabled:Boolean,accept:{type:String,default:".json"}},emits:["change","success"],setup(b,{emit:_}){const{service:d}=V(),f=b,h=_,n=O({filename:"",file:null,list:[],reset:()=>{n.filename="",n.file=null,n.list=[]}}),r=x(!1);function c(l,y,{next:s}){const a=new FileReader;return a.onload=u=>{const w=u.target.result;try{const i=JSON.parse(w);n.list.push(i),n.filename=l.name,n.file=l,h("change",i)}catch{S.error("导入失败，请检查文件后重新上传")}},a.readAsText(l,"UTF-8"),s(),g(),!1}const g=P(o,500);function o(){if(r.value||n.list.length>f.limit)return!1;r.value=!0,d.flow.info.add(n.list).finally(()=>{r.value=!1,n.reset()}).then(()=>{S.success("导入成功"),h("success")}).catch(l=>{S.error(`导入失败：${l.message}`)})}return(l,y)=>{const s=t("cl-svg"),a=t("el-button"),u=t("cl-upload");return T(),$(u,{type:"file",multiple:"","limit-size":b.limitSize,limit:b.limit,accept:b.accept,disabled:r.value||b.disabled,"auto-upload":!1,"before-upload":c,size:[220,"100%"],showFileList:!1},{default:p(()=>[e(a,{type:"success"},{default:p(()=>[e(s,{name:"flow-import"}),y[0]||(y[0]=q("span",{class:"text"},"导入",-1))]),_:1,__:[0]})]),_:1},8,["limit-size","limit","accept","disabled"])}}}),H=M(A,[["__scopeId","data-v-8bded5b3"]]),D=v({name:"undefined"}),G=v({...D,name:"flow-tools-log-detail",setup(b,{expose:_}){const d=x(),f=x(!1);function h(r){r.nodeInfo&&(d.value=r.nodeInfo),f.value=!0}function n(){f.value=!1}return _({open:h,close:n}),(r,c)=>{const g=t("cl-editor-monaco"),o=t("cl-dialog");return T(),$(o,{modelValue:f.value,"onUpdate:modelValue":c[1]||(c[1]=l=>f.value=l),title:r.$t("节点运行信息"),width:"70%"},{default:p(()=>[e(g,{modelValue:d.value,"onUpdate:modelValue":c[0]||(c[0]=l=>d.value=l),height:"800px"},null,8,["modelValue"])]),_:1},8,["modelValue","title"])}}}),K=v({name:"undefined"}),Q=v({...K,name:"flow-tools-log",setup(b,{expose:_}){const{service:d,refs:f,setRefs:h}=V(),n=O({type:[{label:"失败",type:"danger",value:0},{label:"成功",type:"success",value:1},{label:"未知",type:"info",value:2}]}),r=x(!1);function c(s){r.value=!0,L(()=>{y({flowId:s.id})})}function g(){r.value=!1}const o=N({contextMenu:[],columns:[{label:"流程名称",prop:"flowName",minWidth:140},{label:"流程label",prop:"flowLabel",minWidth:120},{label:"传入参数",prop:"inputParams",minWidth:160,showOverflowTooltip:!0},{label:"结果",prop:"result",width:160,showOverflowTooltip:!0},{label:"创建时间",prop:"createTime",width:170,sortable:"custom"},{label:"执行状态",prop:"type",width:140,fixed:"right",dict:n.type},{type:"op",width:120,buttons:[{label:"运行信息",onClick:({scope:s})=>{f.det.open(s.row)}}]}]}),l=U({service:d.flow.log,async onRefresh(s,{render:a}){var i;const u=await d.flow.log.page(s),w=((i=u.list)==null?void 0:i.map(m=>({...m,inputParams:m.inputParams?JSON.stringify(m.inputParams):"",result:m.result?JSON.stringify(m.result):""})))??[];a(w,u.pagination)}});function y(s){var a;(a=l.value)==null||a.refresh(s)}return _({open:c,close:g}),(s,a)=>{const u=t("cl-refresh-btn"),w=t("cl-flex1"),i=t("cl-select"),m=t("cl-row"),k=t("cl-table"),C=t("cl-pagination"),W=t("cl-crud"),R=t("cl-dialog");return T(),J(E,null,[e(R,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=z=>r.value=z),width:"80%",title:"调用日志"},{default:p(()=>[e(W,{ref_key:"Crud",ref:l,padding:"0"},{default:p(()=>[e(m,null,{default:p(()=>[e(u),e(w),e(i,{width:120,options:n.type,prop:"type",placeholder:"状态"},null,8,["options"])]),_:1}),e(m,null,{default:p(()=>[e(k,{ref_key:"Table",ref:o,"auto-height":!1},null,512)]),_:1}),e(m,null,{default:p(()=>[e(w),e(C)]),_:1})]),_:1},512)]),_:1},8,["modelValue"]),e(G,{ref:B(h)("det")},null,512)],64)}}}),X=v({name:"undefined"}),De=v({...X,name:"flow-list",setup(b){const{service:_,router:d,refs:f,setRefs:h}=V(),n=F({props:{labelWidth:"60px"},items:[{label:"名称",prop:"name",component:{name:"el-input",props:{clearable:!0}},required:!0,span:12},{label:"标签",prop:"label",component:{name:"el-input",props:{clearable:!0,placeholder:"调用流程的标识"}},required:!0,span:12},{label:"状态",prop:"status",flex:!1,value:1,component:{name:"cl-switch"}},{label:"描述",prop:"description",component:{name:"el-input",props:{type:"textarea",rows:4}}}]}),r=N({columns:[{type:"selection"},{label:"名称",prop:"name",minWidth:140},{label:"标签",prop:"label",minWidth:140},{label:"状态",prop:"status",minWidth:100,component:{name:"cl-switch"}},{label:"版本",prop:"version",minWidth:100},{label:"发布时间",prop:"releaseTime",minWidth:170,sortable:"desc",formatter(o){return o.releaseTime||"未发布"}},{label:"描述",prop:"description",showOverflowTooltip:!0,minWidth:200},{label:"创建时间",prop:"createTime",minWidth:170,sortable:"custom"},{label:"更新时间",prop:"updateTime",minWidth:170,sortable:"custom"},{type:"op",buttons:["edit","delete",{label:"编排",type:"success",hidden:!_.flow.info._permission.update,onClick({scope:o}){d.push({path:"/flow/info",query:{id:o.row.id}})}},{label:"日志",hidden:!_.flow.info._permission.update,onClick({scope:o}){var l;(l=f.logRef)==null||l.open(o.row)}}],width:320}]}),c=U({service:_.flow.info},o=>{o.refresh()});function g(){var o;(o=c.value)==null||o.refresh()}return(o,l)=>{const y=t("cl-refresh-btn"),s=t("cl-add-btn"),a=t("cl-multi-delete-btn"),u=t("cl-flex1"),w=t("cl-search-key"),i=t("cl-row"),m=t("cl-table"),k=t("cl-pagination"),C=t("cl-upsert"),W=t("cl-crud");return T(),$(W,{ref_key:"Crud",ref:c},{default:p(()=>[e(i,null,{default:p(()=>[e(y),e(s),e(a),e(I),e(H,{onSuccess:g}),e(u),e(w,{placeholder:"搜索名称、标签"})]),_:1}),e(i,null,{default:p(()=>[e(m,{ref_key:"Table",ref:r},null,512)]),_:1}),e(i,null,{default:p(()=>[e(u),e(k)]),_:1}),e(C,{ref_key:"Upsert",ref:n},null,512),e(Q,{ref:B(h)("logRef")},null,512)]),_:1},512)}}});export{De as default};
