import{d as Y,b as re,u as Z,c as se,e as ae}from"./comm-Ba3vmJ1R.js";import{u as S,e as le,r as ie,f as E,P as pe}from"./index-C5WS2hJt.js";import"./store@2.0.12-i6xqVJod.js";import{w as ce}from"./@vue_runtime-dom@3.5.16-DriBzn4z.js";import{J as me}from"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-CeLFb4Nw.js";import{u as ee}from"./group-CxGNcSJX.js";import{b as O,a as I}from"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import{y as de}from"./lodash-es@4.17.21-BYk7DlcU.js";import{d as D,e as ue,P as c,V as te,c as W,o as w,a as C,i as s,H as d,J,F as _e,z as X,U as R,y as P,n as fe}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{u as H}from"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-Bqjl69Su.js";import{v as L,y as v}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import{O as G,p as be}from"./@vue_shared@3.5.16-UwmvJIHj.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-7kYVjNRB.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-CuUdMqkw.js";import"./mitt@3.0.1-C1z4c41a.js";import"./@codemirror_language-data@6.5.1-Blx1hvTn.js";import"./@codemirror_language@6.11.1-BYrSuhr8.js";import"./@lezer_common@1.2.3-CP7NCNqd.js";import"./@codemirror_state@6.5.2-DQ6R6BiX.js";import"./@marijn_find-cluster-break@1.0.2-DXwl3gUT.js";import"./@codemirror_view@6.37.1-Bd3_Yh4F.js";import"./style-mod@4.1.2-Bc2inJdb.js";import"./w3c-keyname@2.2.8-Vcq4gwWv.js";import"./@lezer_highlight@1.2.1-DwVMghhY.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.16_typescript@5.5.4_-BZ2tmr1d.js";import"./vue-router@4.5.1_vue@3.5.16_typescript@5.5.4_-ODt3CAxp.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.16_echarts@5.6.0_vue@3.5.16_typescript@5.5.4_-Dhz4IGE5.js";import"./echarts@5.6.0-DvAKqd2B.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.1-DcQm8NwP.js";import"./axios@1.9.0-D--XfsWq.js";import"./nprogress@0.2.0-dOd6e7EG.js";import"./chardet@2.1.0-CTPPlwpv.js";import"./@vueuse_shared@9.13.0_vue@3.5.16_typescript@5.5.4_-4q0MSQPl.js";import"./@vueuse_core@9.13.0_vue@3.5.16_typescript@5.5.4_-DmiypGF2.js";import"./@sxzz_popperjs-es@2.11.7-D_chPuIy.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./dayjs@1.11.13-DUxgsv0d.js";import"./async-validator@4.2.5-CDKkdPIV.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-BQoi3Ox2.js";import"./@floating-ui_dom@1.7.1-Ba-2EiSn.js";import"./@floating-ui_core@1.7.1-C83JrwzW.js";import"./@floating-ui_utils@0.2.9-CBkBHzV8.js";import"./@intlify_core-base@11.1.5-rFPZQXdu.js";import"./@intlify_shared@11.1.5-CY44FrR8.js";import"./@intlify_message-compiler@11.1.5-CZ-uatfp.js";const he={class:"dept-tree"},ye={class:"dept-tree__header"},we={class:"dept-tree__op"},ge={key:0,class:"btns"},ke={class:"dept-tree__node"},xe=["onClick"],Ce=D({name:"undefined"}),Ie=D({...Ce,name:"dept-list",props:{drag:{type:Boolean,default:!0},level:{type:Number,default:99}},emits:["refresh","user-add"],setup(q,{emit:g}){const F=q,N=g,{service:t,browser:u}=S(),k=Y(),{ViewGroup:b}=ee(),{t:o}=H(),_=L([]),x=L(!1),h=L(!1);function a({data:n}){return n.parentId}function l(n,e){return e.data.parentId}async function m(){x.value=!0,h.value=!1,await t.base.sys.department.list().then(n=>{var e;_.value=le(n),(e=b.value)!=null&&e.selected||y()}),x.value=!1}function y(n){var e;if(n||(n=_.value[0]),n){const p=n.children?ie(n.children).map(r=>r.id):[];p.unshift(n.id),(e=b.value)==null||e.select(n),fe(()=>{N("refresh",{page:1,departmentIds:p})})}}function U(n){var p;const e=n.id?"update":"add";(p=k.value)==null||p.open({title:o("编辑部门"),width:"550px",props:{labelWidth:"100px"},items:[{label:o("部门名称"),prop:"name",component:{name:"el-input"},required:!0},{label:o("上级部门"),prop:"parentName",component:{name:"el-input",props:{disabled:!0}}},{label:o("排序"),prop:"orderNum",component:{name:"el-input-number",props:{"controls-position":"right",min:0,max:100}}}],form:{...n},on:{submit(r,{done:i,close:f}){t.base.sys.department[e]({id:n.id,parentId:n.parentId,name:r.name,orderNum:r.orderNum}).then(()=>{I.success(o("新增部门 “{name}” 成功",{name:r.name})),f(),m()}).catch($=>{I.error($.message),i()})}}})}function A(n){async function e(p){await t.base.sys.department.delete({ids:[n.id],deleteUser:p}).then(()=>{var r,i;((i=(r=b.value)==null?void 0:r.selected)==null?void 0:i.id)==n.id&&y(),p?I.success(o("删除成功")):O.confirm(o("“{name}” 部门的用户已成功转移到 “{parentName}” 部门。",{name:n.name,parentName:n.parentName}),o("删除成功"))}),m()}O.confirm(o("此操作将会删除 “{name}” 部门的所有用户，是否确认？",{name:n.name}),o("提示"),{type:"warning",confirmButtonText:o("直接删除"),cancelButtonText:o("保留用户"),distinguishCancelAndClose:!0}).then(()=>{e(!0)}).catch(p=>{p=="cancel"&&e(!1)})}function V(n){n?O.confirm(o("部门架构已发生改变，是否保存？"),o("提示"),{type:"warning"}).then(async()=>{const e=[];function p(r,i){r.forEach(f=>{f.parentId=i,e.push(f),f.children&&de(f.children)&&p(f.children,f.id)})}p(_.value,null),await t.base.sys.department.order(e.map((r,i)=>({id:r.id,parentId:r.parentId,orderNum:i}))).then(()=>{I.success(o("更新排序成功"))}).catch(r=>{I.error(r.message)}),m(),h.value=!1}).catch(()=>null):m()}function B(n,e,p){e||(e=_.value[0]||{});const r=t.base.sys.department.permission;re.open(n,{list:[{label:o("新增"),hidden:p&&p.level>=F.level||!E(r.add),callback(i){U({name:"",parentName:e.name,parentId:e.id}),i()}},{label:o("编辑"),hidden:!E(r.update),callback(i){U(e),i()}},{label:o("删除"),hidden:!e.parentId||!E(r.delete),callback(i){A(e),i()}},{label:o("新增成员"),hidden:!E(r.add),callback(i){N("user-add",e),i()}}]})}return ue(function(){m()}),(n,e)=>{const p=c("el-text"),r=c("cl-svg"),i=c("el-tooltip"),f=c("el-icon"),$=c("el-tree"),M=c("el-scrollbar"),z=c("cl-form"),ne=te("loading");return w(),W("div",he,[C("div",ye,[s(p,null,{default:d(()=>[J(G(v(o)("组织架构")),1)]),_:1}),C("div",we,[h.value?(w(),W("div",ge,[C("div",{class:"item",onClick:e[0]||(e[0]=T=>V(!0))},[s(r,{name:"success"})]),C("div",{class:"item",onClick:e[1]||(e[1]=T=>V(!1))},[s(r,{name:"fail"})])])):(w(),W(_e,{key:1},[C("div",{class:"item",onClick:e[2]||(e[2]=T=>m())},[s(i,{content:v(o)("刷新")},{default:d(()=>[s(r,{name:"refresh"})]),_:1},8,["content"])]),q.drag&&!v(u).isMini?(w(),W("div",{key:0,class:"item",onClick:e[3]||(e[3]=T=>h.value=!0)},[s(i,{content:v(o)("拖动排序")},{default:d(()=>[s(r,{name:"sort"})]),_:1},8,["content"])])):X("",!0)],64))])]),C("div",{class:"dept-tree__container",onContextmenu:ce(B,["stop","prevent"])},[s(M,null,{default:d(()=>[R((w(),P($,{"node-key":"id","default-expand-all":"",data:_.value,props:{label:"name"},"highlight-current":"",draggable:h.value,"allow-drag":a,"allow-drop":l,"expand-on-click-node":!1,onNodeContextmenu:B,onNodeClick:y},{default:d(({node:T,data:j})=>{var K,Q;return[C("div",ke,[C("span",{class:be(["dept-tree__node-label",{"is-active":j.id==((Q=(K=v(b))==null?void 0:K.selected)==null?void 0:Q.id)}])},G(T.label),3),v(u).isMini?(w(),W("span",{key:0,class:"dept-tree__node-icon",onClick:oe=>B(oe,j,T)},[s(f,null,{default:d(()=>[s(v(me))]),_:1})],8,xe)):X("",!0)])]}),_:1},8,["data","draggable"])),[[ne,x.value]])]),_:1})],32),s(z,{ref_key:"Form",ref:k},null,512)])}}}),Ne=ve(Ie,[["__scopeId","data-v-33710bdb"]]),$e={class:"dept-move"},Me=D({name:"undefined"}),Te=D({...Me,name:"user-move",setup(q,{expose:g}){const{service:F}=S(),N=Y(),t=Z(),{t:u}=H();async function k(b){var o;(o=N.value)==null||o.open({title:u("部门转移"),width:"500px",props:{labelWidth:"80px"},items:[{label:u("选择部门"),prop:"departmentId",component:{name:"cl-dept-select"}}],on:{async submit(_,{done:x,close:h}){if(!_.departmentId)return I.warning(u("请选择部门")),x();await O.confirm(u("转移到新部门，是否继续？"),u("提示"),{type:"warning"}).then(()=>{F.base.sys.user.move({..._,userIds:b}).then(()=>{var a;I.success(u("转移成功")),(a=t.value)==null||a.refresh(),h()}).catch(a=>{I.error(a.message)})}).catch(()=>null),x()}}})}return g({open:k}),(b,o)=>{const _=c("cl-form");return w(),W("div",$e,[s(_,{ref_key:"Form",ref:N},null,512)])}}}),We=D({name:"undefined"}),It=D({...We,name:"sys-user",setup(q){const{service:g,refs:F,setRefs:N}=S(),{t}=H(),{ViewGroup:u}=ee({title:t("用户列表")}),k=Z({service:g.base.sys.user}),b=se({columns:[{type:"selection",width:60},{prop:"headImg",label:t("头像"),component:{name:"cl-avatar",props:{size:32}}},{prop:"username",label:t("用户名"),minWidth:150},{prop:"name",label:t("姓名"),minWidth:120},{prop:"nickName",label:t("昵称"),minWidth:120},{prop:"departmentName",label:t("部门名称"),minWidth:120},{prop:"roleName",label:t("角色"),headerAlign:"center",minWidth:160,dict:[],formatter(a){var l;return(l=a.roleName)==null?void 0:l.split(",")}},{prop:"status",label:t("状态"),minWidth:100,component:{name:"cl-switch"}},{prop:"phone",label:t("手机号码"),minWidth:120},{prop:"remark",label:t("备注"),minWidth:200,showOverflowTooltip:!0},{prop:"createTime",label:t("创建时间"),sortable:"desc",minWidth:170},{type:"op",buttons:["slot-btn","edit","delete"],width:270}]}),o=ae({dialog:{width:"800px"},items:[{prop:"headImg",label:t("头像"),component:{name:"cl-upload",props:{text:t("选择头像")}}},{prop:"name",label:t("姓名"),span:12,required:!0,component:{name:"el-input"}},{prop:"nickName",label:t("昵称"),required:!0,span:12,component:{name:"el-input"}},{prop:"username",label:t("用户名"),required:!0,span:12,component:{name:"el-input"}},()=>{var a;return{prop:"password",label:t("密码"),span:12,required:((a=o.value)==null?void 0:a.mode)=="add",component:{name:"el-input",props:{type:"password",showPassword:!0,autocomplete:"new-password"}},rules:[{min:6,max:16,message:t("密码长度在 6 到 16 个字符")}]}},{prop:"roleIdList",label:t("角色"),value:[],required:!0,component:{name:"el-select",options:[],props:{multiple:!0,"multiple-limit":3}}},{prop:"phone",label:t("手机号码"),span:12,component:{name:"el-input"}},{prop:"email",label:t("邮箱"),span:12,component:{name:"el-input"}},{prop:"remark",label:t("备注"),component:{name:"el-input",props:{type:"textarea",rows:4}}},{prop:"status",label:t("状态"),value:1,component:{name:"el-radio-group",options:[{label:t("启用"),value:1},{label:t("禁用"),value:0}]}}],onSubmit(a,{next:l}){var m,y;l({departmentId:(y=(m=u.value)==null?void 0:m.selected)==null?void 0:y.id,...a})},async onOpen(){g.base.sys.role.list().then(a=>{var l;(l=o.value)==null||l.setOptions("roleIdList",a.map(m=>({label:m.name||"",value:m.id})))})},plugins:[pe.Form.setFocus("name")]});function _(a){var l;(l=k.value)==null||l.refresh(a)}function x({id:a}){var l;(l=k.value)==null||l.rowAppend({departmentId:a})}async function h(a){var m;let l=[];a?l=[a.id]:l=((m=b.value)==null?void 0:m.selection.map(y=>y.id))||[],F.userMove.open(l)}return(a,l)=>{const m=c("cl-refresh-btn"),y=c("cl-add-btn"),U=c("cl-multi-delete-btn"),A=c("el-button"),V=c("cl-flex1"),B=c("cl-search-key"),n=c("cl-row"),e=c("cl-table"),p=c("cl-pagination"),r=c("cl-upsert"),i=c("cl-crud"),f=c("cl-view-group"),$=te("permission");return w(),P(f,{ref_key:"ViewGroup",ref:u},{left:d(()=>[s(Ne,{onRefresh:_,onUserAdd:x})]),right:d(()=>[s(i,{ref_key:"Crud",ref:k},{default:d(()=>[s(n,null,{default:d(()=>{var M;return[s(m),s(y),s(U),R((w(),P(A,{type:"success",disabled:((M=v(b))==null?void 0:M.selection.length)==0,onClick:l[0]||(l[0]=z=>h())},{default:d(()=>[J(G(a.$t("转移")),1)]),_:1},8,["disabled"])),[[$,v(g).base.sys.user.permission.move]]),s(V),s(B,{placeholder:a.$t("搜索用户名、姓名")},null,8,["placeholder"])]}),_:1}),s(n,null,{default:d(()=>[s(e,{ref_key:"Table",ref:b},{"slot-btn":d(({scope:M})=>[R((w(),P(A,{text:"",onClick:z=>h(M.row)},{default:d(()=>[J(G(a.$t("转移")),1)]),_:2},1032,["onClick"])),[[$,v(g).base.sys.user.permission.move]])]),_:1},512)]),_:1}),s(n,null,{default:d(()=>[s(V),s(p)]),_:1}),s(r,{ref_key:"Upsert",ref:o},null,512),s(Te,{ref:v(N)("userMove")},null,512)]),_:1},512)]),_:1},512)}}});export{It as default};
