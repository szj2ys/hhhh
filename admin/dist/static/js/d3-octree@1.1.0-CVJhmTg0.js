function X(i){const t=+this._x.call(null,i),n=+this._y.call(null,i),e=+this._z.call(null,i);return P(this.cover(t,n,e),t,n,e,i)}function P(i,t,n,e,h){if(isNaN(t)||isNaN(n)||isNaN(e))return i;var s,o=i._root,a={data:h},f=i._x0,r=i._y0,c=i._z0,l=i._x1,_=i._y1,u=i._z1,w,N,g,x,p,z,k,v,A,M,q;if(!o)return i._root=a,i;for(;o.length;)if((k=t>=(w=(f+l)/2))?f=w:l=w,(v=n>=(N=(r+_)/2))?r=N:_=N,(A=e>=(g=(c+u)/2))?c=g:u=g,s=o,!(o=o[M=A<<2|v<<1|k]))return s[M]=a,i;if(x=+i._x.call(null,o.data),p=+i._y.call(null,o.data),z=+i._z.call(null,o.data),t===x&&n===p&&e===z)return a.next=o,s?s[M]=a:i._root=a,i;do s=s?s[M]=new Array(8):i._root=new Array(8),(k=t>=(w=(f+l)/2))?f=w:l=w,(v=n>=(N=(r+_)/2))?r=N:_=N,(A=e>=(g=(c+u)/2))?c=g:u=g;while((M=A<<2|v<<1|k)===(q=(z>=g)<<2|(p>=N)<<1|x>=w));return s[q]=o,s[M]=a,i}function Y(i){Array.isArray(i)||(i=Array.from(i));const t=i.length,n=new Float64Array(t),e=new Float64Array(t),h=new Float64Array(t);let s=1/0,o=1/0,a=1/0,f=-1/0,r=-1/0,c=-1/0;for(let l=0,_,u,w,N;l<t;++l)isNaN(u=+this._x.call(null,_=i[l]))||isNaN(w=+this._y.call(null,_))||isNaN(N=+this._z.call(null,_))||(n[l]=u,e[l]=w,h[l]=N,u<s&&(s=u),u>f&&(f=u),w<o&&(o=w),w>r&&(r=w),N<a&&(a=N),N>c&&(c=N));if(s>f||o>r||a>c)return this;this.cover(s,o,a).cover(f,r,c);for(let l=0;l<t;++l)P(this,n[l],e[l],h[l],i[l]);return this}function Z(i,t,n){if(isNaN(i=+i)||isNaN(t=+t)||isNaN(n=+n))return this;var e=this._x0,h=this._y0,s=this._z0,o=this._x1,a=this._y1,f=this._z1;if(isNaN(e))o=(e=Math.floor(i))+1,a=(h=Math.floor(t))+1,f=(s=Math.floor(n))+1;else{for(var r=o-e||1,c=this._root,l,_;e>i||i>=o||h>t||t>=a||s>n||n>=f;)switch(_=(n<s)<<2|(t<h)<<1|i<e,l=new Array(8),l[_]=c,c=l,r*=2,_){case 0:o=e+r,a=h+r,f=s+r;break;case 1:e=o-r,a=h+r,f=s+r;break;case 2:o=e+r,h=a-r,f=s+r;break;case 3:e=o-r,h=a-r,f=s+r;break;case 4:o=e+r,a=h+r,s=f-r;break;case 5:e=o-r,a=h+r,s=f-r;break;case 6:o=e+r,h=a-r,s=f-r;break;case 7:e=o-r,h=a-r,s=f-r;break}this._root&&this._root.length&&(this._root=c)}return this._x0=e,this._y0=h,this._z0=s,this._x1=o,this._y1=a,this._z1=f,this}function B(){var i=[];return this.visit(function(t){if(!t.length)do i.push(t.data);while(t=t.next)}),i}function C(i){return arguments.length?this.cover(+i[0][0],+i[0][1],+i[0][2]).cover(+i[1][0],+i[1][1],+i[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function y(i,t,n,e,h,s,o){this.node=i,this.x0=t,this.y0=n,this.z0=e,this.x1=h,this.y1=s,this.z1=o}function D(i,t,n,e){var h,s=this._x0,o=this._y0,a=this._z0,f,r,c,l,_,u,w=this._x1,N=this._y1,g=this._z1,x=[],p=this._root,z,k;for(p&&x.push(new y(p,s,o,a,w,N,g)),e==null?e=1/0:(s=i-e,o=t-e,a=n-e,w=i+e,N=t+e,g=n+e,e*=e);z=x.pop();)if(!(!(p=z.node)||(f=z.x0)>w||(r=z.y0)>N||(c=z.z0)>g||(l=z.x1)<s||(_=z.y1)<o||(u=z.z1)<a))if(p.length){var v=(f+l)/2,A=(r+_)/2,M=(c+u)/2;x.push(new y(p[7],v,A,M,l,_,u),new y(p[6],f,A,M,v,_,u),new y(p[5],v,r,M,l,A,u),new y(p[4],f,r,M,v,A,u),new y(p[3],v,A,c,l,_,M),new y(p[2],f,A,c,v,_,M),new y(p[1],v,r,c,l,A,M),new y(p[0],f,r,c,v,A,M)),(k=(n>=M)<<2|(t>=A)<<1|i>=v)&&(z=x[x.length-1],x[x.length-1]=x[x.length-1-k],x[x.length-1-k]=z)}else{var q=i-+this._x.call(null,p.data),j=t-+this._y.call(null,p.data),O=n-+this._z.call(null,p.data),R=q*q+j*j+O*O;if(R<e){var I=Math.sqrt(e=R);s=i-I,o=t-I,a=n-I,w=i+I,N=t+I,g=n+I,h=p.data}}return h}const E=(i,t,n,e,h,s)=>Math.sqrt((i-e)**2+(t-h)**2+(n-s)**2);function G(i,t,n,e){const h=[],s=i-e,o=t-e,a=n-e,f=i+e,r=t+e,c=n+e;return this.visit((l,_,u,w,N,g,x)=>{if(!l.length)do{const p=l.data;E(i,t,n,this._x(p),this._y(p),this._z(p))<=e&&h.push(p)}while(l=l.next);return _>f||u>r||w>c||N<s||g<o||x<a}),h}function H(i){if(isNaN(_=+this._x.call(null,i))||isNaN(u=+this._y.call(null,i))||isNaN(w=+this._z.call(null,i)))return this;var t,n=this._root,e,h,s,o=this._x0,a=this._y0,f=this._z0,r=this._x1,c=this._y1,l=this._z1,_,u,w,N,g,x,p,z,k,v,A;if(!n)return this;if(n.length)for(;;){if((p=_>=(N=(o+r)/2))?o=N:r=N,(z=u>=(g=(a+c)/2))?a=g:c=g,(k=w>=(x=(f+l)/2))?f=x:l=x,t=n,!(n=n[v=k<<2|z<<1|p]))return this;if(!n.length)break;(t[v+1&7]||t[v+2&7]||t[v+3&7]||t[v+4&7]||t[v+5&7]||t[v+6&7]||t[v+7&7])&&(e=t,A=v)}for(;n.data!==i;)if(h=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,h?(s?h.next=s:delete h.next,this):t?(s?t[v]=s:delete t[v],(n=t[0]||t[1]||t[2]||t[3]||t[4]||t[5]||t[6]||t[7])&&n===(t[7]||t[6]||t[5]||t[4]||t[3]||t[2]||t[1]||t[0])&&!n.length&&(e?e[A]=n:this._root=n),this):(this._root=s,this)}function J(i){for(var t=0,n=i.length;t<n;++t)this.remove(i[t]);return this}function K(){return this._root}function L(){var i=0;return this.visit(function(t){if(!t.length)do++i;while(t=t.next)}),i}function Q(i){var t=[],n,e=this._root,h,s,o,a,f,r,c;for(e&&t.push(new y(e,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));n=t.pop();)if(!i(e=n.node,s=n.x0,o=n.y0,a=n.z0,f=n.x1,r=n.y1,c=n.z1)&&e.length){var l=(s+f)/2,_=(o+r)/2,u=(a+c)/2;(h=e[7])&&t.push(new y(h,l,_,u,f,r,c)),(h=e[6])&&t.push(new y(h,s,_,u,l,r,c)),(h=e[5])&&t.push(new y(h,l,o,u,f,_,c)),(h=e[4])&&t.push(new y(h,s,o,u,l,_,c)),(h=e[3])&&t.push(new y(h,l,_,a,f,r,u)),(h=e[2])&&t.push(new y(h,s,_,a,l,r,u)),(h=e[1])&&t.push(new y(h,l,o,a,f,_,u)),(h=e[0])&&t.push(new y(h,s,o,a,l,_,u))}return this}function S(i){var t=[],n=[],e;for(this._root&&t.push(new y(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=t.pop();){var h=e.node;if(h.length){var s,o=e.x0,a=e.y0,f=e.z0,r=e.x1,c=e.y1,l=e.z1,_=(o+r)/2,u=(a+c)/2,w=(f+l)/2;(s=h[0])&&t.push(new y(s,o,a,f,_,u,w)),(s=h[1])&&t.push(new y(s,_,a,f,r,u,w)),(s=h[2])&&t.push(new y(s,o,u,f,_,c,w)),(s=h[3])&&t.push(new y(s,_,u,f,r,c,w)),(s=h[4])&&t.push(new y(s,o,a,w,_,u,l)),(s=h[5])&&t.push(new y(s,_,a,w,r,u,l)),(s=h[6])&&t.push(new y(s,o,u,w,_,c,l)),(s=h[7])&&t.push(new y(s,_,u,w,r,c,l))}n.push(e)}for(;e=n.pop();)i(e.node,e.x0,e.y0,e.z0,e.x1,e.y1,e.z1);return this}function T(i){return i[0]}function U(i){return arguments.length?(this._x=i,this):this._x}function V(i){return i[1]}function $(i){return arguments.length?(this._y=i,this):this._y}function d(i){return i[2]}function m(i){return arguments.length?(this._z=i,this):this._z}function tt(i,t,n,e){var h=new F(t??T,n??V,e??d,NaN,NaN,NaN,NaN,NaN,NaN);return i==null?h:h.addAll(i)}function F(i,t,n,e,h,s,o,a,f){this._x=i,this._y=t,this._z=n,this._x0=e,this._y0=h,this._z0=s,this._x1=o,this._y1=a,this._z1=f,this._root=void 0}function W(i){for(var t={data:i.data},n=t;i=i.next;)n=n.next={data:i.data};return t}var b=tt.prototype=F.prototype;b.copy=function(){var i=new F(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),t=this._root,n,e;if(!t)return i;if(!t.length)return i._root=W(t),i;for(n=[{source:t,target:i._root=new Array(8)}];t=n.pop();)for(var h=0;h<8;++h)(e=t.source[h])&&(e.length?n.push({source:e,target:t.target[h]=new Array(8)}):t.target[h]=W(e));return i};b.add=X;b.addAll=Y;b.cover=Z;b.data=B;b.extent=C;b.find=D;b.findAllWithinRadius=G;b.remove=H;b.removeAll=J;b.root=K;b.size=L;b.visit=Q;b.visitAfter=S;b.x=U;b.y=$;b.z=m;export{tt as o};
