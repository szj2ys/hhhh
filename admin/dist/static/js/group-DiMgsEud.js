import{l as ce,v as de}from"./@vue_runtime-dom@3.5.16-DriBzn4z.js";import{s as pe}from"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-CeLFb4Nw.js";import{u as ue,b as me,e as ve}from"./index-BDeQYItE.js";import{d as fe,b as _e}from"./comm-Ba3vmJ1R.js";import{B as A,A as H,o as he}from"./lodash-es@4.17.21-BYk7DlcU.js";import{a as z,b as ge}from"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import{d as Q,G as be,C as ye,e as ke,P as f,V as I,c as v,o as i,a,i as u,x as _,z as y,y as k,n as Ce,U as E,H as C,J,I as xe,F as $e,L as we}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{u as Me}from"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-Bqjl69Su.js";import{u as O,v as x,y as N}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import{p as K,O as $}from"./@vue_shared@3.5.16-UwmvJIHj.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-7kYVjNRB.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-CuUdMqkw.js";import"./store@2.0.12-i6xqVJod.js";import"./chardet@2.1.0-CTPPlwpv.js";import"./mitt@3.0.1-C1z4c41a.js";import"./@codemirror_language-data@6.5.1-Blx1hvTn.js";import"./@codemirror_language@6.11.1-BYrSuhr8.js";import"./@lezer_common@1.2.3-CP7NCNqd.js";import"./@codemirror_state@6.5.2-DQ6R6BiX.js";import"./@marijn_find-cluster-break@1.0.2-DXwl3gUT.js";import"./@codemirror_view@6.37.1-Bd3_Yh4F.js";import"./style-mod@4.1.2-Bc2inJdb.js";import"./w3c-keyname@2.2.8-Vcq4gwWv.js";import"./@lezer_highlight@1.2.1-DwVMghhY.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.16_typescript@5.5.4_-BZ2tmr1d.js";import"./vue-router@4.5.1_vue@3.5.16_typescript@5.5.4_-ODt3CAxp.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.16_echarts@5.6.0_vue@3.5.16_typescript@5.5.4_-Dhz4IGE5.js";import"./echarts@5.6.0-DvAKqd2B.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.1-DcQm8NwP.js";import"./axios@1.9.0-D--XfsWq.js";import"./nprogress@0.2.0-dOd6e7EG.js";import"./@vueuse_shared@9.13.0_vue@3.5.16_typescript@5.5.4_-4q0MSQPl.js";import"./@vueuse_core@9.13.0_vue@3.5.16_typescript@5.5.4_-DmiypGF2.js";import"./@sxzz_popperjs-es@2.11.7-D_chPuIy.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./dayjs@1.11.13-DUxgsv0d.js";import"./async-validator@4.2.5-CDKkdPIV.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-BQoi3Ox2.js";import"./@floating-ui_dom@1.7.1-Ba-2EiSn.js";import"./@floating-ui_core@1.7.1-C83JrwzW.js";import"./@floating-ui_utils@0.2.9-CBkBHzV8.js";import"./@intlify_core-base@11.1.5-rFPZQXdu.js";import"./@intlify_shared@11.1.5-CY44FrR8.js";import"./@intlify_message-compiler@11.1.5-CZ-uatfp.js";const Se={class:"cl-view-group__wrap"},ze={class:"cl-view-group__left"},Be={class:"scope"},De={class:"head"},Ee={key:0,class:"search"},Ne={class:"data"},Fe={class:"item"},Le=["infinite-scroll-disabled"],Te=["onClick","onContextmenu"],We={class:"text-ellipsis overflow-hidden mr-2"},Ae={class:"cl-view-group__right"},Ie={class:"head"},Ke={class:"title"},Re={class:"absolute right-[10px]"},qe={key:0,class:"content"},Ge=Q({name:"undefined"}),Pe=Q({...Ge,name:"cl-view-group",setup(Ue,{expose:X}){ce(e=>({"08e8d246":t.leftWidth}));const{browser:B,onScreenChange:Y}=me(),Z=be(),R=fe(),{refs:ee,setRefs:te}=ue(),{t:d}=Me(),t=O(A({label:d("组"),title:d("列表"),leftWidth:"300px",data:{},service:{},enableContextMenu:!0,enableRefresh:!0,enableKeySearch:!0,enableAdd:!0,custom:!1},ye("useViewGroup__options"))),q=!!Z.left;H(t.service);const F=x(!1),L=x(""),p=x([]),w=x(!0),r=x(),m=O(he({visible:!!t.tree,props:{label:"name",children:"children",disabled:"disabled",isLeaf:"isLeaf",class:""},defaultExpandedKeys:[]},t.tree));function M(e){w.value=e===void 0?!w.value:e}function V(e){e||(e=p.value[0]),r.value=e,Ce(()=>{e&&(B.isMini&&M(!1),t.onSelect&&t.onSelect(e))})}function T(e){var o,n;(n=R.value)==null||n.open({title:d(e?"编辑":"添加")+t.label,form:{...e},on:{submit(s,{close:c,done:g}){t.service[e?"update":"add"](s).then(()=>{z.success(d("保存成功")),e&&A(e,s),h(),c()}).catch(W=>{z.error(W.message),g()})}},...(o=t.onEdit)==null?void 0:o.call(t,e)})}function G(e){ge.confirm(d("此操作将会删除选择的数据，是否继续？"),d("提示"),{type:"warning"}).then(()=>{function o(n){t.service.delete(n).then(async()=>{var s;z.success(d("删除成功")),await h(),((s=r.value)==null?void 0:s.id)==e.id&&V()}).catch(s=>{z.error(s.message)})}t.onDelete?t.onDelete(e,{next:o}):o({ids:[e.id]})}).catch(()=>null)}const D={order:"createTime",sort:"asc",page:1,size:50},P=x(!1);async function h(e){if(q)return!1;A(D,e),F.value=!0;const o={...D,...t.data,keyWord:L.value};let n;m.visible?n=t.service.list(o).then(s=>{p.value=ve(s)}):n=t.service.page(o).then(s=>{var g;const c=((g=t.onData)==null?void 0:g.call(t,s.list))||s.list;D.page==1?p.value=c:p.value.push(...c),P.value=s.pagination.total<=p.value.length}),await n.then(()=>{const s=r.value||p.value[0];s&&(m.visible&&ee.tree.getNode(s).expand(),V(s))}).catch(s=>{z.error(s.message)}),F.value=!1}function se(){h({page:D.page+1})}function oe(e,o){var n,s;if(!t.enableContextMenu)return!1;_e.open(e,{hover:{target:"item"},list:[{label:d("编辑"),hidden:!((n=t.service._permission)!=null&&n.update),callback(c){c(),T(o)}},{label:d("删除"),hidden:!((s=t.service._permission)!=null&&s.delete),callback(c){c(),G(o)}}],...t.onContextMenu&&t.onContextMenu(o)})}return Y(()=>{M(!B.isMini)}),ke(()=>{h()}),X({list:p,selected:r,isExpand:w,expand:M,select:V,browser:B,edit:T,remove:G,refresh:h}),(e,o)=>{const n=f("el-text"),s=f("cl-svg"),c=f("el-tooltip"),g=f("el-input"),W=f("el-tree"),U=f("el-empty"),le=f("el-scrollbar"),ie=f("cl-form"),ne=I("permission"),ae=I("infinite-scroll"),re=I("loading");return i(),v("div",{class:K(["cl-view-group",[w.value?"is-expand":"is-collapse"]])},[a("div",Se,[a("div",ze,[_(e.$slots,"left",{},()=>[a("div",Be,[a("div",De,[u(n,{class:"label"},{default:C(()=>[J($(t.label),1)]),_:1}),t.enableRefresh?(i(),k(c,{key:0,content:e.$t("刷新")},{default:C(()=>[a("div",{class:"icon",onClick:o[0]||(o[0]=l=>h())},[u(s,{name:"refresh"})])]),_:1},8,["content"])):y("",!0),t.enableAdd?(i(),k(c,{key:1,content:e.$t("添加")},{default:C(()=>[E((i(),v("div",{class:"icon",onClick:o[1]||(o[1]=l=>T())},[u(s,{name:"plus-border"})])),[[ne,t.service.permission.add]])]),_:1},8,["content"])):y("",!0),_(e.$slots,"left-op",{},void 0,!0)]),t.enableKeySearch?(i(),v("div",Ee,[u(g,{modelValue:L.value,"onUpdate:modelValue":o[2]||(o[2]=l=>L.value=l),placeholder:e.$t("搜索关键字"),clearable:"","prefix-icon":N(pe),onChange:o[3]||(o[3]=l=>h({page:1}))},null,8,["modelValue","placeholder","prefix-icon"])])):y("",!0),E((i(),v("div",Ne,[u(le,null,{default:C(()=>[m.visible?(i(),k(W,{key:0,ref:N(te)("tree"),class:"tree","highlight-current":"","auto-expand-parent":"","expand-on-click-node":!1,lazy:m.lazy,data:p.value,props:m.props,load:m.onLoad,onNodeClick:V},{default:C(({data:l})=>[a("div",Fe,[l.icon?(i(),k(xe(l.icon),{key:0})):y("",!0),_(e.$slots,"item-name",{item:l,selected:r.value},()=>[u(n,{truncated:""},{default:C(()=>{var b;return[J($(l[m.props.label])+" "+$(N(H)(l[m.props.children])?"":`（${(b=l[m.props.children])==null?void 0:b.length}）`),1)]}),_:2},1024)],!0)])]),_:3},8,["lazy","data","props","load"])):E((i(),v("ul",{key:1,class:"list","infinite-scroll-immediate":!1,"infinite-scroll-disabled":P.value},[(i(!0),v($e,null,we(p.value,(l,b)=>(i(),v("li",{key:b,onClick:S=>V(l),onContextmenu:S=>{oe(S,l)}},[_(e.$slots,"item",{item:l,selected:r.value,index:b},()=>{var S,j;return[a("div",{class:K(["item",{"is-active":((S=r.value)==null?void 0:S.id)==l.id}])},[_(e.$slots,"item-name",{item:l,selected:r.value,index:b},()=>[a("span",We,$(l.name),1)],!0),E(u(s,{name:"right",class:"ml-auto"},null,512),[[de,((j=r.value)==null?void 0:j.id)==l.id]])],2)]},!0)],40,Te))),128)),p.value.length==0?(i(),k(U,{key:0,"image-size":80})):y("",!0)],8,Le)),[[ae,se]])]),_:3})])),[[re,F.value]])])],!0),N(B).isMini?(i(),v("div",{key:0,class:"collapse-btn",onClick:o[4]||(o[4]=l=>M(!1))},[u(s,{name:"right"})])):y("",!0)]),a("div",Ae,[a("div",Ie,[a("div",{class:K(["icon is-bg absolute left-[10px]",{"is-fold":!w.value}]),onClick:o[5]||(o[5]=l=>M())},[u(s,{name:"back"})],2),_(e.$slots,"title",{selected:r.value},()=>{var l;return[a("span",Ke,$(t.title)+"（"+$(((l=r.value)==null?void 0:l.name)||e.$t("未选择"))+"） ",1)]},!0),a("div",Re,[_(e.$slots,"right-op",{},void 0,!0)])]),r.value||t.custom?(i(),v("div",qe,[_(e.$slots,"right",{},void 0,!0)])):(i(),k(U,{key:1,"image-size":80}))])]),u(ie,{ref_key:"Form",ref:R},null,512)],2)}}}),It=Ve(Pe,[["__scopeId","data-v-ba398f45"]]);export{It as default};
