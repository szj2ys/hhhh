import{a as L}from"./@vue_runtime-dom@3.5.16-DriBzn4z.js";import{_ as Q}from"./3d-force-graph@1.77.0-BTqeOrVF.js";import{x as X}from"./three@0.175.0-DVJ6AaYR.js";import{a as Y}from"./@vueuse_core@12.8.2_typescript@5.5.4-7kYVjNRB.js";import{u as Z}from"./index-C5WS2hJt.js";import"./store@2.0.12-i6xqVJod.js";import{_ as G}from"./three-spritetext@1.9.6_three@0.175.0-Bn04EvhX.js";import{a as W}from"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import{A as M,J as ee}from"./lodash-es@4.17.21-BYk7DlcU.js";import{d as j,w as te,e as oe,f as re,P as v,c as h,o as l,i as c,a as d,z as C,H as u,y as b,F as z,L as B,J as ie}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{v as ne,u as O,y as V}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import{O as $}from"./@vue_shared@3.5.16-UwmvJIHj.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./three-forcegraph@1.42.13_three@0.175.0-Ca0pnlZn.js";import"./ngraph.graph@20.0.1-CEshW6Bc.js";import"./chardet@2.1.0-CTPPlwpv.js";import"./ngraph.events@1.2.2-C8F6FHEm.js";import"./ngraph.forcelayout@3.3.1-tuYmRC0t.js";import"./ngraph.merge@1.0.0-B9WtB87t.js";import"./ngraph.random@1.2.0-CqTcXLGw.js";import"./kapsule@1.16.3-C41LLEgf.js";import"./accessor-fn@1.5.3-Dh2lNxUP.js";import"./data-bind-mapper@1.0.3-B1zbDOWj.js";import"./tinycolor2@1.6.0-Begke6kS.js";import"./d3-scale@4.0.2-VMEnll8A.js";import"./internmap@2.0.3-BkD7Hj8s.js";import"./d3-scale-chromatic@3.1.0-BvAsqZ2o.js";import"./d3-force-3d@3.0.6-yCgGLDyz.js";import"./d3-timer@3.0.1-N3g7Zl0V.js";import"./d3-dispatch@3.0.1-kxCwF96_.js";import"./d3-binarytree@1.0.2-e94m1gdS.js";import"./d3-quadtree@3.0.1-CSANTnla.js";import"./d3-octree@1.1.0-CVJhmTg0.js";import"./d3-array@3.2.4-tv6RD-6E.js";import"./three-render-objects@1.40.2_three@0.175.0-BbzzENYd.js";import"./polished@4.3.1-3tv_O2IJ.js";import"./@babel_runtime@7.27.4-D__KhwOR.js";import"./@tweenjs_tween.js@25.0.0-nuASKez8.js";import"./float-tooltip@1.7.5-nMUy4Ccf.js";import"./preact@10.26.8-Bbr8jbWY.js";import"./d3-selection@3.0.0-z4TKiAR0.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-CuUdMqkw.js";import"./mitt@3.0.1-C1z4c41a.js";import"./@codemirror_language-data@6.5.1-Blx1hvTn.js";import"./@codemirror_language@6.11.1-BYrSuhr8.js";import"./@lezer_common@1.2.3-CP7NCNqd.js";import"./@codemirror_state@6.5.2-DQ6R6BiX.js";import"./@marijn_find-cluster-break@1.0.2-DXwl3gUT.js";import"./@codemirror_view@6.37.1-Bd3_Yh4F.js";import"./style-mod@4.1.2-Bc2inJdb.js";import"./w3c-keyname@2.2.8-Vcq4gwWv.js";import"./@lezer_highlight@1.2.1-DwVMghhY.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.16_typescript@5.5.4_-BZ2tmr1d.js";import"./vue-router@4.5.1_vue@3.5.16_typescript@5.5.4_-ODt3CAxp.js";import"./comm-Ba3vmJ1R.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-CeLFb4Nw.js";import"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-Bqjl69Su.js";import"./@intlify_core-base@11.1.5-rFPZQXdu.js";import"./@intlify_shared@11.1.5-CY44FrR8.js";import"./@intlify_message-compiler@11.1.5-CZ-uatfp.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.16_echarts@5.6.0_vue@3.5.16_typescript@5.5.4_-Dhz4IGE5.js";import"./echarts@5.6.0-DvAKqd2B.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.1-DcQm8NwP.js";import"./axios@1.9.0-D--XfsWq.js";import"./nprogress@0.2.0-dOd6e7EG.js";import"./@vueuse_shared@9.13.0_vue@3.5.16_typescript@5.5.4_-4q0MSQPl.js";import"./@vueuse_core@9.13.0_vue@3.5.16_typescript@5.5.4_-DmiypGF2.js";import"./@sxzz_popperjs-es@2.11.7-D_chPuIy.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./dayjs@1.11.13-DUxgsv0d.js";import"./async-validator@4.2.5-CDKkdPIV.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-BQoi3Ox2.js";import"./@floating-ui_dom@1.7.1-Ba-2EiSn.js";import"./@floating-ui_core@1.7.1-C83JrwzW.js";import"./@floating-ui_utils@0.2.9-CBkBHzV8.js";const le={class:"bg-[var(--el-bg-color)] p-[10px] h-full relative"},ae={key:0,class:"absolute left-[20px] top-[60px] w-[260px] bg-[var(--el-bg-color)] rounded-lg border border-[var(--el-border-color-lighter)]"},ce={class:"p-2 search"},de={class:"px-2 pb-2"},pe={key:0,class:"text-xs mb-5 last:mb-0"},me={class:"flex items-center gap-1 mb-[6px] text-[var(--el-text-color-regular)] px-1"},ue={class:"flex flex-wrap gap-2"},fe={class:"max-w-[100px] text-ellipsis overflow-hidden"},_e={key:1,class:"bg-[var(--el-bg-color)] flex flex-col absolute right-[20px] top-[20px] h-[calc(100%-40px)] w-[30%] hidden-xs-only shadow-sm z-10 rounded-lg border border-[var(--el-border-color-lighter)]"},he={class:"flex items-center p-3 border-b border-[var(--el-border-color-lighter)] flex-shrink-0"},ve={class:"flex-1"},xe={class:"flex1 overflow-hidden"},ge={class:"p-3"},ye={class:"flex flex-wrap items-center p-3 gap-2 border-t border-[var(--el-border-color-lighter)] mt-auto flex-shrink-0"},be=j({name:"undefined"}),ke=j({...be,setup(we){const{service:S,route:T}=Z(),E=Y();let f=[],g=[],x,n=null;function k(t,e){if(x=t,t&&t.x&&t.y&&t.z){const r=1+60/Math.hypot(t.x,t.y,t.z),s=t.x||t.y||t.z?{x:t.x*r,y:t.y*r,z:t.z*r}:{x:0,y:0,z:60};n==null||n.cameraPosition(s,{x:t.x,y:t.y,z:t.z},e),p.open(t)}}function q(){const t=g.find(o=>o.target.uid==(x==null?void 0:x.uid)),e=f.find(o=>o.uid==(t==null?void 0:t.source.uid));e?k(e):W.info("没有上一个节点")}function D(t){const e=g.filter(o=>o.source.uid==t.uid);return ee(e.map(o=>f.find(r=>o.target.uid==r.uid)).filter(Boolean),"uid")}function A(t){const e=document.getElementById("graph");n=new Q(e,{extraRenderers:[new X]}).height(e.clientHeight||0).width(e.clientWidth||0).linkColor(()=>E.value?"#ffffff":"#000000").backgroundColor("#ffffff00").linkThreeObjectExtend(!0).onNodeClick(o=>{k(o,300)}).nodeThreeObject(o=>{const r=new G(o.name);return r.material.depthWrite=!1,r.color=E.value?"#ffffff":"#000000",r.textHeight=2,r}).nodeThreeObjectExtend(!0).nodeVal(o=>o.size).graphData(t).nodeVisibility(o=>!!o.visible).linkVisibility(o=>o.visible).cameraPosition({x:0,y:0,z:1e3})}function H(){n&&(n._destructor(),n=null)}function I(t){f.forEach(e=>{e.visible=t}),g.forEach(e=>{e.visible=t}),n==null||n.refresh()}te(E,()=>{n==null||n.refresh()});const N=ne(!0);async function R(){N.value=!0,await S.know.graph.index.getGraph({typeId:T.query.typeId}).then(t=>{f=t.nodes.map(e=>({...e,size:3*t.relations.filter(o=>o.source==e.name).length,id:e.name,uid:`${e.name}-${e.chunkId}`,color:U(e.name),visible:!0})),g=t.relations.filter(e=>{e.visible=!0;const o=f.find(s=>s.id==e.source),r=f.find(s=>s.id==e.target);return o&&r}),A({nodes:f,links:g})}),N.value=!1}const p=O({visible:!1,content:"",children:[],open(t){S.know.data.info.info({id:t.chunkId}).then(e=>{p.content=e.content,p.visible=!0,p.children=D(x)})},close(){p.visible=!1,p.children=[],p.content=""}}),i=O({keyWord:"",list:[],loading:0,score:0,active:"",async get(){if(!i.keyWord)return W.info("请输入搜索内容");i.list=[],i.loading=1,await S.know.retriever.invoke({knowId:Number(T.query.typeId),text:i.keyWord,options:{size:30}}).then(t=>{i.list=t.map(e=>{const{metadata:o}=e[0];return{id:o.id,score:e[1].toFixed(6),children:f.filter(r=>r.chunkId==o.id)}})}).catch(t=>{W.error(t.message)}).finally(()=>{i.loading=2})},toNode(t){if(i.active==t){i.active="",I(!0);return}i.active=t;const e=f.find(s=>s.uid==t);if(!e)return;I(!1);const o=new Set,r=s=>{s.visible=!0,D(s).forEach(m=>{if(o.has(m.uid))return;o.add(m.uid),m.visible=!0;const _=g.find(w=>w.source.uid==s.uid&&w.target.uid==m.uid);_&&(_.visible=!0),r(m)})};r(e),n==null||n.refresh(),setTimeout(()=>{k(e)},0)},clear(){i.keyWord="",i.loading=0,i.list=[],p.close(),I(!0)}});function U(t){let e=5381;for(let m=0;m<t.length;m++){const _=t.charCodeAt(m);e=(e<<5)+e+_}e=Math.abs(e);const o=60+(e&255)%196,r=60+(e>>8&255)%196,s=60+(e>>16&255)%196;return`#${o.toString(16).padStart(2,"0")}${r.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`}return oe(()=>{R()}),re(()=>{H()}),(t,e)=>{var F;const o=v("cl-view-head"),r=v("cl-svg"),s=v("el-input"),m=v("el-empty"),_=v("el-button"),w=v("el-scrollbar"),J=v("cl-preview-md"),P=v("el-tooltip");return l(),h("div",le,[c(o),e[5]||(e[5]=d("div",{id:"graph"},null,-1)),N.value?C("",!0):(l(),h("div",ae,[d("div",ce,[c(s,{modelValue:i.keyWord,"onUpdate:modelValue":e[0]||(e[0]=a=>i.keyWord=a),placeholder:"搜索文本",onKeyup:e[1]||(e[1]=L(a=>i.get(),["enter"]))},{prefix:u(()=>[c(r,{name:"search"})]),suffix:u(()=>[i.loading==1?(l(),b(r,{key:0,name:"refresh",class:"animate-spin"})):i.keyWord?(l(),b(r,{key:1,name:"close",class:"cursor-pointer hover:text-[var(--el-text-color-primary)]",onClick:i.clear},null,8,["onClick"])):C("",!0)]),_:1},8,["modelValue"])]),i.loading==2?(l(),h(z,{key:0},[V(M)(i.list)?(l(),b(m,{key:0,class:"mb-2","image-size":50})):(l(),b(w,{key:1,"max-height":"400px"},{default:u(()=>[d("div",de,[(l(!0),h(z,null,B(i.list,a=>(l(),h(z,{key:a.id},[V(M)(a.children)?C("",!0):(l(),h("div",pe,[d("div",me,[c(r,{name:"know-hit"}),d("span",null,$(a.score),1)]),d("div",ue,[(l(!0),h(z,null,B(a.children,y=>(l(),b(_,{size:"small",key:y.uid,type:i.active==y.uid?"primary":"default",class:"!m-0 !px-[8px]",onClick:K=>i.toNode(y.uid)},{default:u(()=>[d("p",fe,$(y.name),1)]),_:2},1032,["type","onClick"]))),128))])]))],64))),128))])]),_:1}))],64)):C("",!0)])),p.visible?(l(),h("div",_e,[d("div",he,[d("span",ve,$((F=V(x))==null?void 0:F.name),1),d("div",{class:"cl-comm__icon z-10",onClick:e[2]||(e[2]=a=>p.close())},[c(r,{name:"close"})])]),d("div",xe,[c(w,null,{default:u(()=>[d("div",ge,[c(J,{content:p.content},null,8,["content"])])]),_:1})]),d("div",ye,[c(P,{content:"上一个"},{default:u(()=>[c(_,{size:"small",effect:"plain",class:"px-[5px] rounded-md",onClick:e[3]||(e[3]=a=>q())},{default:u(()=>[c(r,{name:"left"})]),_:1})]),_:1}),c(P,{content:"当前"},{default:u(()=>[c(_,{size:"small",effect:"plain",class:"px-[5px] rounded-md !m-0",onClick:e[4]||(e[4]=a=>k(V(x)))},{default:u(()=>[c(r,{name:"know-checked"})]),_:1})]),_:1}),(l(!0),h(z,null,B(p.children,(a,y)=>(l(),b(_,{key:y,size:"small",effect:"plain",class:"rounded-md !m-0",onClick:K=>k(a)},{default:u(()=>[ie($(a.name),1)]),_:2},1032,["onClick"]))),128))])])):C("",!0)])}}}),Kt=se(ke,[["__scopeId","data-v-4b96d8e0"]]);export{Kt as default};
