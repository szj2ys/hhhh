import{u as X,P as Y}from"./index-C5WS2hJt.js";import"./store@2.0.12-i6xqVJod.js";import{u as Z}from"./group-CxGNcSJX.js";import{u as ee,e as oe}from"./comm-Ba3vmJ1R.js";import{A as te,I as ne}from"./lodash-es@4.17.21-BYk7DlcU.js";import{a as N,b as se}from"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import{d as P,v as U,P as l,c as B,o as k,x as le,i as n,H as a,J as E,a as d,z as ae,F as I,L as ie,y as ce}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{u as re}from"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-Bqjl69Su.js";import{v as O,y as V}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import{O as g,p as pe}from"./@vue_shared@3.5.16-UwmvJIHj.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me={class:"opbar"},de={class:"data-item"},fe={class:"head"},_e={class:"name"},ve={class:"content"},ge={key:0,class:"empty"},ye=P({name:"undefined"}),he=P({...ye,name:"tools-set-node-config",emits:["close"],setup(we,{expose:A,emit:D}){const G=D,{service:u}=X(),{t:f}=re(),x=O([]),y=O({}),F=U(()=>{var o,e;return(e=(o=q.value)==null?void 0:o.selected)==null?void 0:e.type}),m=U(()=>["llm","tool","mcp"].includes(F.value)?"flow":"know"),$=U(()=>m.value=="flow"?"node":"func"),{ViewGroup:q}=Z({enableAdd:!1,enableContextMenu:!1,enableKeySearch:!1,label:"节点",title:"配置",service:{async page(o){return u[m.value].config.all(o).then(e=>({list:e.map(t=>({...t,name:t.title})),pagination:{total:e.length,page:1,size:100}}))}},onSelect(o){z({node:void 0,func:void 0,[$.value]:o.type})}}),_=ee({service:u.flow.config,async onRefresh(o){const e=await u[m.value].config.page({...o,size:1e3});x.value=e.list},onDelete(o){se.confirm("此操作将永久删除选中数据，是否继续？","提示",{type:"warning"}).then(()=>{u[m.value].config.delete({ids:o.map(e=>e.id)}).then(()=>{z()}).catch(e=>{N.error(e.message)})}).catch(()=>{})}}),r=oe({dialog:{width:"800px"},props:{labelPosition:"top"},items:[{label:f("类型"),prop:"type",component:{name:"el-select",options:[],props:{onChange(o){var e;(e=r.value)==null||e.setForm("options",JSON.stringify(y.value[o],null,4))}}},span:8,required:!0},{label:f("名称"),prop:"name",component:{name:"el-input"},span:16,required:!0},{label:f("描述"),prop:"description",component:{name:"el-input",props:{type:"textarea",rows:3}}},{label:f("配置"),prop:"options",component:{name:"slot-options"}}],async onInfo(o,{done:e}){u[m.value].config.info({id:o.id}).then(t=>{e(t)})},onOpen(){u[m.value].config.config({[$.value]:F.value}).then(o=>{var t,c,w,C,b;y.value=o;const e=ne(o).map(p=>({label:p,value:p}));if((t=r.value)==null||t.setOptions("type",e),((c=r.value)==null?void 0:c.mode)=="add"){const p=(w=e[0])==null?void 0:w.value;p&&((C=r.value)==null||C.setForm("type",p),(b=r.value)==null||b.setForm("options",y.value[p]))}})},async onSubmit(o,{done:e,close:t}){await u[m.value].config[o.id?"update":"add"]({...o,[$.value]:F.value}).then(()=>{N.success(f("保存成功")),t()}).catch(c=>{N.error(c.message),e()}),z()},plugins:[Y.Form.setFocus("name")]});function z(o){var e;(e=_.value)==null||e.refresh(o)}function J(){var e,t;const o=(e=r.value)==null?void 0:e.getForm("type");(t=r.value)==null||t.setForm("options",JSON.stringify(y.value[o],null,4))}const h=O(!1);function S(){h.value=!0}function M(){h.value=!1}function K(){G("close")}return A({open:S,close:M}),(o,e)=>{const t=l("el-button"),c=l("cl-svg"),w=l("el-text"),C=l("el-col"),b=l("el-row"),p=l("cl-editor-monaco"),L=l("el-tooltip"),T=l("cl-upsert"),H=l("el-empty"),R=l("cl-crud"),j=l("cl-view-group"),Q=l("cl-dialog");return k(),B(I,null,[le(o.$slots,"default",{open:S},()=>[n(t,{onClick:S},{default:a(()=>[E(g(o.$t("配置")),1)]),_:1})],!0),n(Q,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=s=>h.value=s),title:o.$t("配置"),height:"700px",width:"1200px",padding:"0",scrollbar:!1,onClose:K},{default:a(()=>[n(j,{ref_key:"ViewGroup",ref:q},{item:a(({item:s,selected:i})=>[d("div",{class:pe(["node-item",{"is-active":(i==null?void 0:i.type)==s.type}])},[d("span",null,g(s.title),1),n(c,{name:"flow-"+s.type},null,8,["name"])],2)]),right:a(()=>[d("div",me,[n(t,{type:"success",size:"small",onClick:e[0]||(e[0]=s=>{var i;return(i=V(_))==null?void 0:i.rowAdd()})},{default:a(()=>[E(g(o.$t("添加")),1)]),_:1})]),n(R,{ref_key:"Crud",ref:_},{default:a(()=>[n(b,{gutter:10},{default:a(()=>[(k(!0),B(I,null,ie(x.value,(s,i)=>(k(),ce(C,{span:8,xs:24,key:i},{default:a(()=>[d("div",de,[d("div",fe,[d("span",_e,g(s.name),1),n(c,{name:"delete",onClick:W=>{var v;return(v=V(_))==null?void 0:v.rowDelete(s)}},null,8,["onClick"]),n(c,{name:"set",onClick:W=>{var v;return(v=V(_))==null?void 0:v.rowEdit(s)}},null,8,["onClick"])]),d("div",ve,[n(w,{size:"small",type:"info","line-clamp":4},{default:a(()=>[E(g(s.description||o.$t("暂无描述")),1)]),_:2},1024)])])]),_:2},1024))),128))]),_:1}),n(T,{ref_key:"Upsert",ref:r},{"slot-options":a(({scope:s})=>[n(p,{modelValue:s.options,"onUpdate:modelValue":i=>s.options=i},null,8,["modelValue","onUpdate:modelValue"]),n(L,{content:o.$t("重置")},{default:a(()=>[n(c,{name:"flow-change",class:"options-btn",onClick:J})]),_:1},8,["content"])]),_:1},512),V(te)(x.value)?(k(),B("div",ge,[n(H,{"image-size":100})])):ae("",!0)]),_:1},512)]),_:1},512)]),_:1},8,["modelValue","title"])],64)}}}),Be=ue(he,[["__scopeId","data-v-12973ddf"]]);export{Be as C};
