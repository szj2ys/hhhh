import{u as F,d as B}from"./comm-Ba3vmJ1R.js";import{d as N}from"./dayjs@1.11.13-DUxgsv0d.js";import{F as W}from"./file-saver@2.0.5-B7z-IJrB.js";import{u as v,w as D}from"./xlsx@0.18.5-DAwKXFuD.js";import{A as Y}from"./index-BDeQYItE.js";import{v as $,A as j}from"./lodash-es@4.17.21-BYk7DlcU.js";import{a as b}from"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import{d as L,i as A,P as E}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{u as M}from"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-Bqjl69Su.js";import{v as T}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import"./@vue_runtime-dom@3.5.16-DriBzn4z.js";import"./@vue_shared@3.5.16-UwmvJIHj.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-CeLFb4Nw.js";import"./chardet@2.1.0-CTPPlwpv.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-7kYVjNRB.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-CuUdMqkw.js";import"./store@2.0.12-i6xqVJod.js";import"./mitt@3.0.1-C1z4c41a.js";import"./@codemirror_language-data@6.5.1-Blx1hvTn.js";import"./@codemirror_language@6.11.1-BYrSuhr8.js";import"./@lezer_common@1.2.3-CP7NCNqd.js";import"./@codemirror_state@6.5.2-DQ6R6BiX.js";import"./@marijn_find-cluster-break@1.0.2-DXwl3gUT.js";import"./@codemirror_view@6.37.1-Bd3_Yh4F.js";import"./style-mod@4.1.2-Bc2inJdb.js";import"./w3c-keyname@2.2.8-Vcq4gwWv.js";import"./@lezer_highlight@1.2.1-DwVMghhY.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.16_typescript@5.5.4_-BZ2tmr1d.js";import"./vue-router@4.5.1_vue@3.5.16_typescript@5.5.4_-ODt3CAxp.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.16_echarts@5.6.0_vue@3.5.16_typescript@5.5.4_-Dhz4IGE5.js";import"./echarts@5.6.0-DvAKqd2B.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.1-DcQm8NwP.js";import"./axios@1.9.0-D--XfsWq.js";import"./nprogress@0.2.0-dOd6e7EG.js";import"./@vueuse_shared@9.13.0_vue@3.5.16_typescript@5.5.4_-4q0MSQPl.js";import"./@vueuse_core@9.13.0_vue@3.5.16_typescript@5.5.4_-DmiypGF2.js";import"./@sxzz_popperjs-es@2.11.7-D_chPuIy.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./async-validator@4.2.5-CDKkdPIV.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-BQoi3Ox2.js";import"./@floating-ui_dom@1.7.1-Ba-2EiSn.js";import"./@floating-ui_core@1.7.1-C83JrwzW.js";import"./@floating-ui_utils@0.2.9-CBkBHzV8.js";import"./@intlify_core-base@11.1.5-rFPZQXdu.js";import"./@intlify_shared@11.1.5-CY44FrR8.js";import"./@intlify_message-compiler@11.1.5-CZ-uatfp.js";function q(t,m){const n={},r={s:{c:1e7,r:1e7},e:{c:0,r:0}};for(let a=0;a!=t.length;++a)for(let l=0;l!=t[a].length;++l){r.s.r>a&&(r.s.r=a),r.s.c>l&&(r.s.c=l),r.e.r<a&&(r.e.r=a),r.e.c<l&&(r.e.c=l);const u={v:t[a][l]};if(u.v==null)continue;const d=v.encode_cell({c:l,r:a});u.t="s",n[d]=u}return r.s.c<1e7&&(n["!ref"]=v.encode_range(r)),n}function S(){if(!(this instanceof S))return new S;this.SheetNames=[],this.Sheets={}}function H(t){const m=new ArrayBuffer(t.length),n=new Uint8Array(m);for(let r=0;r!=t.length;++r)n[r]=t.charCodeAt(r)&255;return m}function P({multiHeader:t=[],header:m=[],data:n=[],filename:r="",merges:a=[],autoWidth:l=!0,bookType:u="xlsx"}={}){r=r||"excel-list",n=[...n],n.unshift(m);for(let o=t.length-1;o>-1;o--)n.unshift(t[o]);const d="SheetJS",w=new S,f=q(n);if(a.length>0&&(f["!merges"]||(f["!merges"]=[]),a.forEach(o=>{f["!merges"].push(v.decode_range(o))})),l){const o=n.map(e=>e.map(i=>i==null?{wch:10}:i.toString().charCodeAt(0)>255?{wch:i.toString().length*2}:{wch:i.toString().length})),s=o[0];for(let e=1;e<o.length;e++)for(let i=0;i<o[e].length;i++)s[i].wch<o[e][i].wch&&(s[i].wch=o[e][i].wch);f["!cols"]=s}w.SheetNames.push(d),w.Sheets[d]=f;const x=D(w,{bookType:u,bookSST:!1,type:"binary"});W.saveAs(new Blob([H(x)],{type:"application/octet-stream"}),`${r}.${u}`)}const Le=L({name:"cl-export-btn",props:{filename:[Function,String],autoWidth:{type:Boolean,default:!0},bookType:{type:String,default:"xlsx"},header:Array,columns:{type:Array},data:[Function,Array],maxExportLimit:Number},setup(t,{slots:m}){const{t:n}=M(),r=F(),a=B(),l=T(!1);async function u(o,s){return o.filter(e=>!e.hidden&&s.includes(e.prop)).map(e=>e.label)}async function d(){var s,e,i;const o={...(s=r.value)==null?void 0:s.paramsReplace(r.value.params),maxExportLimit:t.maxExportLimit,isExport:!0};return typeof t.data=="function"?t.data(o):t.data?t.data:(e=r.value)!=null&&e.service?(i=r.value)==null?void 0:i.service.page(o).then(p=>p.list.map((c,y)=>{var _,k;for(const h in c){const g=(_=t.columns)==null?void 0:_.find(C=>C.prop==h);g&&(g.formatter&&(c[h]=g.formatter(c,g,c[h],y)),g.dict&&(c[h]=((k=Y(c[h],g.dict))==null?void 0:k.label)||c[h]))}return c})).catch(p=>(b.error(p.message),[])):[]}async function w(){return typeof t.filename=="function"?await(t==null?void 0:t.filename()):t.filename||`Doc（${N().format("YYYY-MM-DD HH_mm_ss")}）`}async function f(o){l.value=!0;const s=o.map(c=>c.prop).filter(Boolean),e=await u(o,s);let i=await d();if(!i)return l.value=!1,b.error(n("导出数据异常"));const p=await w();i=i.map(c=>s.map(y=>c[y])),P({header:e,data:i,filename:p,autoWidth:t.autoWidth,bookType:t.bookType}),l.value=!1}function x(){var s;if(!t.columns)return;const o=$(t.columns,"orderNum","asc").filter(e=>!(e.hidden===!0||["selection","expand","index","op"].includes(e.type)||e.filterExport||e["filter-export"]));(s=a.value)==null||s.open({title:n("导出"),width:"600px",props:{labelPosition:"top"},form:{checked:o.map(e=>e.prop)},items:[{label:n("选择列"),prop:"checked",component:{name:"el-checkbox-group",options:o.map(e=>({label:String(e.label),value:e.prop}))}}],on:{submit(e,{close:i,done:p}){j(e.checked)?(b.warning(n("请先选择要导出的列")),p()):(f(o.filter(c=>e.checked.includes(c.prop))),i())}}})}return()=>A(E("el-button"),{loading:l.value,onClick:x},{default:()=>[m.default?m.default():n("导出"),A(E("cl-form"),{ref:a},null)]})}});export{Le as default};
