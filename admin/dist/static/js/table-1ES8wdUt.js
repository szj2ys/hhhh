import{w as re}from"./@vue_runtime-dom@3.5.16-DriBzn4z.js";import{d as se,c as ce,g as ue,u as pe}from"./comm-Ba3vmJ1R.js";import{u as de}from"./index-BDeQYItE.js";import"./store@2.0.12-i6xqVJod.js";import{k as me}from"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-CeLFb4Nw.js";import{C as fe}from"./index-l1IOnGdE.js";import{o as ve,A as E,e as I,y as ye}from"./lodash-es@4.17.21-BYk7DlcU.js";import{d as J,v as _e,w as ge,P as c,c as f,o as i,a as H,i as l,F as h,z as k,H as a,J as _,y as C,L as ke,x as be,n as he}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{u as Ce}from"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-Bqjl69Su.js";import{v as x,u as we,y as p}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import{O as r}from"./@vue_shared@3.5.16-UwmvJIHj.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import"./@vueuse_shared@9.13.0_vue@3.5.16_typescript@5.5.4_-4q0MSQPl.js";import"./@vueuse_core@9.13.0_vue@3.5.16_typescript@5.5.4_-DmiypGF2.js";import"./@sxzz_popperjs-es@2.11.7-D_chPuIy.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./dayjs@1.11.13-DUxgsv0d.js";import"./chardet@2.1.0-CTPPlwpv.js";import"./async-validator@4.2.5-CDKkdPIV.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-BQoi3Ox2.js";import"./@floating-ui_dom@1.7.1-Ba-2EiSn.js";import"./@floating-ui_core@1.7.1-C83JrwzW.js";import"./@floating-ui_utils@0.2.9-CBkBHzV8.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-7kYVjNRB.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-CuUdMqkw.js";import"./mitt@3.0.1-C1z4c41a.js";import"./@codemirror_language-data@6.5.1-Blx1hvTn.js";import"./@codemirror_language@6.11.1-BYrSuhr8.js";import"./@lezer_common@1.2.3-CP7NCNqd.js";import"./@codemirror_state@6.5.2-DQ6R6BiX.js";import"./@marijn_find-cluster-break@1.0.2-DXwl3gUT.js";import"./@codemirror_view@6.37.1-Bd3_Yh4F.js";import"./style-mod@4.1.2-Bc2inJdb.js";import"./w3c-keyname@2.2.8-Vcq4gwWv.js";import"./@lezer_highlight@1.2.1-DwVMghhY.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.16_typescript@5.5.4_-BZ2tmr1d.js";import"./vue-router@4.5.1_vue@3.5.16_typescript@5.5.4_-ODt3CAxp.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.16_echarts@5.6.0_vue@3.5.16_typescript@5.5.4_-Dhz4IGE5.js";import"./echarts@5.6.0-DvAKqd2B.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.1-DcQm8NwP.js";import"./axios@1.9.0-D--XfsWq.js";import"./nprogress@0.2.0-dOd6e7EG.js";import"./@intlify_core-base@11.1.5-rFPZQXdu.js";import"./@intlify_shared@11.1.5-CY44FrR8.js";import"./@intlify_message-compiler@11.1.5-CZ-uatfp.js";const Se={class:"cl-select-table__picker"},Te={class:"mb-[10px]"},Ve={key:0,class:"placeholder"},xe={key:0},ze={key:1},Be={key:0},Ae=J({name:"undefined"}),Fe=J({...Ae,name:"cl-select-table",props:{...fe,modelValue:null,scope:Object,title:String,placeholder:String,service:null,showPicker:{type:Boolean,default:!0},pickerType:{type:String,default:"default"},dict:Object,multiple:{type:Boolean,default:!0},columns:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(u,{expose:q,emit:G}){const{t:K}=Ce(),y=u,O=G,{refs:z,setRefs:Q}=de(),s=ve({id:"id",img:"avatarUrl",text:"nickName"},y.dict),W=se(),B=ce({contextMenu:["refresh","order-desc","order-asc"],columns:[y.multiple?{type:"selection",width:60,reserveSelection:!0}:{label:K("操作"),prop:"check",width:100},...y.columns]}),X=ue(),A=pe({service:y.service,async onRefresh(e,{next:t}){const o=await t(e);F.value.push(...o.list.map(m=>m[s.id])),v.value.forEach(m=>{var g,w;const b=(g=B.value)==null?void 0:g.data.find(R=>R[s.id]==m[s.id]);b&&((w=B.value)==null||w.toggleRowSelection(b,!0))})}});async function Y(e){var t;return(t=A.value)==null?void 0:t.refresh(e)}const S=x(!1),d=x([]),v=x([]),T=we({page:1,size:10}),V=_e(()=>{if(y.pickerType=="table"){const{page:e,size:t}=T;return d.value.slice((e-1)*t,e*t)}else return d.value}),F=x([]);function Z(e){const t=Array.from(new Set(F.value));v.value=v.value.filter(o=>!t.includes(o[s.id])).concat(...e)}function U(){S.value=!0,F.value=[],v.value=I(d.value),he(()=>{Y({size:10})})}function N(){S.value=!1}function ee(e){d.value=I(ye(e)?e:[e])}function j(e){e&&(v.value=[e]),d.value=I(v.value||[]),N()}async function D(){var e;await((e=A.value)==null?void 0:e.refresh({page:1,size:1e4}).then(t=>{d.value=t.list})),N()}function P(){var e;if(y.pickerType=="table"){const t=(((e=z.table)==null?void 0:e.selection)||[]).map(o=>o[s.id]);d.value=d.value.filter(o=>{var m;return(m=z.table)==null||m.toggleRowSelection(o,!1),!t.find(b=>b==o[s.id])})}else d.value=[]}return ge(d,(e=[])=>{var o;const t=e.map(m=>m[s.id]);y.multiple?O("update:modelValue",t):O("update:modelValue",t[0]),(o=W.value)==null||o.validateField(y.prop)},{deep:!0}),q({set:ee,remove:P,select:j,selectAll:D}),(e,t)=>{var M;const o=c("el-button"),m=c("cl-table"),b=c("el-pagination"),g=c("cl-row"),w=c("cl-crud"),R=c("cl-image"),te=c("el-tag"),le=c("el-icon"),oe=c("cl-refresh-btn"),L=c("cl-flex1"),ae=c("cl-search"),ie=c("cl-pagination"),ne=c("cl-dialog");return i(),f(h,null,[H("div",Se,[u.pickerType=="table"?(i(),f(h,{key:0},[u.multiple?(i(),f(h,{key:0},[H("div",Te,[l(o,{type:"success",onClick:U},{default:a(()=>[_(r(e.$t("添加")),1)]),_:1}),l(o,{type:"danger",disabled:((M=p(z).table)==null?void 0:M.selection.length)==0,onClick:t[0]||(t[0]=n=>P())},{default:a(()=>[_(r(e.$t("移除")),1)]),_:1},8,["disabled"])]),l(w,{padding:"0"},{default:a(()=>[l(m,{ref:p(Q)("table"),data:V.value,"auto-height":!1},null,8,["data"]),l(g,{type:"flex",align:"middle",justify:"end",style:{marginTop:"10px"}},{default:a(()=>[l(b,{"current-page":T.page,"onUpdate:currentPage":t[1]||(t[1]=n=>T.page=n),"page-size":T.size,total:d.value.length,background:"",layout:"total, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])]),_:1})]),_:1})],64)):k("",!0)],64)):(i(),f("div",{key:1,class:"cl-select-table__picker-inner",onClick:U},[p(E)(V.value)?(i(),f("span",Ve,r(u.placeholder||e.$t("请选择")),1)):(i(!0),f(h,{key:1},ke(V.value,(n,$)=>be(e.$slots,"item",{key:$,item:n,index:$},()=>[u.pickerType=="default"?(i(),f(h,{key:0},[l(R,{src:n[p(s).img],size:24,class:"mr-[5px]"},null,8,["src"]),u.multiple?k("",!0):(i(),f("span",xe,r(n[p(s).text]),1))],64)):u.pickerType=="text"?(i(),f(h,{key:1},[u.multiple?(i(),C(te,{key:0,"disable-transitions":"",size:"small",effect:"plain"},{default:a(()=>[_(r(n[p(s).text]),1)]),_:2},1024)):(i(),f("span",ze,r(n[p(s).text]),1))],64)):k("",!0)],!0)),128)),p(E)(V.value)?k("",!0):(i(),C(le,{key:2,onClick:t[2]||(t[2]=re(n=>P(),["stop"]))},{default:a(()=>[l(p(me))]),_:1}))]))]),l(ne,{modelValue:S.value,"onUpdate:modelValue":t[4]||(t[4]=n=>S.value=n),width:"1200px",title:u.title},{footer:a(()=>[l(o,{onClick:N},{default:a(()=>[_(r(e.$t("取消")),1)]),_:1}),u.multiple?(i(),C(o,{key:0,type:"success",disabled:p(E)(v.value),onClick:t[3]||(t[3]=n=>j())},{default:a(()=>[_(r(e.$t("选择")),1)]),_:1},8,["disabled"])):k("",!0)]),default:a(()=>[l(w,{ref_key:"Crud",ref:A,padding:"0"},{default:a(()=>[l(g,null,{default:a(()=>[l(oe),u.multiple?(i(),C(o,{key:0,type:"primary",onClick:D},{default:a(()=>[_(r(e.$t("全选")),1)]),_:1})):k("",!0),l(L),l(ae,{ref_key:"Search",ref:X},null,512)]),_:1}),l(g,null,{default:a(()=>[l(m,{ref_key:"Table",ref:B,"auto-height":!1,onSelectionChange:Z},{"column-check":a(({scope:n})=>{var $;return[(($=v.value[0])==null?void 0:$[p(s).id])==n.row[p(s).id]?(i(),C(o,{key:0,type:"success",disabled:""},{default:a(()=>[_(r(e.$t("已选")),1)]),_:1})):(i(),C(o,{key:1,onClick:Ne=>j(n.row)},{default:a(()=>[_(r(e.$t("选择")),1)]),_:2},1032,["onClick"]))]}),_:1},512)]),_:1}),l(g,null,{default:a(()=>[u.multiple?(i(),f("span",Be,r(e.$t("已选"))+" "+r(v.value.length)+" "+r(e.$t("人")),1)):k("",!0),l(L),l(ie)]),_:1})]),_:1},512)]),_:1},8,["modelValue","title"])],64)}}}),xt=$e(Fe,[["__scopeId","data-v-2019c0cb"]]);export{xt as default};
