import{u as ee}from"./group-CxGNcSJX.js";import{d as E}from"./dayjs@1.11.13-DUxgsv0d.js";import{k as J,u as te,s as j}from"./index-C5WS2hJt.js";import"./store@2.0.12-i6xqVJod.js";import{d as y,P as r,y as H,o as _,H as u,z as F,c as g,i as n,a as e,F as z,L as A,J as se}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{v as x,u as oe,y as b}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import{c as ne}from"./@vueuse_core@12.8.2_typescript@5.5.4-7kYVjNRB.js";import{A as le}from"./lodash-es@4.17.21-BYk7DlcU.js";import{a as T,b as ae}from"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import{O as v}from"./@vue_shared@3.5.16-UwmvJIHj.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";function re(w){if(!w)return"";const d=E(),o=E(w);let c=d.diff(o,"second");if(c<60)return c<0&&(c=0),`${c||1}秒前`;const m=d.diff(o,"minute");if(m<60)return`${m}分钟前`;const l=d.diff(o,"hour");return l<24?`${l}小时前`:d.isSame(o,"day")?`昨天 ${o.format("HH:mm")}`:o.format("YYYY-MM-DD HH:mm")}const ce=y({name:"undefined"}),ue=y({...ce,setup(w,{expose:d}){const o=x(!1),c=x("");async function m(l){if(l.from==2){window.open(l.content);return}l.from==1&&await J.know.loader.fileByLink({link:l.content}).then(a=>{c.value=a}),o.value=!0}return d({open:m}),(l,a)=>{const k=r("cl-preview-md"),h=r("cl-dialog");return _(),H(h,{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=B=>o.value=B),title:"查看内容",height:"70vh"},{default:u(()=>[c.value?(_(),H(k,{key:0,content:c.value},null,8,["content"])):F("",!0)]),_:1},8,["modelValue"])}}}),de={class:"test-panel"},pe={class:"left"},_e={class:"p-[10px]"},me={class:"flex items-center gap-2 h-[50px]"},fe={class:"w-[50px] text-center text-[var(--el-color-primary)] text-[14px] font-bold"},ve={class:"flex"},xe={class:"history"},he={class:"list h-[calc(100%-40px)]"},ge={class:"px-[10px]"},ye=["onClick"],we={class:"title"},ke={class:"right"},Ve={class:"head"},be={class:"py-[10px]"},Ce={class:"flex gap-2 items-center"},$e={class:"mr-[20px]"},De=["onClick"],He=y({name:"search-test"}),Te=y({...He,setup(w,{expose:d}){const{service:o,refs:c,setRefs:m}=te(),{ViewGroup:l}=ee({leftWidth:"400px",custom:!0}),a=x(!1),k=x(!1),h=x(0),B=ne(h,{duration:50}),C=x(),$=x([]),f=x("");function O(p){a.value=!0,C.value=p,$.value=[],i.init()}function P(){a.value=!1}async function R(){if(!f.value)return T.info("请输入需要测试的文本");k.value=!0,await o.know.retriever.invoke({knowId:C.value,text:f.value,options:{size:30,minScore:h.value}}).then(p=>{i.add(),f.value="",$.value=p.map(t=>{const{metadata:V,pageContent:S}=t[0];return{title:V.title,content:S,data:V,score:t[1].toFixed(6),source:V.source}})}).catch(p=>{T.error(p.message)}),k.value=!1}const i=oe({list:[],limit:20,add(){i.list.unshift({content:f.value,date:E().toDate()}),i.list.length>this.limit&&i.list.pop(),i.update()},remove(p){i.list.splice(p,1),i.update()},update(){j.set("know.searchTestHistory"+C.value,i.list)},check(p){f.value=p},init(){i.list=j.get("know.searchTestHistory"+C.value)||[]}});return d({open:O,close:P}),(p,t)=>{const V=r("el-input"),S=r("el-slider"),W=r("el-button"),N=r("el-empty"),U=r("el-scrollbar"),Y=r("cl-svg"),q=r("el-tooltip"),K=r("el-tag"),Q=r("cl-preview-md"),X=r("cl-view-group"),Z=r("cl-dialog");return _(),g(z,null,[n(Z,{modelValue:a.value,"onUpdate:modelValue":t[2]||(t[2]=s=>a.value=s),title:"搜索测试",width:"1200px",height:"70vh",padding:"0",scrollbar:!1},{default:u(()=>[e("div",de,[n(X,{ref_key:"ViewGroup",ref:l},{left:u(()=>[e("div",pe,[e("div",_e,[n(V,{type:"textarea",modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=s=>f.value=s),rows:5,placeholder:"输入需要测试的文本"},null,8,["modelValue"]),e("div",me,[t[3]||(t[3]=e("span",{class:"mr-[5px]"},"分值过滤",-1)),n(S,{modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=s=>h.value=s),min:0,max:1,step:.001,class:"flex-1"},null,8,["modelValue"]),e("span",fe,v(b(B).toFixed(3)),1)]),e("div",ve,[n(W,{class:"flex-1",type:"primary",loading:k.value,disabled:!f.value,onClick:R},{default:u(()=>t[4]||(t[4]=[se(" 测试 ")])),_:1,__:[4]},8,["loading","disabled"])])]),e("div",xe,[t[5]||(t[5]=e("p",{class:"flex items-center h-[40px] px-[10px] gap-2"},[e("span",null,"测试历史")],-1)),e("div",he,[n(U,null,{default:u(()=>[e("div",ge,[b(le)(i.list)?(_(),H(N,{key:0,"image-size":80})):F("",!0),(_(!0),g(z,null,A(i.list,(s,D)=>(_(),g("div",{class:"item",key:D,onClick:M=>i.check(s.content)},[e("span",null,v(s.content),1),e("span",null,v(b(re)(s.date)),1)],8,ye))),128))])]),_:1})])])])]),title:u(()=>[e("div",we,[t[7]||(t[7]=e("span",null,"测试结果",-1)),n(q,null,{content:u(()=>t[6]||(t[6]=[e("div",{style:{width:"250px"}}," 根据知识库内容与测试文本的相似度进行排序，你可以根据测试结果调整对应的文本注意:测试记录中的数据可能已经被修改过，点击某条测试数据后将展示最新的数据。 ",-1)])),default:u(()=>[n(Y,{name:"know-help",class:"cursor-pointer"})]),_:1})])]),right:u(()=>[n(U,null,{default:u(()=>[e("div",ke,[(_(!0),g(z,null,A($.value,(s,D)=>{var M,G,I;return _(),g("div",{class:"card",key:D},[e("div",Ve,[n(K,{"disable-transitions":""},{default:u(()=>[e("span",null,"#"+v(D+1)+" | ",1),t[8]||(t[8]=e("span",null,"语义检索 ",-1)),e("span",null," | "+v(s.score||0),1)]),_:2,__:[8]},1024),e("span",null,v(s==null?void 0:s.title),1)]),e("div",be,[n(Q,{content:s.content},null,8,["content"])]),e("div",Ce,[n(Y,{name:"know-comment",class:"text-[14px]"}),e("span",$e,v((M=s.content)==null?void 0:M.length),1),e("div",{class:"flex items-center cursor-pointer gap-2 hover:text-[var(--el-color-success)]",onClick:Se=>{var L;return(L=b(c).preview)==null?void 0:L.open(s.source)}},[n(Y,{name:`know-${["edit","file","url"][(G=s.source)==null?void 0:G.from]}`,class:"text-[14px]"},null,8,["name"]),e("span",null,v((I=s.source)==null?void 0:I.title),1)],8,De)])])}),128)),$.value.length==0?(_(),H(N,{key:0,"image-size":80})):F("",!0)])]),_:1})]),_:1},512)])]),_:1},8,["modelValue"]),n(ue,{ref:b(m)("preview")},null,512)],64)}}}),Ae=ie(Te,[["__scopeId","data-v-cf26f02d"]]),Be=y({name:"undefined"}),Je=y({...Be,emits:["success"],setup(w,{expose:d,emit:o}){const c=o;function m(l){ae.confirm("确定要重建知识库吗？","提示",{type:"warning"}).then(()=>{J.know.data.type.rebuild({typeId:l}).then(()=>{T.success("重建成功"),c("success")}).catch(a=>{T.error(a.message)})}).catch(()=>{})}return d({open:m}),(l,a)=>(_(),g("div"))}});export{Ae as S,Je as _};
