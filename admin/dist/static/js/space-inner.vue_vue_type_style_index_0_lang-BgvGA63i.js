import{v as N}from"./@vue_runtime-dom@3.5.16-DriBzn4z.js";import{_ as X}from"./@element-plus_icons-vue@2.3.1_vue@3.5.16_typescript@5.5.4_-CeLFb4Nw.js";import{u as Y}from"./index-BDeQYItE.js";import"./store@2.0.12-i6xqVJod.js";import{u as Z}from"./group-C7Cb0IKq.js";import ee from"./index-CqhLmO7l.js";import{a as w,b as ae}from"./element-plus@2.9.11_vue@3.5.16_typescript@5.5.4_-BTKo5Rtv.js";import{B as S}from"./lodash-es@4.17.21-BYk7DlcU.js";import{d as T,w as te,P as f,V as ne,c as _,o as u,i as s,H as d,a as i,U as I,y as P,z as oe,J as V,F as le,L as se,O as ie}from"./@vue_runtime-core@3.5.16-Cn8z-kNe.js";import{u as ce}from"./vue-i18n@11.1.5_vue@3.5.16_typescript@5.5.4_-Bqjl69Su.js";import{v as B,u as re,y as g}from"./@vue_reactivity@3.5.16-Dqy0TPbS.js";import{O as m,p as pe}from"./@vue_shared@3.5.16-UwmvJIHj.js";const ue={class:"cl-upload-space-inner__right"},de={class:"cl-upload-space-inner__header"},fe={style:{margin:"0px 10px"}},me=["onClick"],ve={class:"cl-upload-space-inner__file-index"},_e={key:1,class:"cl-upload-space-inner__file-empty"},ge={class:"cl-upload-space-inner__footer cl-pagination"},he=T({name:"undefined"}),Me=T({...he,name:"cl-upload-space-inner",props:{limit:{type:Number,default:99},accept:String,selectable:Boolean},emits:["selection-change","confirm"],setup(k,{expose:U,emit:G}){const h=k,q=G,{service:y,browser:x,refs:F,setRefs:L}=Y(),{t:c}=ce(),{ViewGroup:D}=Z({label:c("分类"),title:c("文件列表"),service:y.space.type,onEdit(){return{width:"400px",props:{labelPosition:"top"},dialog:{controls:["close"]},items:[{label:c("名称"),prop:"name",value:"",required:!0,component:{name:"el-input",props:{maxlength:20,clearable:!0}}}]}},onSelect(e){v({classifyId:e.id,page:1})}}),b=B(!1),n=B([]),r=B([]),p=re({page:1,size:20,total:0});function O(){n.value=[]}function R(e){var a,t;y.space.info.add({classifyId:(t=(a=D.value)==null?void 0:a.selected)==null?void 0:t.id,...e}).then(l=>{e.id=l.id}).catch(l=>{w.error(l.message)})}function H(e){r.value.unshift(e)}const C={page:1};async function v(e){var a;S(C,{type:((a=h.accept)==null?void 0:a.split("/")[0].replace("*",""))||void 0,...p,...e}),C.page==1&&(b.value=!0),await y.space.info.page(C).then(t=>{S(p,t.pagination),r.value=t.list}),b.value=!1}function J(e){const a=n.value.findIndex(t=>t.id===e.id);a>=0?n.value.splice(a,1):h.limit==1?n.value=[e]:n.value.length<h.limit?n.value.push(e):w.warning(c("最多只能选择{limit}个文件",{limit:h.limit}))}function E(e){return n.value.findIndex(a=>a.id===e)+1}function M(e){const a=e?[e.id]:n.value.map(t=>t.id);ae.confirm(c("此操作将删除文件, 是否继续?"),c("提示"),{type:"warning"}).then(()=>{w.success(c("删除成功")),a.forEach(t=>{[r.value,n.value].forEach(l=>{const $=l.findIndex(z=>z.id===t);l.splice($,1)})}),y.space.info.delete({ids:a}).catch(t=>{w.error(t.message)})}).catch(()=>null)}function j(e){e.preventDefault()}function A(e){e.preventDefault(),e.dataTransfer&&e.dataTransfer.files.forEach((a,t)=>{setTimeout(()=>{F.upload.upload(a)},t*10)})}return te(n,e=>{q("selection-change",e)},{deep:!0}),ie("space",{selection:n,refresh:v,loading:b,list:r}),U({selection:n,open,close,clear:O,refresh:v}),(e,a)=>{const t=f("el-button"),l=f("cl-upload"),$=f("el-icon"),z=f("el-scrollbar"),K=f("el-pagination"),Q=f("cl-view-group"),W=ne("loading");return u(),_("div",{class:"cl-upload-space-inner",onDragover:j,onDrop:A},[s(Q,{ref_key:"ViewGroup",ref:D},{right:d(()=>[i("div",ue,[i("div",de,[s(t,{onClick:a[0]||(a[0]=o=>v({page:1}))},{default:d(()=>[V(m(e.$t("刷新")),1)]),_:1}),i("div",fe,[s(l,{ref:g(L)("upload"),menu:"space",type:"file",multiple:"","show-file-list":!1,limit:9999,accept:k.accept,onSuccess:R,onUpload:H},{default:d(()=>[s(t,{type:"primary"},{default:d(()=>[V(m(e.$t("点击上传")),1)]),_:1})]),_:1},8,["accept"])]),k.selectable?oe("",!0):(u(),P(t,{key:0,type:"danger",disabled:n.value.length==0,onClick:a[1]||(a[1]=o=>M())},{default:d(()=>[V(m(e.$t("删除选中文件")),1)]),_:1},8,["disabled"]))]),I((u(),P(z,{class:"cl-upload-space-inner__file"},{default:d(()=>[r.value.length>0?(u(),_("div",{key:0,class:pe(["cl-upload-space-inner__file-list",{"is-mini":g(x).isMini}])},[(u(!0),_(le,null,se(r.value,o=>(u(),_("div",{key:o.preload||o.url,class:"cl-upload-space-inner__file-item",onClick:ye=>J(o)},[s(ee,{item:o,list:r.value,onRemove:M},null,8,["item","list"]),I(i("div",ve,[i("span",null,m(E(o.id)),1)],512),[[N,E(o.id)]])],8,me))),128))],2)):(u(),_("div",_e,[s($,{class:"el-icon--upload"},{default:d(()=>[s(g(X))]),_:1}),i("p",null,m(e.$t("将文件拖到此处，或点击按钮上传")),1)]))]),_:1})),[[W,b.value]]),i("div",ge,[s(K,{"current-page":p.page,"onUpdate:currentPage":a[2]||(a[2]=o=>p.page=o),size:g(x).isMini?"small":"default",total:p.total,"default-page-size":p.size,background:"",layout:"prev, pager, next",onCurrentChange:a[3]||(a[3]=o=>v())},null,8,["current-page","size","total","default-page-size"]),I(i("span",{class:"total"},m(e.$t("共 {total} 条",{total:p.total})),513),[[N,!g(x).isMini]])])])]),_:1},512)],32)}}});export{Me as _};
